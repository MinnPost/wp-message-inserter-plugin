"use strict";

/**
 * Sets cookies
 *
 * @param {string} name
 * @param {string} value
 * @param {number} days
 */
function setCookie(name, value, days) {
  const d = new Date();
  d.setTime(d.getTime() + 86400000 * days);
  document.cookie = name + '=' + value + ';path=/;expires=' + d.toGMTString();
}

/**
 * Reads cookies
 *
 * @param {string} name
 */
function getCookie(name) {
  const value = document.cookie.match('(^|;) ?' + name + '=([^;]*)(;|$)');
  return value ? value[2] : null;
}

/**
 * Allow our theme or other plugins to create analytics tracking events
 *
 * @param {string}  type
 * @param {string}  category
 * @param {string}  action
 * @param {string}  label
 * @param {Array}   value
 * @param {boolean} nonInteraction
 */
function analyticsTrackingEvent(type, category, action, label, value, nonInteraction) {
  if (typeof wp !== 'undefined') {
    category = 'Site Message: ' + category.charAt(0).toUpperCase() + category.slice(1);
    wp.hooks.doAction('wpMessageInserterAnalyticsEvent', type, category, action, label, value, nonInteraction);
  }
}

/**
 * Allow our theme or other plugins to send data to the dataLayer object for Google Tag Manager
 *
 * @param {string} messageRegion
 * @param {string} messageId
 */
function dataLayerEvent(messageRegion, messageId) {
  if (typeof wp !== 'undefined') {
    let dataLayerContent = {
      'parentMessageRegion': messageRegion,
      'parentMessageId': messageId
    };
    wp.hooks.doAction('wpMessageInserterDataLayerEvent', dataLayerContent);
  }
}

/**
 * Faux "Session" checking/setting.
 *
 * @return {number} currentCount
 */
function setCurrentCount() {
  // Timestamp stored on the cookie
  let currentCount = getCookie('count');
  const timestamp = Math.floor(new Date().getTime() / 1000);
  const cookieExpiration = 30; // expire the cooke in 30 days
  if (!getCookie('count')) {
    // First Visit - set count to 1
    setCookie('count', 1, cookieExpiration);
    // Set a timecheck cookie for an hour from now
    setCookie('timecheck', timestamp + 3600, cookieExpiration);
  } else if (timestamp > getCookie('timecheck')) {
    // Update Timecheck to new value
    setCookie('timecheck', timestamp + 3600, cookieExpiration);
    // Count exists already and it has been an hour. Update count
    setCookie('count', ++currentCount, cookieExpiration);
  }
  const urlParams = new URLSearchParams(window.location.search);
  if (urlParams.get('count') !== null) {
    currentCount = parseInt(urlParams.get('count'));
  }
  return currentCount;
}

/**
 * Get the WordPress post ID for a given popup.
 *
 * @param {Object} message
 * @return {number} postId
 */
function getPostId(message) {
  let postId = 0;
  message.classList.forEach(function (value) {
    if (0 < value.indexOf('message-id')) {
      postId = value.substring(value.lastIndexOf('-') + 1);
      return postId;
    }
  });
  return postId;
}

/**
 * Get the region for a given message.
 *
 * @param {Object} message
 * @return {string} region
 */
function getMessageRegion(message) {
  let region = '';
  message.classList.forEach(function (value) {
    if (0 < value.indexOf('message-region')) {
      region = value.substring(value.lastIndexOf('-') + 1);
      return region;
    }
  });
  return region;
}

/**
 * Show a specific popup. Sets a cookie and adds a visibility class.
 *
 * @param {Object} popupMessage
 * @param {number} cookieDayTotal
 * @param {string} popupShownCookieName
 * @param {string} popupVisibleClass
 * @param {string} validatedSessionClass
 */
function showPopup(popupMessage, cookieDayTotal, popupShownCookieName, popupVisibleClass, validatedSessionClass) {
  setCookie(popupShownCookieName, 'true', cookieDayTotal);
  const validatedItems = document.querySelectorAll('.' + validatedSessionClass);
  if (0 < validatedItems.length) {
    validatedItems.forEach(function (validatedMessage) {
      validatedMessage.classList.add(popupVisibleClass);
    });
  } else {
    popupMessage.classList.add(popupVisibleClass);
  }
}

/**
 * Show a specific popup. Sets a cookie and adds a visibility class.
 *
 * @param {Object} popupMessage
 * @param {string} popupVisibleClass
 * @param {Object} lastFocus
 * @param {string} closeTrigger
 */
function hidePopup(popupMessage, popupVisibleClass, lastFocus, closeTrigger) {
  lastFocus.focus();
  popupMessage.classList.remove(popupVisibleClass);
  const popupId = getPostId(popupMessage);
  const messageRegion = 'Popup';
  if (0 !== popupId) {
    analyticsTrackingEvent('event', messageRegion, closeTrigger, popupId, undefined, 1);
    dataLayerEvent(messageRegion, popupId);
  }
}

/**
 * Display and controls for popups
 *
 * @param {Object} popupMessage
 * @param {number} cookieDayTotal
 * @param {string} popupShownCookieName
 * @param {string} popupVisibleClass
 * @param {string} checkSessionClass
 * @param {string} validatedSessionClass
 */
function popupDisplay(popupMessage, cookieDayTotal, popupShownCookieName, popupVisibleClass, checkSessionClass, validatedSessionClass) {
  const lastFocus = document.activeElement; // eslint-disable-line
  // Check if we should be showing the popup
  if ('true' !== getCookie(popupShownCookieName) && (!popupMessage.classList.contains(checkSessionClass) || popupMessage.classList.contains(validatedSessionClass))) {
    // actually show the popup
    showPopup(popupMessage, cookieDayTotal, popupShownCookieName, popupVisibleClass, validatedSessionClass);

    // run messageAnalytics on the popup
    messageAnalytics(popupMessage);

    // 1. detect clicks inside the popup that should close it.
    popupMessage.addEventListener('click', function (event) {
      const isCloseButton = event.target.classList.contains('sm-close-btn');
      if (true === isCloseButton) {
        event.preventDefault();
        hidePopup(popupMessage, popupVisibleClass, lastFocus, 'Close Button');
      }
    }, true);

    // 2. detect clicks outside the popup.
    document.addEventListener('click', evt => {
      let targetElement = evt.target;
      do {
        if (targetElement === popupMessage) {
          return;
        }
        // Go up the DOM
        targetElement = targetElement.parentNode;
      } while (targetElement);
      // This is a click outside.
      hidePopup(popupMessage, popupVisibleClass, lastFocus, 'Click Outside to Close');
    });

    // 3. detect escape key press
    document.onkeydown = function (evt) {
      evt = evt || window.event;
      let isEscape = false;
      if ('key' in evt) {
        isEscape = evt.key === 'Escape' || evt.key === 'Esc';
      } else {
        isEscape = evt.keyCode === 27;
      }
      if (isEscape) {
        hidePopup(popupMessage, popupVisibleClass, lastFocus, 'Escape Key');
      }
    };
  } // end of if statement for the conditional to show this popup.
}

/**
 * Set up google analytics events.
 *
 * @param {Object} message
 */
function messageAnalytics(message) {
  const messageRegion = getMessageRegion(message);
  const messageId = getPostId(message);
  const messageDisplay = window.getComputedStyle(message, null).display;
  // tell analytics if a message is being displayed
  if ('none' !== messageDisplay) {
    analyticsTrackingEvent('event', messageRegion, 'Show', messageId, undefined, 1);
    // click tracker for analytics events
    message.addEventListener('click', function (event) {
      // 1. is it a login link or close button?
      // the close event will have already been tracked by the hidePopup method.
      const isLoginClick = event.target.classList.contains('message-login');
      const isCloseButton = event.target.classList.contains('sm-close-btn');
      if (true === isLoginClick) {
        const url = $(this).attr('href');
        analyticsTrackingEvent('event', messageRegion, 'Login Link', url);
        dataLayerEvent(messageRegion, messageId);
      } else if (false === isCloseButton) {
        // 2. other links
        analyticsTrackingEvent('event', messageRegion, 'Click', messageId);
        dataLayerEvent(messageRegion, messageId);
      }
    }, true);
  }
}

/**
 * When the document is loaded, set up session tracking and popup display
 *
 */
document.addEventListener('DOMContentLoaded', function () {
  const popupSelector = 'wp-message-inserter-message-region-popup';
  const popupShownCookieName = 'sm-shown';
  const popupVisibleClass = 'wp-message-inserter-message-popup-visible';
  const checkSessionClass = 'check-session-message';
  const messageSelector = 'wp-message-inserter-message';
  const validatedSessionClass = 'validated';
  const checkSessionItems = document.querySelectorAll('.' + checkSessionClass);
  if (0 < checkSessionItems.length) {
    // get the current count of sessions and set the operators for comparison
    const currentCount = setCurrentCount();
    const operators = {
      gt(a, b) {
        return a >= b;
      },
      lt(a, b) {
        return a <= b;
      }
    };

    // handle messages that are session-dependent
    checkSessionItems.forEach(function (currentSessionMessage) {
      const bannerSessionCount = parseInt(currentSessionMessage.dataset.sessionCountToCheck);
      const bannerSessionOperator = currentSessionMessage.dataset.sessionCountOperator;
      if (operators[bannerSessionOperator](currentCount, bannerSessionCount)) {
        if (currentSessionMessage.classList.contains(popupSelector)) {
          currentSessionMessage.classList.add(validatedSessionClass);
        } else if (!getCookie(popupShownCookieName)) {
          currentSessionMessage.classList.add(validatedSessionClass);
        }
      }
    });
  }
  const popupMessage = document.querySelector('.' + popupSelector);
  if (null !== popupMessage) {
    // get our value for days and hours to set cookie
    const closeTimeDays = parseInt(popupMessage.dataset.closeTimeDays) || 0;
    const closeTimeHours = (parseInt(popupMessage.dataset.closeTimeHours) || 0) / 24;
    // Our Total for when the cookie should expire and show the banner again
    const cookieDayTotal = closeTimeDays + closeTimeHours;
    // determines whether to display a popup
    popupDisplay(popupMessage, cookieDayTotal, popupShownCookieName, popupVisibleClass, checkSessionClass, validatedSessionClass);
  }

  // analytics events for any kind of message that is displayed
  const messageItems = document.querySelectorAll('.' + messageSelector + ':not( .' + popupSelector + ' )');
  if (0 < messageItems.length) {
    messageItems.forEach(function (currentMessage) {
      messageAnalytics(currentMessage);
    });
  }
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIjAxLW1lc3NhZ2VzLmpzIl0sIm5hbWVzIjpbInNldENvb2tpZSIsIm5hbWUiLCJ2YWx1ZSIsImRheXMiLCJkIiwiRGF0ZSIsInNldFRpbWUiLCJnZXRUaW1lIiwiZG9jdW1lbnQiLCJjb29raWUiLCJ0b0dNVFN0cmluZyIsImdldENvb2tpZSIsIm1hdGNoIiwiYW5hbHl0aWNzVHJhY2tpbmdFdmVudCIsInR5cGUiLCJjYXRlZ29yeSIsImFjdGlvbiIsImxhYmVsIiwibm9uSW50ZXJhY3Rpb24iLCJ3cCIsImNoYXJBdCIsInRvVXBwZXJDYXNlIiwic2xpY2UiLCJob29rcyIsImRvQWN0aW9uIiwiZGF0YUxheWVyRXZlbnQiLCJtZXNzYWdlUmVnaW9uIiwibWVzc2FnZUlkIiwiZGF0YUxheWVyQ29udGVudCIsInNldEN1cnJlbnRDb3VudCIsImN1cnJlbnRDb3VudCIsInRpbWVzdGFtcCIsIk1hdGgiLCJmbG9vciIsImNvb2tpZUV4cGlyYXRpb24iLCJ1cmxQYXJhbXMiLCJVUkxTZWFyY2hQYXJhbXMiLCJ3aW5kb3ciLCJsb2NhdGlvbiIsInNlYXJjaCIsImdldCIsInBhcnNlSW50IiwiZ2V0UG9zdElkIiwibWVzc2FnZSIsInBvc3RJZCIsImNsYXNzTGlzdCIsImZvckVhY2giLCJpbmRleE9mIiwic3Vic3RyaW5nIiwibGFzdEluZGV4T2YiLCJnZXRNZXNzYWdlUmVnaW9uIiwicmVnaW9uIiwic2hvd1BvcHVwIiwicG9wdXBNZXNzYWdlIiwiY29va2llRGF5VG90YWwiLCJwb3B1cFNob3duQ29va2llTmFtZSIsInBvcHVwVmlzaWJsZUNsYXNzIiwidmFsaWRhdGVkU2Vzc2lvbkNsYXNzIiwidmFsaWRhdGVkSXRlbXMiLCJxdWVyeVNlbGVjdG9yQWxsIiwibGVuZ3RoIiwidmFsaWRhdGVkTWVzc2FnZSIsImFkZCIsImhpZGVQb3B1cCIsImxhc3RGb2N1cyIsImNsb3NlVHJpZ2dlciIsImZvY3VzIiwicmVtb3ZlIiwicG9wdXBJZCIsInVuZGVmaW5lZCIsInBvcHVwRGlzcGxheSIsImNoZWNrU2Vzc2lvbkNsYXNzIiwiYWN0aXZlRWxlbWVudCIsImNvbnRhaW5zIiwibWVzc2FnZUFuYWx5dGljcyIsImFkZEV2ZW50TGlzdGVuZXIiLCJldmVudCIsImlzQ2xvc2VCdXR0b24iLCJ0YXJnZXQiLCJwcmV2ZW50RGVmYXVsdCIsImV2dCIsInRhcmdldEVsZW1lbnQiLCJwYXJlbnROb2RlIiwib25rZXlkb3duIiwiaXNFc2NhcGUiLCJrZXkiLCJrZXlDb2RlIiwibWVzc2FnZURpc3BsYXkiLCJnZXRDb21wdXRlZFN0eWxlIiwiZGlzcGxheSIsImlzTG9naW5DbGljayIsInVybCIsIiQiLCJhdHRyIiwicG9wdXBTZWxlY3RvciIsIm1lc3NhZ2VTZWxlY3RvciIsImNoZWNrU2Vzc2lvbkl0ZW1zIiwib3BlcmF0b3JzIiwiZ3QiLCJhIiwiYiIsImx0IiwiY3VycmVudFNlc3Npb25NZXNzYWdlIiwiYmFubmVyU2Vzc2lvbkNvdW50IiwiZGF0YXNldCIsInNlc3Npb25Db3VudFRvQ2hlY2siLCJiYW5uZXJTZXNzaW9uT3BlcmF0b3IiLCJzZXNzaW9uQ291bnRPcGVyYXRvciIsInF1ZXJ5U2VsZWN0b3IiLCJjbG9zZVRpbWVEYXlzIiwiY2xvc2VUaW1lSG91cnMiLCJtZXNzYWdlSXRlbXMiLCJjdXJyZW50TWVzc2FnZSJdLCJtYXBwaW5ncyI6Ijs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVNBLFNBQVMsQ0FBQ0MsSUFBSSxFQUFFQyxLQUFLLEVBQUVDLElBQUksRUFBRTtFQUNyQyxNQUFNQyxDQUFDLEdBQUcsSUFBSUMsSUFBSSxFQUFFO0VBQ3BCRCxDQUFDLENBQUNFLE9BQU8sQ0FBQ0YsQ0FBQyxDQUFDRyxPQUFPLEVBQUUsR0FBRyxRQUFRLEdBQUdKLElBQUksQ0FBQztFQUN4Q0ssUUFBUSxDQUFDQyxNQUFNLEdBQUdSLElBQUksR0FBRyxHQUFHLEdBQUdDLEtBQUssR0FBRyxrQkFBa0IsR0FBR0UsQ0FBQyxDQUFDTSxXQUFXLEVBQUU7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QUFDTSxjQUFjLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRTtJQUMxRDtJQUNBLE1BQU14RCxjQUFjLEdBQUd1RCxhQUFhLEdBQUdDLGNBQWM7SUFDckQ7SUFDQXhDLFlBQVksQ0FDWGpCLFlBQVksRUFDWkMsY0FBYyxFQUNkQyxvQkFBb0IsRUFDcEJDLGlCQUFpQixFQUNqQmUsaUJBQWlCLEVBQ2pCZCxxQkFBcUIsQ0FDckI7RUFDRjs7RUFFQTtFQUNBLE1BQU1zRCxZQUFZLEdBQUd2RyxRQUFRLENBQUNtRCxnQkFBZ0IsQ0FDN0MsR0FBRyxHQUFHb0MsZUFBZSxHQUFHLFNBQVMsR0FBR0QsYUFBYSxHQUFHLElBQUksQ0FDeEQ7RUFDRCxJQUFJLENBQUMsR0FBR2lCLFlBQVksQ0FBQ25ELE1BQU0sRUFBRTtJQUM1Qm1ELFlBQVksQ0FBQ2pFLE9BQU8sQ0FBQyxVQUFVa0UsY0FBYyxFQUFFO01BQzlDdEMsZ0JBQWdCLENBQUNzQyxjQUFjLENBQUM7SUFDakMsQ0FBQyxDQUFDO0VBQ0g7QUFDRCxDQUFDLENBQUMiLCJmaWxlIjoid3AtbWVzc2FnZS1pbnNlcnRlci1wbHVnaW4tZnJvbnQtZW5kLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBTZXRzIGNvb2tpZXNcbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gbmFtZVxuICogQHBhcmFtIHtzdHJpbmd9IHZhbHVlXG4gKiBAcGFyYW0ge251bWJlcn0gZGF5c1xuICovXG5mdW5jdGlvbiBzZXRDb29raWUobmFtZSwgdmFsdWUsIGRheXMpIHtcblx0Y29uc3QgZCA9IG5ldyBEYXRlKCk7XG5cdGQuc2V0VGltZShkLmdldFRpbWUoKSArIDg2NDAwMDAwICogZGF5cyk7XG5cdGRvY3VtZW50LmNvb2tpZSA9IG5hbWUgKyAnPScgKyB2YWx1ZSArICc7cGF0aD0vO2V4cGlyZXM9JyArIGQudG9HTVRTdHJpbmcoKTtcbn1cblxuLyoqXG4gKiBSZWFkcyBjb29raWVzXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IG5hbWVcbiAqL1xuZnVuY3Rpb24gZ2V0Q29va2llKG5hbWUpIHtcblx0Y29uc3QgdmFsdWUgPSBkb2N1bWVudC5jb29raWUubWF0Y2goJyhefDspID8nICsgbmFtZSArICc9KFteO10qKSg7fCQpJyk7XG5cdHJldHVybiB2YWx1ZSA/IHZhbHVlWzJdIDogbnVsbDtcbn1cblxuLyoqXG4gKiBBbGxvdyBvdXIgdGhlbWUgb3Igb3RoZXIgcGx1Z2lucyB0byBjcmVhdGUgYW5hbHl0aWNzIHRyYWNraW5nIGV2ZW50c1xuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSAgdHlwZVxuICogQHBhcmFtIHtzdHJpbmd9ICBjYXRlZ29yeVxuICogQHBhcmFtIHtzdHJpbmd9ICBhY3Rpb25cbiAqIEBwYXJhbSB7c3RyaW5nfSAgbGFiZWxcbiAqIEBwYXJhbSB7QXJyYXl9ICAgdmFsdWVcbiAqIEBwYXJhbSB7Ym9vbGVhbn0gbm9uSW50ZXJhY3Rpb25cbiAqL1xuZnVuY3Rpb24gYW5hbHl0aWNzVHJhY2tpbmdFdmVudChcblx0dHlwZSxcblx0Y2F0ZWdvcnksXG5cdGFjdGlvbixcblx0bGFiZWwsXG5cdHZhbHVlLFxuXHRub25JbnRlcmFjdGlvblxuKSB7XG5cdGlmICh0eXBlb2Ygd3AgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0Y2F0ZWdvcnkgPVxuXHRcdFx0J1NpdGUgTWVzc2FnZTogJyArXG5cdFx0XHRjYXRlZ29yeS5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArXG5cdFx0XHRjYXRlZ29yeS5zbGljZSgxKTtcblx0XHR3cC5ob29rcy5kb0FjdGlvbihcblx0XHRcdCd3cE1lc3NhZ2VJbnNlcnRlckFuYWx5dGljc0V2ZW50Jyxcblx0XHRcdHR5cGUsXG5cdFx0XHRjYXRlZ29yeSxcblx0XHRcdGFjdGlvbixcblx0XHRcdGxhYmVsLFxuXHRcdFx0dmFsdWUsXG5cdFx0XHRub25JbnRlcmFjdGlvblxuXHRcdCk7XG5cdH1cbn1cblxuLyoqXG4gKiBBbGxvdyBvdXIgdGhlbWUgb3Igb3RoZXIgcGx1Z2lucyB0byBzZW5kIGRhdGEgdG8gdGhlIGRhdGFMYXllciBvYmplY3QgZm9yIEdvb2dsZSBUYWcgTWFuYWdlclxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBtZXNzYWdlUmVnaW9uXG4gKiBAcGFyYW0ge3N0cmluZ30gbWVzc2FnZUlkXG4gKi9cbmZ1bmN0aW9uIGRhdGFMYXllckV2ZW50KG1lc3NhZ2VSZWdpb24sIG1lc3NhZ2VJZCkge1xuXHRpZiAodHlwZW9mIHdwICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGxldCBkYXRhTGF5ZXJDb250ZW50ID0ge1xuXHRcdFx0J3BhcmVudE1lc3NhZ2VSZWdpb24nOiBtZXNzYWdlUmVnaW9uLFxuXHRcdFx0J3BhcmVudE1lc3NhZ2VJZCc6IG1lc3NhZ2VJZFxuXHRcdH07XG5cdFx0d3AuaG9va3MuZG9BY3Rpb24oJ3dwTWVzc2FnZUluc2VydGVyRGF0YUxheWVyRXZlbnQnLCBkYXRhTGF5ZXJDb250ZW50KTtcblx0fVxufVxuXG4vKipcbiAqIEZhdXggXCJTZXNzaW9uXCIgY2hlY2tpbmcvc2V0dGluZy5cbiAqXG4gKiBAcmV0dXJuIHtudW1iZXJ9IGN1cnJlbnRDb3VudFxuICovXG5mdW5jdGlvbiBzZXRDdXJyZW50Q291bnQoKSB7XG5cdC8vIFRpbWVzdGFtcCBzdG9yZWQgb24gdGhlIGNvb2tpZVxuXHRsZXQgY3VycmVudENvdW50ID0gZ2V0Q29va2llKCdjb3VudCcpO1xuXHRjb25zdCB0aW1lc3RhbXAgPSBNYXRoLmZsb29yKG5ldyBEYXRlKCkuZ2V0VGltZSgpIC8gMTAwMCk7XG5cdGNvbnN0IGNvb2tpZUV4cGlyYXRpb24gPSAzMDsgLy8gZXhwaXJlIHRoZSBjb29rZSBpbiAzMCBkYXlzXG5cdGlmICghZ2V0Q29va2llKCdjb3VudCcpKSB7XG5cdFx0Ly8gRmlyc3QgVmlzaXQgLSBzZXQgY291bnQgdG8gMVxuXHRcdHNldENvb2tpZSgnY291bnQnLCAxLCBjb29raWVFeHBpcmF0aW9uKTtcblx0XHQvLyBTZXQgYSB0aW1lY2hlY2sgY29va2llIGZvciBhbiBob3VyIGZyb20gbm93XG5cdFx0c2V0Q29va2llKCd0aW1lY2hlY2snLCB0aW1lc3RhbXAgKyAzNjAwLCBjb29raWVFeHBpcmF0aW9uKTtcblx0fSBlbHNlIGlmICh0aW1lc3RhbXAgPiBnZXRDb29raWUoJ3RpbWVjaGVjaycpKSB7XG5cdFx0Ly8gVXBkYXRlIFRpbWVjaGVjayB0byBuZXcgdmFsdWVcblx0XHRzZXRDb29raWUoJ3RpbWVjaGVjaycsIHRpbWVzdGFtcCArIDM2MDAsIGNvb2tpZUV4cGlyYXRpb24pO1xuXHRcdC8vIENvdW50IGV4aXN0cyBhbHJlYWR5IGFuZCBpdCBoYXMgYmVlbiBhbiBob3VyLiBVcGRhdGUgY291bnRcblx0XHRzZXRDb29raWUoJ2NvdW50JywgKytjdXJyZW50Q291bnQsIGNvb2tpZUV4cGlyYXRpb24pO1xuXHR9XG5cdGNvbnN0IHVybFBhcmFtcyA9IG5ldyBVUkxTZWFyY2hQYXJhbXMod2luZG93LmxvY2F0aW9uLnNlYXJjaCk7XG5cdGlmICh1cmxQYXJhbXMuZ2V0KCdjb3VudCcpICE9PSBudWxsKSB7XG5cdFx0Y3VycmVudENvdW50ID0gcGFyc2VJbnQodXJsUGFyYW1zLmdldCgnY291bnQnKSk7XG5cdH1cblx0cmV0dXJuIGN1cnJlbnRDb3VudDtcbn1cblxuLyoqXG4gKiBHZXQgdGhlIFdvcmRQcmVzcyBwb3N0IElEIGZvciBhIGdpdmVuIHBvcHVwLlxuICpcbiAqIEBwYXJhbSB7T2JqZWN0fSBtZXNzYWdlXG4gKiBAcmV0dXJuIHtudW1iZXJ9IHBvc3RJZFxuICovXG5mdW5jdGlvbiBnZXRQb3N0SWQobWVzc2FnZSkge1xuXHRsZXQgcG9zdElkID0gMDtcblx0bWVzc2FnZS5jbGFzc0xpc3QuZm9yRWFjaChmdW5jdGlvbiAodmFsdWUpIHtcblx0XHRpZiAoMCA8IHZhbHVlLmluZGV4T2YoJ21lc3NhZ2UtaWQnKSkge1xuXHRcdFx0cG9zdElkID0gdmFsdWUuc3Vic3RyaW5nKHZhbHVlLmxhc3RJbmRleE9mKCctJykgKyAxKTtcblx0XHRcdHJldHVybiBwb3N0SWQ7XG5cdFx0fVxuXHR9KTtcblx0cmV0dXJuIHBvc3RJZDtcbn1cblxuLyoqXG4gKiBHZXQgdGhlIHJlZ2lvbiBmb3IgYSBnaXZlbiBtZXNzYWdlLlxuICpcbiAqIEBwYXJhbSB7T2JqZWN0fSBtZXNzYWdlXG4gKiBAcmV0dXJuIHtzdHJpbmd9IHJlZ2lvblxuICovXG5mdW5jdGlvbiBnZXRNZXNzYWdlUmVnaW9uKG1lc3NhZ2UpIHtcblx0bGV0IHJlZ2lvbiA9ICcnO1xuXHRtZXNzYWdlLmNsYXNzTGlzdC5mb3JFYWNoKGZ1bmN0aW9uICh2YWx1ZSkge1xuXHRcdGlmICgwIDwgdmFsdWUuaW5kZXhPZignbWVzc2FnZS1yZWdpb24nKSkge1xuXHRcdFx0cmVnaW9uID0gdmFsdWUuc3Vic3RyaW5nKHZhbHVlLmxhc3RJbmRleE9mKCctJykgKyAxKTtcblx0XHRcdHJldHVybiByZWdpb247XG5cdFx0fVxuXHR9KTtcblx0cmV0dXJuIHJlZ2lvbjtcbn1cblxuLyoqXG4gKiBTaG93IGEgc3BlY2lmaWMgcG9wdXAuIFNldHMgYSBjb29raWUgYW5kIGFkZHMgYSB2aXNpYmlsaXR5IGNsYXNzLlxuICpcbiAqIEBwYXJhbSB7T2JqZWN0fSBwb3B1cE1lc3NhZ2VcbiAqIEBwYXJhbSB7bnVtYmVyfSBjb29raWVEYXlUb3RhbFxuICogQHBhcmFtIHtzdHJpbmd9IHBvcHVwU2hvd25Db29raWVOYW1lXG4gKiBAcGFyYW0ge3N0cmluZ30gcG9wdXBWaXNpYmxlQ2xhc3NcbiAqIEBwYXJhbSB7c3RyaW5nfSB2YWxpZGF0ZWRTZXNzaW9uQ2xhc3NcbiAqL1xuZnVuY3Rpb24gc2hvd1BvcHVwKFxuXHRwb3B1cE1lc3NhZ2UsXG5cdGNvb2tpZURheVRvdGFsLFxuXHRwb3B1cFNob3duQ29va2llTmFtZSxcblx0cG9wdXBWaXNpYmxlQ2xhc3MsXG5cdHZhbGlkYXRlZFNlc3Npb25DbGFzc1xuKSB7XG5cdHNldENvb2tpZShwb3B1cFNob3duQ29va2llTmFtZSwgJ3RydWUnLCBjb29raWVEYXlUb3RhbCk7XG5cdGNvbnN0IHZhbGlkYXRlZEl0ZW1zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcblx0XHQnLicgKyB2YWxpZGF0ZWRTZXNzaW9uQ2xhc3Ncblx0KTtcblx0aWYgKDAgPCB2YWxpZGF0ZWRJdGVtcy5sZW5ndGgpIHtcblx0XHR2YWxpZGF0ZWRJdGVtcy5mb3JFYWNoKGZ1bmN0aW9uICh2YWxpZGF0ZWRNZXNzYWdlKSB7XG5cdFx0XHR2YWxpZGF0ZWRNZXNzYWdlLmNsYXNzTGlzdC5hZGQocG9wdXBWaXNpYmxlQ2xhc3MpO1xuXHRcdH0pO1xuXHR9IGVsc2Uge1xuXHRcdHBvcHVwTWVzc2FnZS5jbGFzc0xpc3QuYWRkKHBvcHVwVmlzaWJsZUNsYXNzKTtcblx0fVxufVxuXG4vKipcbiAqIFNob3cgYSBzcGVjaWZpYyBwb3B1cC4gU2V0cyBhIGNvb2tpZSBhbmQgYWRkcyBhIHZpc2liaWxpdHkgY2xhc3MuXG4gKlxuICogQHBhcmFtIHtPYmplY3R9IHBvcHVwTWVzc2FnZVxuICogQHBhcmFtIHtzdHJpbmd9IHBvcHVwVmlzaWJsZUNsYXNzXG4gKiBAcGFyYW0ge09iamVjdH0gbGFzdEZvY3VzXG4gKiBAcGFyYW0ge3N0cmluZ30gY2xvc2VUcmlnZ2VyXG4gKi9cbmZ1bmN0aW9uIGhpZGVQb3B1cChwb3B1cE1lc3NhZ2UsIHBvcHVwVmlzaWJsZUNsYXNzLCBsYXN0Rm9jdXMsIGNsb3NlVHJpZ2dlcikge1xuXHRsYXN0Rm9jdXMuZm9jdXMoKTtcblx0cG9wdXBNZXNzYWdlLmNsYXNzTGlzdC5yZW1vdmUocG9wdXBWaXNpYmxlQ2xhc3MpO1xuXHRjb25zdCBwb3B1cElkID0gZ2V0UG9zdElkKHBvcHVwTWVzc2FnZSk7XG5cdGNvbnN0IG1lc3NhZ2VSZWdpb24gPSAnUG9wdXAnO1xuXHRpZiAoMCAhPT0gcG9wdXBJZCkge1xuXHRcdGFuYWx5dGljc1RyYWNraW5nRXZlbnQoXG5cdFx0XHQnZXZlbnQnLFxuXHRcdFx0bWVzc2FnZVJlZ2lvbixcblx0XHRcdGNsb3NlVHJpZ2dlcixcblx0XHRcdHBvcHVwSWQsXG5cdFx0XHR1bmRlZmluZWQsXG5cdFx0XHQxXG5cdFx0KTtcblx0XHRkYXRhTGF5ZXJFdmVudChtZXNzYWdlUmVnaW9uLCBwb3B1cElkKTtcblx0fVxufVxuXG4vKipcbiAqIERpc3BsYXkgYW5kIGNvbnRyb2xzIGZvciBwb3B1cHNcbiAqXG4gKiBAcGFyYW0ge09iamVjdH0gcG9wdXBNZXNzYWdlXG4gKiBAcGFyYW0ge251bWJlcn0gY29va2llRGF5VG90YWxcbiAqIEBwYXJhbSB7c3RyaW5nfSBwb3B1cFNob3duQ29va2llTmFtZVxuICogQHBhcmFtIHtzdHJpbmd9IHBvcHVwVmlzaWJsZUNsYXNzXG4gKiBAcGFyYW0ge3N0cmluZ30gY2hlY2tTZXNzaW9uQ2xhc3NcbiAqIEBwYXJhbSB7c3RyaW5nfSB2YWxpZGF0ZWRTZXNzaW9uQ2xhc3NcbiAqL1xuZnVuY3Rpb24gcG9wdXBEaXNwbGF5KFxuXHRwb3B1cE1lc3NhZ2UsXG5cdGNvb2tpZURheVRvdGFsLFxuXHRwb3B1cFNob3duQ29va2llTmFtZSxcblx0cG9wdXBWaXNpYmxlQ2xhc3MsXG5cdGNoZWNrU2Vzc2lvbkNsYXNzLFxuXHR2YWxpZGF0ZWRTZXNzaW9uQ2xhc3Ncbikge1xuXHRjb25zdCBsYXN0Rm9jdXMgPSBkb2N1bWVudC5hY3RpdmVFbGVtZW50OyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lXG5cdC8vIENoZWNrIGlmIHdlIHNob3VsZCBiZSBzaG93aW5nIHRoZSBwb3B1cFxuXHRpZiAoXG5cdFx0J3RydWUnICE9PSBnZXRDb29raWUocG9wdXBTaG93bkNvb2tpZU5hbWUpICYmXG5cdFx0KCFwb3B1cE1lc3NhZ2UuY2xhc3NMaXN0LmNvbnRhaW5zKGNoZWNrU2Vzc2lvbkNsYXNzKSB8fFxuXHRcdFx0cG9wdXBNZXNzYWdlLmNsYXNzTGlzdC5jb250YWlucyh2YWxpZGF0ZWRTZXNzaW9uQ2xhc3MpKVxuXHQpIHtcblx0XHQvLyBhY3R1YWxseSBzaG93IHRoZSBwb3B1cFxuXHRcdHNob3dQb3B1cChcblx0XHRcdHBvcHVwTWVzc2FnZSxcblx0XHRcdGNvb2tpZURheVRvdGFsLFxuXHRcdFx0cG9wdXBTaG93bkNvb2tpZU5hbWUsXG5cdFx0XHRwb3B1cFZpc2libGVDbGFzcyxcblx0XHRcdHZhbGlkYXRlZFNlc3Npb25DbGFzc1xuXHRcdCk7XG5cblx0XHQvLyBydW4gbWVzc2FnZUFuYWx5dGljcyBvbiB0aGUgcG9wdXBcblx0XHRtZXNzYWdlQW5hbHl0aWNzKHBvcHVwTWVzc2FnZSk7XG5cblx0XHQvLyAxLiBkZXRlY3QgY2xpY2tzIGluc2lkZSB0aGUgcG9wdXAgdGhhdCBzaG91bGQgY2xvc2UgaXQuXG5cdFx0cG9wdXBNZXNzYWdlLmFkZEV2ZW50TGlzdGVuZXIoXG5cdFx0XHQnY2xpY2snLFxuXHRcdFx0ZnVuY3Rpb24gKGV2ZW50KSB7XG5cdFx0XHRcdGNvbnN0IGlzQ2xvc2VCdXR0b24gPVxuXHRcdFx0XHRcdGV2ZW50LnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ3NtLWNsb3NlLWJ0bicpO1xuXHRcdFx0XHRpZiAodHJ1ZSA9PT0gaXNDbG9zZUJ1dHRvbikge1xuXHRcdFx0XHRcdGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHRcdFx0aGlkZVBvcHVwKFxuXHRcdFx0XHRcdFx0cG9wdXBNZXNzYWdlLFxuXHRcdFx0XHRcdFx0cG9wdXBWaXNpYmxlQ2xhc3MsXG5cdFx0XHRcdFx0XHRsYXN0Rm9jdXMsXG5cdFx0XHRcdFx0XHQnQ2xvc2UgQnV0dG9uJ1xuXHRcdFx0XHRcdCk7XG5cdFx0XHRcdH1cblx0XHRcdH0sXG5cdFx0XHR0cnVlXG5cdFx0KTtcblxuXHRcdC8vIDIuIGRldGVjdCBjbGlja3Mgb3V0c2lkZSB0aGUgcG9wdXAuXG5cdFx0ZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZXZ0KSA9PiB7XG5cdFx0XHRsZXQgdGFyZ2V0RWxlbWVudCA9IGV2dC50YXJnZXQ7XG5cdFx0XHRkbyB7XG5cdFx0XHRcdGlmICh0YXJnZXRFbGVtZW50ID09PSBwb3B1cE1lc3NhZ2UpIHtcblx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdH1cblx0XHRcdFx0Ly8gR28gdXAgdGhlIERPTVxuXHRcdFx0XHR0YXJnZXRFbGVtZW50ID0gdGFyZ2V0RWxlbWVudC5wYXJlbnROb2RlO1xuXHRcdFx0fSB3aGlsZSAodGFyZ2V0RWxlbWVudCk7XG5cdFx0XHQvLyBUaGlzIGlzIGEgY2xpY2sgb3V0c2lkZS5cblx0XHRcdGhpZGVQb3B1cChcblx0XHRcdFx0cG9wdXBNZXNzYWdlLFxuXHRcdFx0XHRwb3B1cFZpc2libGVDbGFzcyxcblx0XHRcdFx0bGFzdEZvY3VzLFxuXHRcdFx0XHQnQ2xpY2sgT3V0c2lkZSB0byBDbG9zZSdcblx0XHRcdCk7XG5cdFx0fSk7XG5cblx0XHQvLyAzLiBkZXRlY3QgZXNjYXBlIGtleSBwcmVzc1xuXHRcdGRvY3VtZW50Lm9ua2V5ZG93biA9IGZ1bmN0aW9uIChldnQpIHtcblx0XHRcdGV2dCA9IGV2dCB8fCB3aW5kb3cuZXZlbnQ7XG5cdFx0XHRsZXQgaXNFc2NhcGUgPSBmYWxzZTtcblx0XHRcdGlmICgna2V5JyBpbiBldnQpIHtcblx0XHRcdFx0aXNFc2NhcGUgPSBldnQua2V5ID09PSAnRXNjYXBlJyB8fCBldnQua2V5ID09PSAnRXNjJztcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGlzRXNjYXBlID0gZXZ0LmtleUNvZGUgPT09IDI3O1xuXHRcdFx0fVxuXHRcdFx0aWYgKGlzRXNjYXBlKSB7XG5cdFx0XHRcdGhpZGVQb3B1cChcblx0XHRcdFx0XHRwb3B1cE1lc3NhZ2UsXG5cdFx0XHRcdFx0cG9wdXBWaXNpYmxlQ2xhc3MsXG5cdFx0XHRcdFx0bGFzdEZvY3VzLFxuXHRcdFx0XHRcdCdFc2NhcGUgS2V5J1xuXHRcdFx0XHQpO1xuXHRcdFx0fVxuXHRcdH07XG5cdH0gLy8gZW5kIG9mIGlmIHN0YXRlbWVudCBmb3IgdGhlIGNvbmRpdGlvbmFsIHRvIHNob3cgdGhpcyBwb3B1cC5cbn1cblxuLyoqXG4gKiBTZXQgdXAgZ29vZ2xlIGFuYWx5dGljcyBldmVudHMuXG4gKlxuICogQHBhcmFtIHtPYmplY3R9IG1lc3NhZ2VcbiAqL1xuZnVuY3Rpb24gbWVzc2FnZUFuYWx5dGljcyhtZXNzYWdlKSB7XG5cdGNvbnN0IG1lc3NhZ2VSZWdpb24gPSBnZXRNZXNzYWdlUmVnaW9uKG1lc3NhZ2UpO1xuXHRjb25zdCBtZXNzYWdlSWQgPSBnZXRQb3N0SWQobWVzc2FnZSk7XG5cdGNvbnN0IG1lc3NhZ2VEaXNwbGF5ID0gd2luZG93LmdldENvbXB1dGVkU3R5bGUobWVzc2FnZSwgbnVsbCkuZGlzcGxheTtcblx0Ly8gdGVsbCBhbmFseXRpY3MgaWYgYSBtZXNzYWdlIGlzIGJlaW5nIGRpc3BsYXllZFxuXHRpZiAoJ25vbmUnICE9PSBtZXNzYWdlRGlzcGxheSkge1xuXHRcdGFuYWx5dGljc1RyYWNraW5nRXZlbnQoXG5cdFx0XHQnZXZlbnQnLFxuXHRcdFx0bWVzc2FnZVJlZ2lvbixcblx0XHRcdCdTaG93Jyxcblx0XHRcdG1lc3NhZ2VJZCxcblx0XHRcdHVuZGVmaW5lZCxcblx0XHRcdDFcblx0XHQpO1xuXHRcdC8vIGNsaWNrIHRyYWNrZXIgZm9yIGFuYWx5dGljcyBldmVudHNcblx0XHRtZXNzYWdlLmFkZEV2ZW50TGlzdGVuZXIoXG5cdFx0XHQnY2xpY2snLFxuXHRcdFx0ZnVuY3Rpb24gKGV2ZW50KSB7XG5cdFx0XHRcdC8vIDEuIGlzIGl0IGEgbG9naW4gbGluayBvciBjbG9zZSBidXR0b24/XG5cdFx0XHRcdC8vIHRoZSBjbG9zZSBldmVudCB3aWxsIGhhdmUgYWxyZWFkeSBiZWVuIHRyYWNrZWQgYnkgdGhlIGhpZGVQb3B1cCBtZXRob2QuXG5cdFx0XHRcdGNvbnN0IGlzTG9naW5DbGljayA9XG5cdFx0XHRcdFx0ZXZlbnQudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnbWVzc2FnZS1sb2dpbicpO1xuXHRcdFx0XHRjb25zdCBpc0Nsb3NlQnV0dG9uID1cblx0XHRcdFx0XHRldmVudC50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdzbS1jbG9zZS1idG4nKTtcblx0XHRcdFx0aWYgKHRydWUgPT09IGlzTG9naW5DbGljaykge1xuXHRcdFx0XHRcdGNvbnN0IHVybCA9ICQodGhpcykuYXR0cignaHJlZicpO1xuXHRcdFx0XHRcdGFuYWx5dGljc1RyYWNraW5nRXZlbnQoXG5cdFx0XHRcdFx0XHQnZXZlbnQnLFxuXHRcdFx0XHRcdFx0bWVzc2FnZVJlZ2lvbixcblx0XHRcdFx0XHRcdCdMb2dpbiBMaW5rJyxcblx0XHRcdFx0XHRcdHVybFxuXHRcdFx0XHRcdCk7XG5cdFx0XHRcdFx0ZGF0YUxheWVyRXZlbnQobWVzc2FnZVJlZ2lvbiwgbWVzc2FnZUlkKTtcblx0XHRcdFx0fSBlbHNlIGlmIChmYWxzZSA9PT0gaXNDbG9zZUJ1dHRvbikge1xuXHRcdFx0XHRcdC8vIDIuIG90aGVyIGxpbmtzXG5cdFx0XHRcdFx0YW5hbHl0aWNzVHJhY2tpbmdFdmVudChcblx0XHRcdFx0XHRcdCdldmVudCcsXG5cdFx0XHRcdFx0XHRtZXNzYWdlUmVnaW9uLFxuXHRcdFx0XHRcdFx0J0NsaWNrJyxcblx0XHRcdFx0XHRcdG1lc3NhZ2VJZFxuXHRcdFx0XHRcdCk7XG5cdFx0XHRcdFx0ZGF0YUxheWVyRXZlbnQobWVzc2FnZVJlZ2lvbiwgbWVzc2FnZUlkKTtcblx0XHRcdFx0fVxuXHRcdFx0fSxcblx0XHRcdHRydWVcblx0XHQpO1xuXHR9XG59XG5cbi8qKlxuICogV2hlbiB0aGUgZG9jdW1lbnQgaXMgbG9hZGVkLCBzZXQgdXAgc2Vzc2lvbiB0cmFja2luZyBhbmQgcG9wdXAgZGlzcGxheVxuICpcbiAqL1xuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIGZ1bmN0aW9uICgpIHtcblx0Y29uc3QgcG9wdXBTZWxlY3RvciA9ICd3cC1tZXNzYWdlLWluc2VydGVyLW1lc3NhZ2UtcmVnaW9uLXBvcHVwJztcblx0Y29uc3QgcG9wdXBTaG93bkNvb2tpZU5hbWUgPSAnc20tc2hvd24nO1xuXHRjb25zdCBwb3B1cFZpc2libGVDbGFzcyA9ICd3cC1tZXNzYWdlLWluc2VydGVyLW1lc3NhZ2UtcG9wdXAtdmlzaWJsZSc7XG5cdGNvbnN0IGNoZWNrU2Vzc2lvbkNsYXNzID0gJ2NoZWNrLXNlc3Npb24tbWVzc2FnZSc7XG5cdGNvbnN0IG1lc3NhZ2VTZWxlY3RvciA9ICd3cC1tZXNzYWdlLWluc2VydGVyLW1lc3NhZ2UnO1xuXHRjb25zdCB2YWxpZGF0ZWRTZXNzaW9uQ2xhc3MgPSAndmFsaWRhdGVkJztcblx0Y29uc3QgY2hlY2tTZXNzaW9uSXRlbXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFxuXHRcdCcuJyArIGNoZWNrU2Vzc2lvbkNsYXNzXG5cdCk7XG5cdGlmICgwIDwgY2hlY2tTZXNzaW9uSXRlbXMubGVuZ3RoKSB7XG5cdFx0Ly8gZ2V0IHRoZSBjdXJyZW50IGNvdW50IG9mIHNlc3Npb25zIGFuZCBzZXQgdGhlIG9wZXJhdG9ycyBmb3IgY29tcGFyaXNvblxuXHRcdGNvbnN0IGN1cnJlbnRDb3VudCA9IHNldEN1cnJlbnRDb3VudCgpO1xuXHRcdGNvbnN0IG9wZXJhdG9ycyA9IHtcblx0XHRcdGd0KGEsIGIpIHtcblx0XHRcdFx0cmV0dXJuIGEgPj0gYjtcblx0XHRcdH0sXG5cdFx0XHRsdChhLCBiKSB7XG5cdFx0XHRcdHJldHVybiBhIDw9IGI7XG5cdFx0XHR9LFxuXHRcdH07XG5cblx0XHQvLyBoYW5kbGUgbWVzc2FnZXMgdGhhdCBhcmUgc2Vzc2lvbi1kZXBlbmRlbnRcblx0XHRjaGVja1Nlc3Npb25JdGVtcy5mb3JFYWNoKGZ1bmN0aW9uIChjdXJyZW50U2Vzc2lvbk1lc3NhZ2UpIHtcblx0XHRcdGNvbnN0IGJhbm5lclNlc3Npb25Db3VudCA9IHBhcnNlSW50KFxuXHRcdFx0XHRjdXJyZW50U2Vzc2lvbk1lc3NhZ2UuZGF0YXNldC5zZXNzaW9uQ291bnRUb0NoZWNrXG5cdFx0XHQpO1xuXHRcdFx0Y29uc3QgYmFubmVyU2Vzc2lvbk9wZXJhdG9yID1cblx0XHRcdFx0Y3VycmVudFNlc3Npb25NZXNzYWdlLmRhdGFzZXQuc2Vzc2lvbkNvdW50T3BlcmF0b3I7XG5cdFx0XHRpZiAoXG5cdFx0XHRcdG9wZXJhdG9yc1tiYW5uZXJTZXNzaW9uT3BlcmF0b3JdKFxuXHRcdFx0XHRcdGN1cnJlbnRDb3VudCxcblx0XHRcdFx0XHRiYW5uZXJTZXNzaW9uQ291bnRcblx0XHRcdFx0KVxuXHRcdFx0KSB7XG5cdFx0XHRcdGlmIChjdXJyZW50U2Vzc2lvbk1lc3NhZ2UuY2xhc3NMaXN0LmNvbnRhaW5zKHBvcHVwU2VsZWN0b3IpKSB7XG5cdFx0XHRcdFx0Y3VycmVudFNlc3Npb25NZXNzYWdlLmNsYXNzTGlzdC5hZGQodmFsaWRhdGVkU2Vzc2lvbkNsYXNzKTtcblx0XHRcdFx0fSBlbHNlIGlmICghZ2V0Q29va2llKHBvcHVwU2hvd25Db29raWVOYW1lKSkge1xuXHRcdFx0XHRcdGN1cnJlbnRTZXNzaW9uTWVzc2FnZS5jbGFzc0xpc3QuYWRkKHZhbGlkYXRlZFNlc3Npb25DbGFzcyk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9KTtcblx0fVxuXG5cdGNvbnN0IHBvcHVwTWVzc2FnZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy4nICsgcG9wdXBTZWxlY3Rvcik7XG5cdGlmIChudWxsICE9PSBwb3B1cE1lc3NhZ2UpIHtcblx0XHQvLyBnZXQgb3VyIHZhbHVlIGZvciBkYXlzIGFuZCBob3VycyB0byBzZXQgY29va2llXG5cdFx0Y29uc3QgY2xvc2VUaW1lRGF5cyA9IHBhcnNlSW50KHBvcHVwTWVzc2FnZS5kYXRhc2V0LmNsb3NlVGltZURheXMpIHx8IDA7XG5cdFx0Y29uc3QgY2xvc2VUaW1lSG91cnMgPVxuXHRcdFx0KHBhcnNlSW50KHBvcHVwTWVzc2FnZS5kYXRhc2V0LmNsb3NlVGltZUhvdXJzKSB8fCAwKSAvIDI0O1xuXHRcdC8vIE91ciBUb3RhbCBmb3Igd2hlbiB0aGUgY29va2llIHNob3VsZCBleHBpcmUgYW5kIHNob3cgdGhlIGJhbm5lciBhZ2FpblxuXHRcdGNvbnN0IGNvb2tpZURheVRvdGFsID0gY2xvc2VUaW1lRGF5cyArIGNsb3NlVGltZUhvdXJzO1xuXHRcdC8vIGRldGVybWluZXMgd2hldGhlciB0byBkaXNwbGF5IGEgcG9wdXBcblx0XHRwb3B1cERpc3BsYXkoXG5cdFx0XHRwb3B1cE1lc3NhZ2UsXG5cdFx0XHRjb29raWVEYXlUb3RhbCxcblx0XHRcdHBvcHVwU2hvd25Db29raWVOYW1lLFxuXHRcdFx0cG9wdXBWaXNpYmxlQ2xhc3MsXG5cdFx0XHRjaGVja1Nlc3Npb25DbGFzcyxcblx0XHRcdHZhbGlkYXRlZFNlc3Npb25DbGFzc1xuXHRcdCk7XG5cdH1cblxuXHQvLyBhbmFseXRpY3MgZXZlbnRzIGZvciBhbnkga2luZCBvZiBtZXNzYWdlIHRoYXQgaXMgZGlzcGxheWVkXG5cdGNvbnN0IG1lc3NhZ2VJdGVtcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXG5cdFx0Jy4nICsgbWVzc2FnZVNlbGVjdG9yICsgJzpub3QoIC4nICsgcG9wdXBTZWxlY3RvciArICcgKSdcblx0KTtcblx0aWYgKDAgPCBtZXNzYWdlSXRlbXMubGVuZ3RoKSB7XG5cdFx0bWVzc2FnZUl0ZW1zLmZvckVhY2goZnVuY3Rpb24gKGN1cnJlbnRNZXNzYWdlKSB7XG5cdFx0XHRtZXNzYWdlQW5hbHl0aWNzKGN1cnJlbnRNZXNzYWdlKTtcblx0XHR9KTtcblx0fVxufSk7XG4iXX0=
