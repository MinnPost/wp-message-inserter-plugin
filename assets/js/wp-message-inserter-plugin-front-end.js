;(function($) {
"use strict";

/**
 * Sets cookies
 *
 * @param {string} name
 * @param {string} value
 * @param {number} days
 */
function setCookie(name, value, days) {
  var d = new Date();
  d.setTime(d.getTime() + 86400000 * days);
  document.cookie = name + '=' + value + ';path=/;expires=' + d.toGMTString();
}
/**
 * Reads cookies
 *
 * @param {string} name
 */


function getCookie(name) {
  var v = document.cookie.match('(^|;) ?' + name + '=([^;]*)(;|$)');
  return v ? v[2] : null;
}
/**
 * Creating Analytics events
 *
 * @param {string} type
 * @param {string} category
 * @param {string} action
 * @param {string} label
 * @param {Array} value
 */


function analyticsTrackingEvent(type, category, action, label, value) {
  category = 'Site Message: ' + category.charAt(0).toUpperCase() + category.slice(1);

  if ('undefined' !== typeof ga) {
    if ('undefined' === typeof value) {
      ga('send', type, category, action, label);
    } else {
      ga('send', type, category, action, label, value);
    }
  } else {}
}
/**
 * Faux "Session" checking/setting
 *
 * @return {number} currentCount
 */


function setCurrentCount() {
  // Timestamp stored on the cookie
  var currentCount = getCookie('count');
  var timestamp = Math.floor(new Date().getTime() / 1000);
  var cookieExpiration = 30; // expire the cooke in 30 days

  if (!getCookie('count')) {
    // First Visit - set count to 1
    setCookie('count', 1, cookieExpiration); // Set a timecheck cookie for an hour from now

    setCookie('timecheck', timestamp + 3600, cookieExpiration);
  } else if (timestamp > getCookie('timecheck')) {
    // Update Timecheck to new value
    setCookie('timecheck', timestamp + 3600, cookieExpiration); // Count exists already and it has been an hour. Update count

    setCookie('count', ++currentCount, cookieExpiration);
  }

  var urlParams = new URLSearchParams(window.location.search);

  if (urlParams.get('count') !== null) {
    currentCount = parseInt(urlParams.get('count'));
  }

  return currentCount;
}
/**
 * Get the WordPress post ID for a given popup.
 *
 * @param {string} popupSelector
 * @return {number} postId
 */


function getPostId(popupSelector) {
  var postId = 0;
  var classList = $('.' + popupSelector).attr('class').split(/\s+/);
  $.each(classList, function (index, item) {
    if (0 < item.indexOf('message-id')) {
      postId = item.substring(item.lastIndexOf('-') + 1);
      return false; // break each and postId will be returned
    }
  });
  return postId;
}
/**
 * Get the region for a given message.
 *
 * @param {Object} message
 * @return {string} region
 */


function getMessageRegion(message) {
  var region = '';
  var classList = $(message).attr('class').split(/\s+/);
  $.each(classList, function (index, item) {
    if (0 < item.indexOf('message-region')) {
      region = item.substring(item.lastIndexOf('-') + 1);
      return false; // break each and region will be returned
    }
  });
  return region;
}
/**
 * Show a specific popup. Sets a cookie and adds a visibility class.
 *
 * @param {string} popupSelector
 * @param {number} cookieDayTotal
 * @param {string} popupShownCookieName
 * @param {string} popupVisibleClass
 */


function showPopup(popupSelector, cookieDayTotal, popupShownCookieName, popupVisibleClass) {
  var popupId = 0;
  setCookie(popupShownCookieName, 'true', cookieDayTotal);

  if (0 < $('.validated').length) {
    $('.' + popupSelector + '.validated').addClass(popupVisibleClass);
    popupId = getPostId(popupSelector + '.validated');
  } else {
    $('.' + popupSelector + ':first').addClass(popupVisibleClass);
    popupId = getPostId(popupSelector + ':first');
  }

  if (0 !== popupId) {
    analyticsTrackingEvent('event', 'Popup', 'Show', popupId, {
      nonInteraction: 1
    });
  }
}
/**
 * Show a specific popup. Sets a cookie and adds a visibility class.
 *
 * @param {string} popupSelector
 * @param {string} popupVisibleClass
 * @param {Object} lastFocus
 * @param {string} closeTrigger
 */


function hidePopup(popupSelector, popupVisibleClass, lastFocus, closeTrigger) {
  lastFocus.focus();
  $('.' + popupSelector).removeClass(popupVisibleClass);
  var popupId = getPostId(popupSelector);

  if (0 !== popupId) {
    analyticsTrackingEvent('event', 'Popup', closeTrigger, popupId, {
      nonInteraction: 1
    });
  }
}
/**
 * Display and controls for popups
 *
 * @param {string} popupSelector
 * @param {number} cookieDayTotal
 * @param {string} popupShownCookieName
 * @param {string} popupVisibleClass
 * @param {string} checkSessionClass
 */


function popupDisplay(popupSelector, cookieDayTotal, popupShownCookieName, popupVisibleClass, checkSessionClass) {
  var lastFocus = document.activeElement; // Check if we should be showing the popup

  if ('true' !== getCookie(popupShownCookieName) && !$('.' + popupSelector).hasClass(checkSessionClass)) {
    showPopup(popupSelector, cookieDayTotal, popupShownCookieName, popupVisibleClass);
  } // click on login link inside popup


  $('.' + popupSelector).on('click', '.message-login', function () {
    var url = $(this).attr('href');
    analyticsTrackingEvent('event', 'Popup', 'Login Link', url);
  });
  document.addEventListener('click', function (event) {
    if (!$(event.target).closest('.' + popupSelector).is('.' + popupSelector) && $('.' + popupSelector).hasClass(popupVisibleClass)) {
      hidePopup(popupSelector, popupVisibleClass, lastFocus, 'Click Outside to Close');
    }
  }, true); // popup close button

  $('.' + popupSelector).on('click', '.sm-close-btn', function (e) {
    e.preventDefault();
    hidePopup(popupSelector, popupVisibleClass, lastFocus, 'Close Button');
  }); // escape key press

  $(document).keyup(function (e) {
    if (27 === e.keyCode) {
      hidePopup(popupSelector, popupVisibleClass, lastFocus, 'Escape Key');
    }
  }); // click on a non-login or close link inside popup

  $('.' + popupSelector).on('click', 'a:not( .sm-close-btn, .message-login )', function () {
    var popupId = getPostId(popupSelector);
    analyticsTrackingEvent('event', 'Popup', 'Click', popupId);
  });
}

function messageAnalytics(message) {
  var messageRegion = getMessageRegion('.' + message);
  var messageId = getPostId(message);

  if ($('.' + message).is(':visible')) {
    analyticsTrackingEvent('event', messageRegion, 'Show', messageId, {
      nonInteraction: 1
    });
  } // click on login link inside a message


  $('.' + message).on('click', '.message-login', function () {
    var url = $(this).attr('href');
    analyticsTrackingEvent('event', messageRegion, 'Login Link', url);
  }); // click on a non-login or close link inside a message

  $('.' + message).on('click', 'a:not( .sm-close-btn, .message-login )', function () {
    analyticsTrackingEvent('event', messageRegion, 'Click', messageId);
  });
}
/**
 * When jQuery is loaded, set up session tracking and popup display
 *
 */


$(document).ready(function () {
  var popupSelector = 'wp-message-inserter-message-region-popup';
  var popupShownCookieName = 'sm-shown';
  var popupVisibleClass = 'wp-message-inserter-message-popup-visible';
  var checkSessionClass = 'check-session-message';
  var messageSelector = 'wp-message-inserter-message'; // Get our value for days and hours to set cookie

  var closeTimeDays = parseInt($('.' + popupSelector).data('close-time-days')) || 0;
  var closeTimeHours = (parseInt($('.' + popupSelector).data('close-time-hours')) || 0) / 24; // Our Total for when the cookie should expire and show the banner again

  var cookieDayTotal = closeTimeDays + closeTimeHours; // Session Validating and showing proper banner

  var operators = {
    gt: function gt(a, b) {
      return a >= b;
    },
    lt: function lt(a, b) {
      return a <= b;
    }
  };
  var currentCount = setCurrentCount();

  if (0 < $('.' + checkSessionClass).length) {
    $('.' + checkSessionClass).each(function () {
      var bannerSessionCount = parseInt($(this).data('session-count-to-check'));
      var bannerSessionOperator = $(this).data('session-count-operator');

      if (operators[bannerSessionOperator](currentCount, bannerSessionCount)) {
        if (!$(this).hasClass(popupSelector)) {
          $(this).addClass('validated');
        } else if (!getCookie(popupShownCookieName)) {
          $(this).addClass('validated');
        }
      }
    });
  }

  if (0 < $('.' + popupSelector).length) {
    popupDisplay(popupSelector, cookieDayTotal, popupShownCookieName, popupVisibleClass);
  }

  if (0 < $('.' + messageSelector + ':not( .' + popupSelector + ' )').length) {
    messageAnalytics(messageSelector + ':not( .' + popupSelector + ' )');
  }
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIjAxLW1lc3NhZ2VzLmpzIl0sIm5hbWVzIjpbInNldENvb2tpZSIsIm5hbWUiLCJ2YWx1ZSIsImRheXMiLCJkIiwiRGF0ZSIsInNldFRpbWUiLCJnZXRUaW1lIiwiZG9jdW1lbnQiLCJjb29raWUiLCJ0b0dNVFN0cmluZyIsImdldENvb2tpZSIsInYiLCJtYXRjaCIsImFuYWx5dGljc1RyYWNraW5nRXZlbnQiLCJ0eXBlIiwiY2F0ZWdvcnkiLCJhY3Rpb24iLCJsYWJlbCIsImNoYXJBdCIsInRvVXBwZXJDYXNlIiwic2xpY2UiLCJnYSIsInNldEN1cnJlbnRDb3VudCIsImN1cnJlbnRDb3VudCIsInRpbWVzdGFtcCIsIk1hdGgiLCJmbG9vciIsImNvb2tpZUV4cGlyYXRpb24iLCJ1cmxQYXJhbXMiLCJVUkxTZWFyY2hQYXJhbXMiLCJ3aW5kb3ciLCJsb2NhdGlvbiIsInNlYXJjaCIsImdldCIsInBhcnNlSW50IiwiZ2V0UG9zdElkIiwicG9wdXBTZWxlY3RvciIsInBvc3RJZCIsImNsYXNzTGlzdCIsIiQiLCJhdHRyIiwic3BsaXQiLCJlYWNoIiwiaW5kZXgiLCJpdGVtIiwiaW5kZXhPZiIsInN1YnN0cmluZyIsImxhc3RJbmRleE9mIiwiZ2V0TWVzc2FnZVJlZ2lvbiIsIm1lc3NhZ2UiLCJyZWdpb24iLCJzaG93UG9wdXAiLCJjb29raWVEYXlUb3RhbCIsInBvcHVwU2hvd25Db29raWVOYW1lIiwicG9wdXBWaXNpYmxlQ2xhc3MiLCJwb3B1cElkIiwibGVuZ3RoIiwiYWRkQ2xhc3MiLCJub25JbnRlcmFjdGlvbiIsImhpZGVQb3B1cCIsImxhc3RGb2N1cyIsImNsb3NlVHJpZ2dlciIsImZvY3VzIiwicmVtb3ZlQ2xhc3MiLCJwb3B1cERpc3BsYXkiLCJjaGVja1Nlc3Npb25DbGFzcyIsImFjdGl2ZUVsZW1lbnQiLCJoYXNDbGFzcyIsIm9uIiwidXJsIiwiYWRkRXZlbnRMaXN0ZW5lciIsImV2ZW50IiwidGFyZ2V0IiwiY2xvc2VzdCIsImlzIiwiZSIsInByZXZlbnREZWZhdWx0Iiwia2V5dXAiLCJrZXlDb2RlIiwibWVzc2FnZUFuYWx5dGljcyIsIm1lc3NhZ2VSZWdpb24iLCJtZXNzYWdlSWQiLCJyZWFkeSIsIm1lc3NhZ2VTZWxlY3RvciIsImNsb3NlVGltZURheXMiLCJkYXRhIiwiY2xvc2VUaW1lSG91cnMiLCJvcGVyYXRvcnMiLCJndCIsImEiLCJiIiwibHQiLCJiYW5uZXJTZXNzaW9uQ291bnQiLCJiYW5uZXJTZXNzaW9uT3BlcmF0b3IiXSwibWFwcGluZ3MiOiI7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTQSxTQUFULENBQW9CQyxJQUFwQixFQUEwQkMsS0FBMUIsRUFBaUNDLElBQWpDLEVBQXdDO0FBQ3ZDLE1BQU1DLENBQUMsR0FBRyxJQUFJQyxJQUFKLEVBQVY7QUFDQUQsRUFBQUEsQ0FBQyxDQUFDRSxPQUFGLENBQVdGLENBQUMsQ0FBQ0csT0FBRixLQUFjLFdBQVdKLElBQXBDO0FBQ0FLLEVBQUFBLFFBQVEsQ0FBQ0MsTUFBVCxHQUFrQlIsSUFBSSxHQUFHLEdBQVAsR0FBYUMsS0FBYixHQUFxQixrQkFBckIsR0FBMENFLENBQUMsQ0FBQ00sV0FBRixFQUE1RDtBQUNBO0FBRUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBQ0EsU0FBU0MsU0FBVCxDQUFvQlYsSUFBcEIsRUFBMkI7QUFDMUIsTUFBTVcsQ0FBQyxHQUFHSixRQUFRLENBQUNDLE1BQVQsQ0FBZ0JJLEtBQWhCLENBQXVCLFlBQVlaLElBQVosR0FBbUIsZUFBMUMsQ0FBVjtBQUNBLFNBQU9XLENBQUMsR0FBR0EsQ0FBQyxDQUFFLENBQUYsQ0FBSixHQUFZLElBQXBCO0FBQ0E7QUFFRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUNBLFNBQVNFLHNCQUFULENBQWlDQyxJQUFqQyxFQUF1Q0MsUUFBdkMsRUFBaURDLE1BQWpELEVBQXlEQyxLQUF6RCxFQUFnRWhCLEtBQWhFLEVBQXdFO0FBQ3ZFYyxFQUFBQSxR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Q1EsSUFBQUEsWUFBWSxDQUNYNUIsYUFEVyxFQUVYZ0IsY0FGVyxFQUdYQyxvQkFIVyxFQUlYQyxpQkFKVyxDQUFaO0FBTUE7O0FBRUQsTUFDQyxJQUFJZixDQUFDLENBQUUsTUFBTTRDLGVBQU4sR0FBd0IsU0FBeEIsR0FBb0MvQyxhQUFwQyxHQUFvRCxJQUF0RCxDQUFELENBQThEb0IsTUFEbkUsRUFFRTtBQUNEdUIsSUFBQUEsZ0JBQWdCLENBQUVJLGVBQWUsR0FBRyxTQUFsQixHQUE4Qi9DLGFBQTlCLEdBQThDLElBQWhELENBQWhCO0FBQ0E7QUFDRCxDQWpFRCIsImZpbGUiOiJ3cC1tZXNzYWdlLWluc2VydGVyLXBsdWdpbi1mcm9udC1lbmQuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFNldHMgY29va2llc1xuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBuYW1lXG4gKiBAcGFyYW0ge3N0cmluZ30gdmFsdWVcbiAqIEBwYXJhbSB7bnVtYmVyfSBkYXlzXG4gKi9cbmZ1bmN0aW9uIHNldENvb2tpZSggbmFtZSwgdmFsdWUsIGRheXMgKSB7XG5cdGNvbnN0IGQgPSBuZXcgRGF0ZSgpO1xuXHRkLnNldFRpbWUoIGQuZ2V0VGltZSgpICsgODY0MDAwMDAgKiBkYXlzICk7XG5cdGRvY3VtZW50LmNvb2tpZSA9IG5hbWUgKyAnPScgKyB2YWx1ZSArICc7cGF0aD0vO2V4cGlyZXM9JyArIGQudG9HTVRTdHJpbmcoKTtcbn1cblxuLyoqXG4gKiBSZWFkcyBjb29raWVzXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IG5hbWVcbiAqL1xuZnVuY3Rpb24gZ2V0Q29va2llKCBuYW1lICkge1xuXHRjb25zdCB2ID0gZG9jdW1lbnQuY29va2llLm1hdGNoKCAnKF58OykgPycgKyBuYW1lICsgJz0oW147XSopKDt8JCknICk7XG5cdHJldHVybiB2ID8gdlsgMiBdIDogbnVsbDtcbn1cblxuLyoqXG4gKiBDcmVhdGluZyBBbmFseXRpY3MgZXZlbnRzXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IHR5cGVcbiAqIEBwYXJhbSB7c3RyaW5nfSBjYXRlZ29yeVxuICogQHBhcmFtIHtzdHJpbmd9IGFjdGlvblxuICogQHBhcmFtIHtzdHJpbmd9IGxhYmVsXG4gKiBAcGFyYW0ge0FycmF5fSB2YWx1ZVxuICovXG5mdW5jdGlvbiBhbmFseXRpY3NUcmFja2luZ0V2ZW50KCB0eXBlLCBjYXRlZ29yeSwgYWN0aW9uLCBsYWJlbCwgdmFsdWUgKSB7XG5cdGNhdGVnb3J5ID1cblx0XHQnU2l0ZSBNZXNzYWdlOiAnICtcblx0XHRjYXRlZ29yeS5jaGFyQXQoIDAgKS50b1VwcGVyQ2FzZSgpICtcblx0XHRjYXRlZ29yeS5zbGljZSggMSApO1xuXHRpZiAoICd1bmRlZmluZWQnICE9PSB0eXBlb2YgZ2EgKSB7XG5cdFx0aWYgKCAndW5kZWZpbmVkJyA9PT0gdHlwZW9mIHZhbHVlICkge1xuXHRcdFx0Z2EoICdzZW5kJywgdHlwZSwgY2F0ZWdvcnksIGFjdGlvbiwgbGFiZWwgKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0Z2EoICdzZW5kJywgdHlwZSwgY2F0ZWdvcnksIGFjdGlvbiwgbGFiZWwsIHZhbHVlICk7XG5cdFx0fVxuXHR9IGVsc2Uge1xuXHR9XG59XG5cbi8qKlxuICogRmF1eCBcIlNlc3Npb25cIiBjaGVja2luZy9zZXR0aW5nXG4gKlxuICogQHJldHVybiB7bnVtYmVyfSBjdXJyZW50Q291bnRcbiAqL1xuZnVuY3Rpb24gc2V0Q3VycmVudENvdW50KCkge1xuXHQvLyBUaW1lc3RhbXAgc3RvcmVkIG9uIHRoZSBjb29raWVcblx0bGV0IGN1cnJlbnRDb3VudCA9IGdldENvb2tpZSggJ2NvdW50JyApO1xuXHRjb25zdCB0aW1lc3RhbXAgPSBNYXRoLmZsb29yKCBuZXcgRGF0ZSgpLmdldFRpbWUoKSAvIDEwMDAgKTtcblx0Y29uc3QgY29va2llRXhwaXJhdGlvbiA9IDMwOyAvLyBleHBpcmUgdGhlIGNvb2tlIGluIDMwIGRheXNcblx0aWYgKCAhIGdldENvb2tpZSggJ2NvdW50JyApICkge1xuXHRcdC8vIEZpcnN0IFZpc2l0IC0gc2V0IGNvdW50IHRvIDFcblx0XHRzZXRDb29raWUoICdjb3VudCcsIDEsIGNvb2tpZUV4cGlyYXRpb24gKTtcblx0XHQvLyBTZXQgYSB0aW1lY2hlY2sgY29va2llIGZvciBhbiBob3VyIGZyb20gbm93XG5cdFx0c2V0Q29va2llKCAndGltZWNoZWNrJywgdGltZXN0YW1wICsgMzYwMCwgY29va2llRXhwaXJhdGlvbiApO1xuXHR9IGVsc2UgaWYgKCB0aW1lc3RhbXAgPiBnZXRDb29raWUoICd0aW1lY2hlY2snICkgKSB7XG5cdFx0Ly8gVXBkYXRlIFRpbWVjaGVjayB0byBuZXcgdmFsdWVcblx0XHRzZXRDb29raWUoICd0aW1lY2hlY2snLCB0aW1lc3RhbXAgKyAzNjAwLCBjb29raWVFeHBpcmF0aW9uICk7XG5cdFx0Ly8gQ291bnQgZXhpc3RzIGFscmVhZHkgYW5kIGl0IGhhcyBiZWVuIGFuIGhvdXIuIFVwZGF0ZSBjb3VudFxuXHRcdHNldENvb2tpZSggJ2NvdW50JywgKytjdXJyZW50Q291bnQsIGNvb2tpZUV4cGlyYXRpb24gKTtcblx0fVxuXHRjb25zdCB1cmxQYXJhbXMgPSBuZXcgVVJMU2VhcmNoUGFyYW1zKCB3aW5kb3cubG9jYXRpb24uc2VhcmNoICk7XG5cdGlmICggdXJsUGFyYW1zLmdldCggJ2NvdW50JyApICE9PSBudWxsICkge1xuXHRcdGN1cnJlbnRDb3VudCA9IHBhcnNlSW50KCB1cmxQYXJhbXMuZ2V0KCAnY291bnQnICkgKTtcblx0fVxuXHRyZXR1cm4gY3VycmVudENvdW50O1xufVxuXG4vKipcbiAqIEdldCB0aGUgV29yZFByZXNzIHBvc3QgSUQgZm9yIGEgZ2l2ZW4gcG9wdXAuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IHBvcHVwU2VsZWN0b3JcbiAqIEByZXR1cm4ge251bWJlcn0gcG9zdElkXG4gKi9cbmZ1bmN0aW9uIGdldFBvc3RJZCggcG9wdXBTZWxlY3RvciApIHtcblx0bGV0IHBvc3RJZCA9IDA7XG5cdGNvbnN0IGNsYXNzTGlzdCA9ICQoICcuJyArIHBvcHVwU2VsZWN0b3IgKVxuXHRcdC5hdHRyKCAnY2xhc3MnIClcblx0XHQuc3BsaXQoIC9cXHMrLyApO1xuXHQkLmVhY2goIGNsYXNzTGlzdCwgZnVuY3Rpb24gKCBpbmRleCwgaXRlbSApIHtcblx0XHRpZiAoIDAgPCBpdGVtLmluZGV4T2YoICdtZXNzYWdlLWlkJyApICkge1xuXHRcdFx0cG9zdElkID0gaXRlbS5zdWJzdHJpbmcoIGl0ZW0ubGFzdEluZGV4T2YoICctJyApICsgMSApO1xuXHRcdFx0cmV0dXJuIGZhbHNlOyAvLyBicmVhayBlYWNoIGFuZCBwb3N0SWQgd2lsbCBiZSByZXR1cm5lZFxuXHRcdH1cblx0fSApO1xuXHRyZXR1cm4gcG9zdElkO1xufVxuXG4vKipcbiAqIEdldCB0aGUgcmVnaW9uIGZvciBhIGdpdmVuIG1lc3NhZ2UuXG4gKlxuICogQHBhcmFtIHtPYmplY3R9IG1lc3NhZ2VcbiAqIEByZXR1cm4ge3N0cmluZ30gcmVnaW9uXG4gKi9cbmZ1bmN0aW9uIGdldE1lc3NhZ2VSZWdpb24oIG1lc3NhZ2UgKSB7XG5cdGxldCByZWdpb24gPSAnJztcblx0Y29uc3QgY2xhc3NMaXN0ID0gJCggbWVzc2FnZSApLmF0dHIoICdjbGFzcycgKS5zcGxpdCggL1xccysvICk7XG5cdCQuZWFjaCggY2xhc3NMaXN0LCBmdW5jdGlvbiAoIGluZGV4LCBpdGVtICkge1xuXHRcdGlmICggMCA8IGl0ZW0uaW5kZXhPZiggJ21lc3NhZ2UtcmVnaW9uJyApICkge1xuXHRcdFx0cmVnaW9uID0gaXRlbS5zdWJzdHJpbmcoIGl0ZW0ubGFzdEluZGV4T2YoICctJyApICsgMSApO1xuXHRcdFx0cmV0dXJuIGZhbHNlOyAvLyBicmVhayBlYWNoIGFuZCByZWdpb24gd2lsbCBiZSByZXR1cm5lZFxuXHRcdH1cblx0fSApO1xuXHRyZXR1cm4gcmVnaW9uO1xufVxuXG4vKipcbiAqIFNob3cgYSBzcGVjaWZpYyBwb3B1cC4gU2V0cyBhIGNvb2tpZSBhbmQgYWRkcyBhIHZpc2liaWxpdHkgY2xhc3MuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IHBvcHVwU2VsZWN0b3JcbiAqIEBwYXJhbSB7bnVtYmVyfSBjb29raWVEYXlUb3RhbFxuICogQHBhcmFtIHtzdHJpbmd9IHBvcHVwU2hvd25Db29raWVOYW1lXG4gKiBAcGFyYW0ge3N0cmluZ30gcG9wdXBWaXNpYmxlQ2xhc3NcbiAqL1xuZnVuY3Rpb24gc2hvd1BvcHVwKFxuXHRwb3B1cFNlbGVjdG9yLFxuXHRjb29raWVEYXlUb3RhbCxcblx0cG9wdXBTaG93bkNvb2tpZU5hbWUsXG5cdHBvcHVwVmlzaWJsZUNsYXNzXG4pIHtcblx0bGV0IHBvcHVwSWQgPSAwO1xuXHRzZXRDb29raWUoIHBvcHVwU2hvd25Db29raWVOYW1lLCAndHJ1ZScsIGNvb2tpZURheVRvdGFsICk7XG5cdGlmICggMCA8ICQoICcudmFsaWRhdGVkJyApLmxlbmd0aCApIHtcblx0XHQkKCAnLicgKyBwb3B1cFNlbGVjdG9yICsgJy52YWxpZGF0ZWQnICkuYWRkQ2xhc3MoIHBvcHVwVmlzaWJsZUNsYXNzICk7XG5cdFx0cG9wdXBJZCA9IGdldFBvc3RJZCggcG9wdXBTZWxlY3RvciArICcudmFsaWRhdGVkJyApO1xuXHR9IGVsc2Uge1xuXHRcdCQoICcuJyArIHBvcHVwU2VsZWN0b3IgKyAnOmZpcnN0JyApLmFkZENsYXNzKCBwb3B1cFZpc2libGVDbGFzcyApO1xuXHRcdHBvcHVwSWQgPSBnZXRQb3N0SWQoIHBvcHVwU2VsZWN0b3IgKyAnOmZpcnN0JyApO1xuXHR9XG5cdGlmICggMCAhPT0gcG9wdXBJZCApIHtcblx0XHRhbmFseXRpY3NUcmFja2luZ0V2ZW50KCAnZXZlbnQnLCAnUG9wdXAnLCAnU2hvdycsIHBvcHVwSWQsIHtcblx0XHRcdG5vbkludGVyYWN0aW9uOiAxLFxuXHRcdH0gKTtcblx0fVxufVxuXG4vKipcbiAqIFNob3cgYSBzcGVjaWZpYyBwb3B1cC4gU2V0cyBhIGNvb2tpZSBhbmQgYWRkcyBhIHZpc2liaWxpdHkgY2xhc3MuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IHBvcHVwU2VsZWN0b3JcbiAqIEBwYXJhbSB7c3RyaW5nfSBwb3B1cFZpc2libGVDbGFzc1xuICogQHBhcmFtIHtPYmplY3R9IGxhc3RGb2N1c1xuICogQHBhcmFtIHtzdHJpbmd9IGNsb3NlVHJpZ2dlclxuICovXG5mdW5jdGlvbiBoaWRlUG9wdXAoXG5cdHBvcHVwU2VsZWN0b3IsXG5cdHBvcHVwVmlzaWJsZUNsYXNzLFxuXHRsYXN0Rm9jdXMsXG5cdGNsb3NlVHJpZ2dlclxuKSB7XG5cdGxhc3RGb2N1cy5mb2N1cygpO1xuXHQkKCAnLicgKyBwb3B1cFNlbGVjdG9yICkucmVtb3ZlQ2xhc3MoIHBvcHVwVmlzaWJsZUNsYXNzICk7XG5cdGNvbnN0IHBvcHVwSWQgPSBnZXRQb3N0SWQoIHBvcHVwU2VsZWN0b3IgKTtcblx0aWYgKCAwICE9PSBwb3B1cElkICkge1xuXHRcdGFuYWx5dGljc1RyYWNraW5nRXZlbnQoICdldmVudCcsICdQb3B1cCcsIGNsb3NlVHJpZ2dlciwgcG9wdXBJZCwge1xuXHRcdFx0bm9uSW50ZXJhY3Rpb246IDEsXG5cdFx0fSApO1xuXHR9XG59XG5cbi8qKlxuICogRGlzcGxheSBhbmQgY29udHJvbHMgZm9yIHBvcHVwc1xuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBwb3B1cFNlbGVjdG9yXG4gKiBAcGFyYW0ge251bWJlcn0gY29va2llRGF5VG90YWxcbiAqIEBwYXJhbSB7c3RyaW5nfSBwb3B1cFNob3duQ29va2llTmFtZVxuICogQHBhcmFtIHtzdHJpbmd9IHBvcHVwVmlzaWJsZUNsYXNzXG4gKiBAcGFyYW0ge3N0cmluZ30gY2hlY2tTZXNzaW9uQ2xhc3NcbiAqL1xuZnVuY3Rpb24gcG9wdXBEaXNwbGF5KFxuXHRwb3B1cFNlbGVjdG9yLFxuXHRjb29raWVEYXlUb3RhbCxcblx0cG9wdXBTaG93bkNvb2tpZU5hbWUsXG5cdHBvcHVwVmlzaWJsZUNsYXNzLFxuXHRjaGVja1Nlc3Npb25DbGFzc1xuKSB7XG5cdGNvbnN0IGxhc3RGb2N1cyA9IGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQ7XG5cdC8vIENoZWNrIGlmIHdlIHNob3VsZCBiZSBzaG93aW5nIHRoZSBwb3B1cFxuXHRpZiAoXG5cdFx0J3RydWUnICE9PSBnZXRDb29raWUoIHBvcHVwU2hvd25Db29raWVOYW1lICkgJiZcblx0XHQhICQoICcuJyArIHBvcHVwU2VsZWN0b3IgKS5oYXNDbGFzcyggY2hlY2tTZXNzaW9uQ2xhc3MgKVxuXHQpIHtcblx0XHRzaG93UG9wdXAoXG5cdFx0XHRwb3B1cFNlbGVjdG9yLFxuXHRcdFx0Y29va2llRGF5VG90YWwsXG5cdFx0XHRwb3B1cFNob3duQ29va2llTmFtZSxcblx0XHRcdHBvcHVwVmlzaWJsZUNsYXNzXG5cdFx0KTtcblx0fVxuXG5cdC8vIGNsaWNrIG9uIGxvZ2luIGxpbmsgaW5zaWRlIHBvcHVwXG5cdCQoICcuJyArIHBvcHVwU2VsZWN0b3IgKS5vbiggJ2NsaWNrJywgJy5tZXNzYWdlLWxvZ2luJywgZnVuY3Rpb24gKCkge1xuXHRcdGNvbnN0IHVybCA9ICQoIHRoaXMgKS5hdHRyKCAnaHJlZicgKTtcblx0XHRhbmFseXRpY3NUcmFja2luZ0V2ZW50KCAnZXZlbnQnLCAnUG9wdXAnLCAnTG9naW4gTGluaycsIHVybCApO1xuXHR9ICk7XG5cblx0ZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcblx0XHQnY2xpY2snLFxuXHRcdGZ1bmN0aW9uICggZXZlbnQgKSB7XG5cdFx0XHRpZiAoXG5cdFx0XHRcdCEgJCggZXZlbnQudGFyZ2V0IClcblx0XHRcdFx0XHQuY2xvc2VzdCggJy4nICsgcG9wdXBTZWxlY3RvciApXG5cdFx0XHRcdFx0LmlzKCAnLicgKyBwb3B1cFNlbGVjdG9yICkgJiZcblx0XHRcdFx0JCggJy4nICsgcG9wdXBTZWxlY3RvciApLmhhc0NsYXNzKCBwb3B1cFZpc2libGVDbGFzcyApXG5cdFx0XHQpIHtcblx0XHRcdFx0aGlkZVBvcHVwKFxuXHRcdFx0XHRcdHBvcHVwU2VsZWN0b3IsXG5cdFx0XHRcdFx0cG9wdXBWaXNpYmxlQ2xhc3MsXG5cdFx0XHRcdFx0bGFzdEZvY3VzLFxuXHRcdFx0XHRcdCdDbGljayBPdXRzaWRlIHRvIENsb3NlJ1xuXHRcdFx0XHQpO1xuXHRcdFx0fVxuXHRcdH0sXG5cdFx0dHJ1ZVxuXHQpO1xuXG5cdC8vIHBvcHVwIGNsb3NlIGJ1dHRvblxuXHQkKCAnLicgKyBwb3B1cFNlbGVjdG9yICkub24oICdjbGljaycsICcuc20tY2xvc2UtYnRuJywgZnVuY3Rpb24gKCBlICkge1xuXHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRoaWRlUG9wdXAoXG5cdFx0XHRwb3B1cFNlbGVjdG9yLFxuXHRcdFx0cG9wdXBWaXNpYmxlQ2xhc3MsXG5cdFx0XHRsYXN0Rm9jdXMsXG5cdFx0XHQnQ2xvc2UgQnV0dG9uJ1xuXHRcdCk7XG5cdH0gKTtcblxuXHQvLyBlc2NhcGUga2V5IHByZXNzXG5cdCQoIGRvY3VtZW50ICkua2V5dXAoIGZ1bmN0aW9uICggZSApIHtcblx0XHRpZiAoIDI3ID09PSBlLmtleUNvZGUgKSB7XG5cdFx0XHRoaWRlUG9wdXAoXG5cdFx0XHRcdHBvcHVwU2VsZWN0b3IsXG5cdFx0XHRcdHBvcHVwVmlzaWJsZUNsYXNzLFxuXHRcdFx0XHRsYXN0Rm9jdXMsXG5cdFx0XHRcdCdFc2NhcGUgS2V5J1xuXHRcdFx0KTtcblx0XHR9XG5cdH0gKTtcblxuXHQvLyBjbGljayBvbiBhIG5vbi1sb2dpbiBvciBjbG9zZSBsaW5rIGluc2lkZSBwb3B1cFxuXHQkKCAnLicgKyBwb3B1cFNlbGVjdG9yICkub24oXG5cdFx0J2NsaWNrJyxcblx0XHQnYTpub3QoIC5zbS1jbG9zZS1idG4sIC5tZXNzYWdlLWxvZ2luICknLFxuXHRcdGZ1bmN0aW9uICgpIHtcblx0XHRcdGNvbnN0IHBvcHVwSWQgPSBnZXRQb3N0SWQoIHBvcHVwU2VsZWN0b3IgKTtcblx0XHRcdGFuYWx5dGljc1RyYWNraW5nRXZlbnQoICdldmVudCcsICdQb3B1cCcsICdDbGljaycsIHBvcHVwSWQgKTtcblx0XHR9XG5cdCk7XG59XG5cbmZ1bmN0aW9uIG1lc3NhZ2VBbmFseXRpY3MoIG1lc3NhZ2UgKSB7XG5cdGNvbnN0IG1lc3NhZ2VSZWdpb24gPSBnZXRNZXNzYWdlUmVnaW9uKCAnLicgKyBtZXNzYWdlICk7XG5cdGNvbnN0IG1lc3NhZ2VJZCA9IGdldFBvc3RJZCggbWVzc2FnZSApO1xuXHRpZiAoICQoICcuJyArIG1lc3NhZ2UgKS5pcyggJzp2aXNpYmxlJyApICkge1xuXHRcdGFuYWx5dGljc1RyYWNraW5nRXZlbnQoICdldmVudCcsIG1lc3NhZ2VSZWdpb24sICdTaG93JywgbWVzc2FnZUlkLCB7XG5cdFx0XHRub25JbnRlcmFjdGlvbjogMSxcblx0XHR9ICk7XG5cdH1cblx0Ly8gY2xpY2sgb24gbG9naW4gbGluayBpbnNpZGUgYSBtZXNzYWdlXG5cdCQoICcuJyArIG1lc3NhZ2UgKS5vbiggJ2NsaWNrJywgJy5tZXNzYWdlLWxvZ2luJywgZnVuY3Rpb24gKCkge1xuXHRcdGNvbnN0IHVybCA9ICQoIHRoaXMgKS5hdHRyKCAnaHJlZicgKTtcblx0XHRhbmFseXRpY3NUcmFja2luZ0V2ZW50KCAnZXZlbnQnLCBtZXNzYWdlUmVnaW9uLCAnTG9naW4gTGluaycsIHVybCApO1xuXHR9ICk7XG5cblx0Ly8gY2xpY2sgb24gYSBub24tbG9naW4gb3IgY2xvc2UgbGluayBpbnNpZGUgYSBtZXNzYWdlXG5cdCQoICcuJyArIG1lc3NhZ2UgKS5vbihcblx0XHQnY2xpY2snLFxuXHRcdCdhOm5vdCggLnNtLWNsb3NlLWJ0biwgLm1lc3NhZ2UtbG9naW4gKScsXG5cdFx0ZnVuY3Rpb24gKCkge1xuXHRcdFx0YW5hbHl0aWNzVHJhY2tpbmdFdmVudChcblx0XHRcdFx0J2V2ZW50Jyxcblx0XHRcdFx0bWVzc2FnZVJlZ2lvbixcblx0XHRcdFx0J0NsaWNrJyxcblx0XHRcdFx0bWVzc2FnZUlkXG5cdFx0XHQpO1xuXHRcdH1cblx0KTtcbn1cblxuLyoqXG4gKiBXaGVuIGpRdWVyeSBpcyBsb2FkZWQsIHNldCB1cCBzZXNzaW9uIHRyYWNraW5nIGFuZCBwb3B1cCBkaXNwbGF5XG4gKlxuICovXG4kKCBkb2N1bWVudCApLnJlYWR5KCBmdW5jdGlvbiAoKSB7XG5cdGNvbnN0IHBvcHVwU2VsZWN0b3IgPSAnd3AtbWVzc2FnZS1pbnNlcnRlci1tZXNzYWdlLXJlZ2lvbi1wb3B1cCc7XG5cdGNvbnN0IHBvcHVwU2hvd25Db29raWVOYW1lID0gJ3NtLXNob3duJztcblx0Y29uc3QgcG9wdXBWaXNpYmxlQ2xhc3MgPSAnd3AtbWVzc2FnZS1pbnNlcnRlci1tZXNzYWdlLXBvcHVwLXZpc2libGUnO1xuXHRjb25zdCBjaGVja1Nlc3Npb25DbGFzcyA9ICdjaGVjay1zZXNzaW9uLW1lc3NhZ2UnO1xuXHRjb25zdCBtZXNzYWdlU2VsZWN0b3IgPSAnd3AtbWVzc2FnZS1pbnNlcnRlci1tZXNzYWdlJztcblxuXHQvLyBHZXQgb3VyIHZhbHVlIGZvciBkYXlzIGFuZCBob3VycyB0byBzZXQgY29va2llXG5cdGNvbnN0IGNsb3NlVGltZURheXMgPVxuXHRcdHBhcnNlSW50KCAkKCAnLicgKyBwb3B1cFNlbGVjdG9yICkuZGF0YSggJ2Nsb3NlLXRpbWUtZGF5cycgKSApIHx8IDA7XG5cdGNvbnN0IGNsb3NlVGltZUhvdXJzID1cblx0XHQoIHBhcnNlSW50KCAkKCAnLicgKyBwb3B1cFNlbGVjdG9yICkuZGF0YSggJ2Nsb3NlLXRpbWUtaG91cnMnICkgKSB8fFxuXHRcdFx0MCApIC8gMjQ7XG5cdC8vIE91ciBUb3RhbCBmb3Igd2hlbiB0aGUgY29va2llIHNob3VsZCBleHBpcmUgYW5kIHNob3cgdGhlIGJhbm5lciBhZ2FpblxuXHRjb25zdCBjb29raWVEYXlUb3RhbCA9IGNsb3NlVGltZURheXMgKyBjbG9zZVRpbWVIb3VycztcblxuXHQvLyBTZXNzaW9uIFZhbGlkYXRpbmcgYW5kIHNob3dpbmcgcHJvcGVyIGJhbm5lclxuXHRjb25zdCBvcGVyYXRvcnMgPSB7XG5cdFx0Z3QoIGEsIGIgKSB7XG5cdFx0XHRyZXR1cm4gYSA+PSBiO1xuXHRcdH0sXG5cdFx0bHQoIGEsIGIgKSB7XG5cdFx0XHRyZXR1cm4gYSA8PSBiO1xuXHRcdH0sXG5cdH07XG5cblx0Y29uc3QgY3VycmVudENvdW50ID0gc2V0Q3VycmVudENvdW50KCk7XG5cblx0aWYgKCAwIDwgJCggJy4nICsgY2hlY2tTZXNzaW9uQ2xhc3MgKS5sZW5ndGggKSB7XG5cdFx0JCggJy4nICsgY2hlY2tTZXNzaW9uQ2xhc3MgKS5lYWNoKCBmdW5jdGlvbiAoKSB7XG5cdFx0XHRjb25zdCBiYW5uZXJTZXNzaW9uQ291bnQgPSBwYXJzZUludChcblx0XHRcdFx0JCggdGhpcyApLmRhdGEoICdzZXNzaW9uLWNvdW50LXRvLWNoZWNrJyApXG5cdFx0XHQpO1xuXHRcdFx0Y29uc3QgYmFubmVyU2Vzc2lvbk9wZXJhdG9yID0gJCggdGhpcyApLmRhdGEoXG5cdFx0XHRcdCdzZXNzaW9uLWNvdW50LW9wZXJhdG9yJ1xuXHRcdFx0KTtcblx0XHRcdGlmIChcblx0XHRcdFx0b3BlcmF0b3JzWyBiYW5uZXJTZXNzaW9uT3BlcmF0b3IgXShcblx0XHRcdFx0XHRjdXJyZW50Q291bnQsXG5cdFx0XHRcdFx0YmFubmVyU2Vzc2lvbkNvdW50XG5cdFx0XHRcdClcblx0XHRcdCkge1xuXHRcdFx0XHRpZiAoICEgJCggdGhpcyApLmhhc0NsYXNzKCBwb3B1cFNlbGVjdG9yICkgKSB7XG5cdFx0XHRcdFx0JCggdGhpcyApLmFkZENsYXNzKCAndmFsaWRhdGVkJyApO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCAhIGdldENvb2tpZSggcG9wdXBTaG93bkNvb2tpZU5hbWUgKSApIHtcblx0XHRcdFx0XHQkKCB0aGlzICkuYWRkQ2xhc3MoICd2YWxpZGF0ZWQnICk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9ICk7XG5cdH1cblxuXHRpZiAoIDAgPCAkKCAnLicgKyBwb3B1cFNlbGVjdG9yICkubGVuZ3RoICkge1xuXHRcdHBvcHVwRGlzcGxheShcblx0XHRcdHBvcHVwU2VsZWN0b3IsXG5cdFx0XHRjb29raWVEYXlUb3RhbCxcblx0XHRcdHBvcHVwU2hvd25Db29raWVOYW1lLFxuXHRcdFx0cG9wdXBWaXNpYmxlQ2xhc3Ncblx0XHQpO1xuXHR9XG5cblx0aWYgKFxuXHRcdDAgPCAkKCAnLicgKyBtZXNzYWdlU2VsZWN0b3IgKyAnOm5vdCggLicgKyBwb3B1cFNlbGVjdG9yICsgJyApJyApLmxlbmd0aFxuXHQpIHtcblx0XHRtZXNzYWdlQW5hbHl0aWNzKCBtZXNzYWdlU2VsZWN0b3IgKyAnOm5vdCggLicgKyBwb3B1cFNlbGVjdG9yICsgJyApJyApO1xuXHR9XG59ICk7XG4iXX0=
}(jQuery));
