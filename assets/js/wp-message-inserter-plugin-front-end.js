;(function($) {
"use strict";

/**
 * Sets cookies
 *
 * @param {string} name
 * @param {string} value
 * @param {number} days
 */
function setCookie(name, value, days) {
  var d = new Date();
  d.setTime(d.getTime() + 86400000 * days);
  document.cookie = name + '=' + value + ';path=/;expires=' + d.toGMTString();
}
/**
 * Reads cookies
 *
 * @param {string} name
 */


function getCookie(name) {
  var v = document.cookie.match('(^|;) ?' + name + '=([^;]*)(;|$)');
  return v ? v[2] : null;
}
/**
 * Creating Analytics events
 *
 * @param {string} type
 * @param {string} category
 * @param {string} action
 * @param {string} label
 * @param {Array} value
 */


function analyticsTrackingEvent(type, category, action, label, value) {
  category = 'Site Message: ' + category.charAt(0).toUpperCase() + category.slice(1);

  if ('undefined' !== typeof ga) {
    if ('undefined' === typeof value) {
      ga('send', type, category, action, label);
    } else {
      ga('send', type, category, action, label, value);
    }
  } else {}
}
/**
 * Faux "Session" checking/setting
 *
 * @return {number} currentCount
 */


function setCurrentCount() {
  // Timestamp stored on the cookie
  var currentCount = getCookie('count');
  var timestamp = Math.floor(new Date().getTime() / 1000);
  var cookieExpiration = 30; // expire the cooke in 30 days

  if (!getCookie('count')) {
    // First Visit - set count to 1
    setCookie('count', 1, cookieExpiration); // Set a timecheck cookie for an hour from now

    setCookie('timecheck', timestamp + 3600, cookieExpiration);
  } else if (timestamp > getCookie('timecheck')) {
    // Update Timecheck to new value
    setCookie('timecheck', timestamp + 3600, cookieExpiration); // Count exists already and it has been an hour. Update count

    setCookie('count', ++currentCount, cookieExpiration);
  }

  var urlParams = new URLSearchParams(window.location.search);

  if (urlParams.get('count') !== null) {
    currentCount = parseInt(urlParams.get('count'));
  }

  return currentCount;
}
/**
 * Get the WordPress post ID for a given popup.
 *
 * @param {string} popupSelector
 * @return {number} postId
 */


function getPostId(popupSelector) {
  var postId = 0;
  var classList = $('.' + popupSelector).attr('class').split(/\s+/);
  $.each(classList, function (index, item) {
    if (0 < item.indexOf('message-id')) {
      postId = item.substring(item.lastIndexOf('-') + 1);
      return false; // break each and postId will be returned
    }
  });
  return postId;
}
/**
 * Get the region for a given message.
 *
 * @param {object} message
 * @return {string} region
 */


function getMessageRegion(message) {
  var region = '';
  var classList = $(message).attr('class').split(/\s+/);
  $.each(classList, function (index, item) {
    if (0 < item.indexOf('message-region')) {
      region = item.substring(item.lastIndexOf('-') + 1);
      return false; // break each and region will be returned
    }
  });
  return region;
}
/**
 * Show a specific popup. Sets a cookie and adds a visibility class.
 *
 * @param {string} popupSelector
 * @param {number} cookieDayTotal
 * @param {string} popupShownCookieName
 * @param {string} popupVisibleClass
 */


function showPopup(popupSelector, cookieDayTotal, popupShownCookieName, popupVisibleClass) {
  var popupId = 0;
  setCookie(popupShownCookieName, 'true', cookieDayTotal);

  if (0 < $('.validated').length) {
    $('.' + popupSelector + '.validated').addClass(popupVisibleClass);
    popupId = getPostId(popupSelector + '.validated');
  } else {
    $('.' + popupSelector + ':first').addClass(popupVisibleClass);
    popupId = getPostId(popupSelector + ':first');
  }

  if (0 !== popupId) {
    analyticsTrackingEvent('event', 'Popup', 'Show', popupId, {
      nonInteraction: 1
    });
  }
}
/**
 * Show a specific popup. Sets a cookie and adds a visibility class.
 *
 * @param {string} popupSelector
 * @param {string} popupVisibleClass
 * @param {Object} lastFocus
 * @param {string} closeTrigger
 */


function hidePopup(popupSelector, popupVisibleClass, lastFocus, closeTrigger) {
  lastFocus.focus();
  $('.' + popupSelector).removeClass(popupVisibleClass);
  var popupId = getPostId(popupSelector);

  if (0 !== popupId) {
    analyticsTrackingEvent('event', 'Popup', closeTrigger, popupId, {
      nonInteraction: 1
    });
  }
}
/**
 * Display and controls for popups
 *
 * @param {string} popupSelector
 * @param {number} cookieDayTotal
 * @param {string} popupShownCookieName
 * @param {string} popupVisibleClass
 * @param {string} checkSessionClass
 */


function popupDisplay(popupSelector, cookieDayTotal, popupShownCookieName, popupVisibleClass, checkSessionClass) {
  var lastFocus = document.activeElement; // put in a close button at the end

  $('.' + popupSelector + ' .m-wp-insert-message-item').append('<a href="#" class="sm-close-btn" aria-label="Close"><i class="fas fa-times" aria-hidden="true"></i></a>'); // Check if we should be showing the popup

  if ('true' !== getCookie(popupShownCookieName) && !$('.' + popupSelector).hasClass(checkSessionClass)) {
    showPopup(popupSelector, cookieDayTotal, popupShownCookieName, popupVisibleClass);
  } // click on login link inside popup


  $('.' + popupSelector).on('click', '.message-login', function () {
    var url = $(this).attr('href');
    analyticsTrackingEvent('event', 'Popup', 'Login Link', url);
  });
  document.addEventListener('click', function (event) {
    if (!$(event.target).closest('.' + popupSelector).is('.' + popupSelector) && $('.' + popupSelector).hasClass(popupVisibleClass)) {
      hidePopup(popupSelector, popupVisibleClass, lastFocus, 'Click Outside to Close');
    }
  }, true); // popup close button

  $('.' + popupSelector).on('click', '.sm-close-btn', function (e) {
    e.preventDefault();
    hidePopup(popupSelector, popupVisibleClass, lastFocus, 'Close Button');
  }); // escape key press

  $(document).keyup(function (e) {
    if (27 === e.keyCode) {
      hidePopup(popupSelector, popupVisibleClass, lastFocus, 'Escape Key');
    }
  }); // click on a non-login or close link inside popup

  $('.' + popupSelector).on('click', 'a:not( .sm-close-btn, .message-login )', function () {
    var popupId = getPostId(popupSelector);
    analyticsTrackingEvent('event', 'Popup', 'Click', popupId);
  });
}

function messageAnalytics(message) {
  var messageRegion = getMessageRegion('.' + message);
  var messageId = getPostId(message);

  if ($('.' + message).is(':visible')) {
    analyticsTrackingEvent('event', messageRegion, 'Show', messageId, {
      nonInteraction: 1
    });
  } // click on login link inside a message


  $('.' + message).on('click', '.message-login', function () {
    var url = $(this).attr('href');
    analyticsTrackingEvent('event', messageRegion, 'Login Link', url);
  }); // click on a non-login or close link inside a message

  $('.' + message).on('click', 'a:not( .sm-close-btn, .message-login )', function () {
    analyticsTrackingEvent('event', messageRegion, 'Click', messageId);
  });
}
/**
 * When jQuery is loaded, set up session tracking and popup display
 *
 */


$(document).ready(function () {
  var popupSelector = 'wp-message-inserter-message-region-popup';
  var popupShownCookieName = 'sm-shown';
  var popupVisibleClass = 'wp-message-inserter-message-popup-visible';
  var checkSessionClass = 'check-session-message';
  var messageSelector = 'wp-message-inserter-message'; // Get our value for days and hours to set cookie

  var closeTimeDays = parseInt($('.' + popupSelector).data('close-time-days')) || 0;
  var closeTimeHours = (parseInt($('.' + popupSelector).data('close-time-hours')) || 0) / 24; // Our Total for when the cookie should expire and show the banner again

  var cookieDayTotal = closeTimeDays + closeTimeHours; // Session Validating and showing proper banner

  var operators = {
    gt: function gt(a, b) {
      return a >= b;
    },
    lt: function lt(a, b) {
      return a <= b;
    }
  };
  var currentCount = setCurrentCount();

  if (0 < $('.' + checkSessionClass).length) {
    $('.' + checkSessionClass).each(function () {
      var bannerSessionCount = parseInt($(this).data('session-count-to-check'));
      var bannerSessionOperator = $(this).data('session-count-operator');

      if (operators[bannerSessionOperator](currentCount, bannerSessionCount)) {
        if (!$(this).hasClass(popupSelector)) {
          $(this).addClass('validated');
        } else if (!getCookie(popupShownCookieName)) {
          $(this).addClass('validated');
        }
      }
    });
  }

  if (0 < $('.' + popupSelector).length) {
    popupDisplay(popupSelector, cookieDayTotal, popupShownCookieName, popupVisibleClass);
  }

  if (0 < $('.' + messageSelector + ':not( .' + popupSelector + ' )').length) {
    messageAnalytics(messageSelector + ':not( .' + popupSelector + ' )');
  }
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIjAxLW1lc3NhZ2VzLmpzIl0sIm5hbWVzIjpbInNldENvb2tpZSIsIm5hbWUiLCJ2YWx1ZSIsImRheXMiLCJkIiwiRGF0ZSIsInNldFRpbWUiLCJnZXRUaW1lIiwiZG9jdW1lbnQiLCJjb29raWUiLCJ0b0dNVFN0cmluZyIsImdldENvb2tpZSIsInYiLCJtYXRjaCIsImFuYWx5dGljc1RyYWNraW5nRXZlbnQiLCJ0eXBlIiwiY2F0ZWdvcnkiLCJhY3Rpb24iLCJsYWJlbCIsImNoYXJBdCIsInRvVXBwZXJDYXNlIiwic2xpY2UiLCJnYSIsInNldEN1cnJlbnRDb3VudCIsImN1cnJlbnRDb3VudCIsInRpbWVzdGFtcCIsIk1hdGgiLCJmbG9vciIsImNvb2tpZUV4cGlyYXRpb24iLCJ1cmxQYXJhbXMiLCJVUkxTZWFyY2hQYXJhbXMiLCJ3aW5kb3ciLCJsb2NhdGlvbiIsInNlYXJjaCIsImdldCIsInBhcnNlSW50IiwiZ2V0UG9zdElkIiwicG9wdXBTZWxlY3RvciIsInBvc3RJZCIsImNsYXNzTGlzdCIsIiQiLCJhdHRyIiwic3BsaXQiLCJlYWNoIiwiaW5kZXgiLCJpdGVtIiwiaW5kZXhPZiIsInN1YnN0cmluZyIsImxhc3RJbmRleE9mIiwiZ2V0TWVzc2FnZVJlZ2lvbiIsIm1lc3NhZ2UiLCJyZWdpb24iLCJzaG93UG9wdXAiLCJjb29raWVEYXlUb3RhbCIsInBvcHVwU2hvd25Db29raWVOYW1lIiwicG9wdXBWaXNpYmxlQ2xhc3MiLCJwb3B1cElkIiwibGVuZ3RoIiwiYWRkQ2xhc3MiLCJub25JbnRlcmFjdGlvbiIsImhpZGVQb3B1cCIsImxhc3RGb2N1cyIsImNsb3NlVHJpZ2dlciIsImZvY3VzIiwicmVtb3ZlQ2xhc3MiLCJwb3B1cERpc3BsYXkiLCJjaGVja1Nlc3Npb25DbGFzcyIsImFjdGl2ZUVsZW1lbnQiLCJhcHBlbmQiLCJoYXNDbGFzcyIsIm9uIiwidXJsIiwiYWRkRXZlbnRMaXN0ZW5lciIsImV2ZW50IiwidGFyZ2V0IiwiY2xvc2VzdCIsImlzIiwiZSIsInByZXZlbnREZWZhdWx0Iiwia2V5dXAiLCJrZXlDb2RlIiwibWVzc2FnZUFuYWx5dGljcyIsIm1lc3NhZ2VSZWdpb24iLCJtZXNzYWdlSWQiLCJyZWFkeSIsIm1lc3NhZ2VTZWxlY3RvciIsImNsb3NlVGltZURheXMiLCJkYXRhIiwiY2xvc2VUaW1lSG91cnMiLCJvcGVyYXRvcnMiLCJndCIsImEiLCJiIiwibHQiLCJiYW5uZXJTZXNzaW9uQ291bnQiLCJiYW5uZXJTZXNzaW9uT3BlcmF0b3IiXSwibWFwcGluZ3MiOiI7O0FBQUE7Ozs7Ozs7QUFPQSxTQUFTQSxTQUFULENBQW9CQyxJQUFwQixFQUEwQkMsS0FBMUIsRUFBaUNDLElBQWpDLEVBQXdDO0FBQ3ZDLE1BQU1DLENBQUMsR0FBRyxJQUFJQyxJQUFKLEVBQVY7QUFDQUQsRUFBQUEsQ0FBQyxDQUFDRSxPQUFGLENBQVdGLENBQUMsQ0FBQ0csT0FBRixLQUFnQixXQUFXSixJQUF0QztBQUNBSyxFQUFBQSxRQUFRLENBQUNDLE1BQVQsR0FBa0JSLElBQUksR0FBRyxHQUFQLEdBQWFDLEtBQWIsR0FBcUIsa0JBQXJCLEdBQTBDRSxDQUFDLENBQUNNLFdBQUYsRUFBNUQ7QUFDQTtBQUVEOzs7Ozs7O0FBS0EsU0FBU0MsU0FBVCxDQUFvQlYsSUFBcEIsRUFBMkI7QUFDMUIsTUFBTVcsQ0FBQyxHQUFHSixRQUFRLENBQUNDLE1BQVQsQ0FBZ0JJLEtBQWhCLENBQXVCLFlBQVlaLElBQVosR0FBbUIsZUFBMUMsQ0FBVjtBQUNBLFNBQU9XLENBQUMsR0FBR0EsQ0FBQyxDQUFFLENBQUYsQ0FBSixHQUFZLElBQXBCO0FBQ0E7QUFFRDs7Ozs7Ozs7Ozs7QUFTQSxTQUFTRSxzQkFBVCxDQUFpQ0MsSUFBakMsRUFBdUNDLFFBQXZDLEVBQWlEQyxNQUFqRCxFQUF5REMsS0FBekQsRUFBZ0VoQixLQUFoRSxFQUF3RTtBQUN2RWMsRUFBQUEsUUFBUSxHQUFHLG1CQUFtQkEsUUFBUSxDQUFDRyxNQUFULENBQWlCLENBQWpCLEVBQXFCQyxXQUFyQixFQUFu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QUFpQ0Msb0JBQWpDLEVBQXVEQyxpQkFBdkQsQ0FBWjtBQUNBOztBQUVELE1BQUssSUFBSWYsQ0FBQyxDQUFFLE1BQU02QyxlQUFOLEdBQXdCLFNBQXhCLEdBQW9DaEQsYUFBcEMsR0FBb0QsSUFBdEQsQ0FBRCxDQUE4RG9CLE1BQXZFLEVBQWdGO0FBQy9Fd0IsSUFBQUEsZ0JBQWdCLENBQUVJLGVBQWUsR0FBRyxTQUFsQixHQUE4QmhELGFBQTlCLEdBQThDLElBQWhELENBQWhCO0FBQ0E7QUFFRCxDQXBERCIsImZpbGUiOiJ3cC1tZXNzYWdlLWluc2VydGVyLXBsdWdpbi1mcm9udC1lbmQuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFNldHMgY29va2llc1xuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBuYW1lXG4gKiBAcGFyYW0ge3N0cmluZ30gdmFsdWVcbiAqIEBwYXJhbSB7bnVtYmVyfSBkYXlzXG4gKi9cbmZ1bmN0aW9uIHNldENvb2tpZSggbmFtZSwgdmFsdWUsIGRheXMgKSB7XG5cdGNvbnN0IGQgPSBuZXcgRGF0ZSgpO1xuXHRkLnNldFRpbWUoIGQuZ2V0VGltZSgpICsgKCA4NjQwMDAwMCAqIGRheXMgKSApO1xuXHRkb2N1bWVudC5jb29raWUgPSBuYW1lICsgJz0nICsgdmFsdWUgKyAnO3BhdGg9LztleHBpcmVzPScgKyBkLnRvR01UU3RyaW5nKCk7XG59XG5cbi8qKlxuICogUmVhZHMgY29va2llc1xuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBuYW1lXG4gKi9cbmZ1bmN0aW9uIGdldENvb2tpZSggbmFtZSApIHtcblx0Y29uc3QgdiA9IGRvY3VtZW50LmNvb2tpZS5tYXRjaCggJyhefDspID8nICsgbmFtZSArICc9KFteO10qKSg7fCQpJyApO1xuXHRyZXR1cm4gdiA/IHZbIDIgXSA6IG51bGw7XG59XG5cbi8qKlxuICogQ3JlYXRpbmcgQW5hbHl0aWNzIGV2ZW50c1xuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSB0eXBlXG4gKiBAcGFyYW0ge3N0cmluZ30gY2F0ZWdvcnlcbiAqIEBwYXJhbSB7c3RyaW5nfSBhY3Rpb25cbiAqIEBwYXJhbSB7c3RyaW5nfSBsYWJlbFxuICogQHBhcmFtIHtBcnJheX0gdmFsdWVcbiAqL1xuZnVuY3Rpb24gYW5hbHl0aWNzVHJhY2tpbmdFdmVudCggdHlwZSwgY2F0ZWdvcnksIGFjdGlvbiwgbGFiZWwsIHZhbHVlICkge1xuXHRjYXRlZ29yeSA9ICdTaXRlIE1lc3NhZ2U6ICcgKyBjYXRlZ29yeS5jaGFyQXQoIDAgKS50b1VwcGVyQ2FzZSgpICsgY2F0ZWdvcnkuc2xpY2UoIDEgKTtcblx0aWYgKCAndW5kZWZpbmVkJyAhPT0gdHlwZW9mIGdhICkge1xuXHRcdGlmICggJ3VuZGVmaW5lZCcgPT09IHR5cGVvZiB2YWx1ZSApIHtcblx0XHRcdGdhKCAnc2VuZCcsIHR5cGUsIGNhdGVnb3J5LCBhY3Rpb24sIGxhYmVsICk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdGdhKCAnc2VuZCcsIHR5cGUsIGNhdGVnb3J5LCBhY3Rpb24sIGxhYmVsLCB2YWx1ZSApO1xuXHRcdH1cblx0fSBlbHNlIHtcblxuXHR9XG59XG5cbi8qKlxuICogRmF1eCBcIlNlc3Npb25cIiBjaGVja2luZy9zZXR0aW5nXG4gKlxuICogQHJldHVybiB7bnVtYmVyfSBjdXJyZW50Q291bnRcbiAqL1xuZnVuY3Rpb24gc2V0Q3VycmVudENvdW50KCkge1xuXHQvLyBUaW1lc3RhbXAgc3RvcmVkIG9uIHRoZSBjb29raWVcblx0bGV0IGN1cnJlbnRDb3VudCA9IGdldENvb2tpZSggJ2NvdW50JyApO1xuXHRjb25zdCB0aW1lc3RhbXAgPSBNYXRoLmZsb29yKCBuZXcgRGF0ZSgpLmdldFRpbWUoKSAvIDEwMDAgKTtcblx0Y29uc3QgY29va2llRXhwaXJhdGlvbiA9IDMwOyAvLyBleHBpcmUgdGhlIGNvb2tlIGluIDMwIGRheXNcblx0aWYgKCAhIGdldENvb2tpZSggJ2NvdW50JyApICkge1xuXHRcdC8vIEZpcnN0IFZpc2l0IC0gc2V0IGNvdW50IHRvIDFcblx0XHRzZXRDb29raWUoICdjb3VudCcsIDEsIGNvb2tpZUV4cGlyYXRpb24gKTtcblx0XHQvLyBTZXQgYSB0aW1lY2hlY2sgY29va2llIGZvciBhbiBob3VyIGZyb20gbm93XG5cdFx0c2V0Q29va2llKCAndGltZWNoZWNrJywgdGltZXN0YW1wICsgMzYwMCwgY29va2llRXhwaXJhdGlvbiApO1xuXHR9IGVsc2UgaWYgKCB0aW1lc3RhbXAgPiBnZXRDb29raWUoICd0aW1lY2hlY2snICkgKSB7XG5cdFx0Ly8gVXBkYXRlIFRpbWVjaGVjayB0byBuZXcgdmFsdWVcblx0XHRzZXRDb29raWUoICd0aW1lY2hlY2snLCB0aW1lc3RhbXAgKyAzNjAwLCBjb29raWVFeHBpcmF0aW9uICk7XG5cdFx0Ly8gQ291bnQgZXhpc3RzIGFscmVhZHkgYW5kIGl0IGhhcyBiZWVuIGFuIGhvdXIuIFVwZGF0ZSBjb3VudFxuXHRcdHNldENvb2tpZSggJ2NvdW50JywgKytjdXJyZW50Q291bnQsIGNvb2tpZUV4cGlyYXRpb24gKTtcblx0fVxuXHRjb25zdCB1cmxQYXJhbXMgPSBuZXcgVVJMU2VhcmNoUGFyYW1zKCB3aW5kb3cubG9jYXRpb24uc2VhcmNoICk7XG5cdGlmICggdXJsUGFyYW1zLmdldCggJ2NvdW50JyApICE9PSBudWxsICkge1xuXHRcdGN1cnJlbnRDb3VudCA9IHBhcnNlSW50KCB1cmxQYXJhbXMuZ2V0KCAnY291bnQnICkgKTtcblx0fVxuXHRyZXR1cm4gY3VycmVudENvdW50O1xufVxuXG4vKipcbiAqIEdldCB0aGUgV29yZFByZXNzIHBvc3QgSUQgZm9yIGEgZ2l2ZW4gcG9wdXAuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IHBvcHVwU2VsZWN0b3JcbiAqIEByZXR1cm4ge251bWJlcn0gcG9zdElkXG4gKi9cbmZ1bmN0aW9uIGdldFBvc3RJZCggcG9wdXBTZWxlY3RvciApIHtcblx0bGV0IHBvc3RJZCA9IDA7XG5cdGNvbnN0IGNsYXNzTGlzdCA9ICQoICcuJyArIHBvcHVwU2VsZWN0b3IgKS5hdHRyKCAnY2xhc3MnICkuc3BsaXQoIC9cXHMrLyApO1xuXHQkLmVhY2goIGNsYXNzTGlzdCwgZnVuY3Rpb24oIGluZGV4LCBpdGVtICkge1xuXHRcdGlmICggMCA8IGl0ZW0uaW5kZXhPZiggJ21lc3NhZ2UtaWQnICkgKSB7XG5cdFx0XHRwb3N0SWQgPSBpdGVtLnN1YnN0cmluZyggaXRlbS5sYXN0SW5kZXhPZiggJy0nICkgKyAxICk7XG5cdFx0XHRyZXR1cm4gZmFsc2U7IC8vIGJyZWFrIGVhY2ggYW5kIHBvc3RJZCB3aWxsIGJlIHJldHVybmVkXG5cdFx0fVxuXHR9ICk7XG5cdHJldHVybiBwb3N0SWQ7XG59XG5cbi8qKlxuICogR2V0IHRoZSByZWdpb24gZm9yIGEgZ2l2ZW4gbWVzc2FnZS5cbiAqXG4gKiBAcGFyYW0ge29iamVjdH0gbWVzc2FnZVxuICogQHJldHVybiB7c3RyaW5nfSByZWdpb25cbiAqL1xuZnVuY3Rpb24gZ2V0TWVzc2FnZVJlZ2lvbiggbWVzc2FnZSApIHtcblx0bGV0IHJlZ2lvbiA9ICcnO1xuXHRjb25zdCBjbGFzc0xpc3QgPSAkKCBtZXNzYWdlICkuYXR0ciggJ2NsYXNzJyApLnNwbGl0KCAvXFxzKy8gKTtcblx0JC5lYWNoKCBjbGFzc0xpc3QsIGZ1bmN0aW9uKCBpbmRleCwgaXRlbSApIHtcblx0XHRpZiAoIDAgPCBpdGVtLmluZGV4T2YoICdtZXNzYWdlLXJlZ2lvbicgKSApIHtcblx0XHRcdHJlZ2lvbiA9IGl0ZW0uc3Vic3RyaW5nKCBpdGVtLmxhc3RJbmRleE9mKCAnLScgKSArIDEgKTtcblx0XHRcdHJldHVybiBmYWxzZTsgLy8gYnJlYWsgZWFjaCBhbmQgcmVnaW9uIHdpbGwgYmUgcmV0dXJuZWRcblx0XHR9XG5cdH0gKTtcblx0cmV0dXJuIHJlZ2lvbjtcbn1cblxuLyoqXG4gKiBTaG93IGEgc3BlY2lmaWMgcG9wdXAuIFNldHMgYSBjb29raWUgYW5kIGFkZHMgYSB2aXNpYmlsaXR5IGNsYXNzLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBwb3B1cFNlbGVjdG9yXG4gKiBAcGFyYW0ge251bWJlcn0gY29va2llRGF5VG90YWxcbiAqIEBwYXJhbSB7c3RyaW5nfSBwb3B1cFNob3duQ29va2llTmFtZVxuICogQHBhcmFtIHtzdHJpbmd9IHBvcHVwVmlzaWJsZUNsYXNzXG4gKi9cbmZ1bmN0aW9uIHNob3dQb3B1cCggcG9wdXBTZWxlY3RvciwgY29va2llRGF5VG90YWwsIHBvcHVwU2hvd25Db29raWVOYW1lLCBwb3B1cFZpc2libGVDbGFzcyApIHtcblx0bGV0IHBvcHVwSWQgPSAwO1xuXHRzZXRDb29raWUoIHBvcHVwU2hvd25Db29raWVOYW1lLCAndHJ1ZScsIGNvb2tpZURheVRvdGFsICk7XG5cdGlmICggMCA8ICQoICcudmFsaWRhdGVkJyApLmxlbmd0aCApIHtcblx0XHQkKCAnLicgKyBwb3B1cFNlbGVjdG9yICsgJy52YWxpZGF0ZWQnICkuYWRkQ2xhc3MoIHBvcHVwVmlzaWJsZUNsYXNzICk7XG5cdFx0cG9wdXBJZCA9IGdldFBvc3RJZCggcG9wdXBTZWxlY3RvciArICcudmFsaWRhdGVkJyApO1xuXHR9IGVsc2Uge1xuXHRcdCQoICcuJyArIHBvcHVwU2VsZWN0b3IgKyAnOmZpcnN0JyApLmFkZENsYXNzKCBwb3B1cFZpc2libGVDbGFzcyApO1xuXHRcdHBvcHVwSWQgPSBnZXRQb3N0SWQoIHBvcHVwU2VsZWN0b3IgKyAnOmZpcnN0JyApO1xuXHR9XG5cdGlmICggMCAhPT0gcG9wdXBJZCApIHtcblx0XHRhbmFseXRpY3NUcmFja2luZ0V2ZW50KCAnZXZlbnQnLCAnUG9wdXAnLCAnU2hvdycsIHBvcHVwSWQsIHsgbm9uSW50ZXJhY3Rpb246IDEgfSApO1xuXHR9XG59XG5cbi8qKlxuICogU2hvdyBhIHNwZWNpZmljIHBvcHVwLiBTZXRzIGEgY29va2llIGFuZCBhZGRzIGEgdmlzaWJpbGl0eSBjbGFzcy5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gcG9wdXBTZWxlY3RvclxuICogQHBhcmFtIHtzdHJpbmd9IHBvcHVwVmlzaWJsZUNsYXNzXG4gKiBAcGFyYW0ge09iamVjdH0gbGFzdEZvY3VzXG4gKiBAcGFyYW0ge3N0cmluZ30gY2xvc2VUcmlnZ2VyXG4gKi9cbmZ1bmN0aW9uIGhpZGVQb3B1cCggcG9wdXBTZWxlY3RvciwgcG9wdXBWaXNpYmxlQ2xhc3MsIGxhc3RGb2N1cywgY2xvc2VUcmlnZ2VyICkge1xuXHRsYXN0Rm9jdXMuZm9jdXMoKTtcblx0JCggJy4nICsgcG9wdXBTZWxlY3RvciApLnJlbW92ZUNsYXNzKCBwb3B1cFZpc2libGVDbGFzcyApO1xuXHRjb25zdCBwb3B1cElkID0gZ2V0UG9zdElkKCBwb3B1cFNlbGVjdG9yICk7XG5cdGlmICggMCAhPT0gcG9wdXBJZCApIHtcblx0XHRhbmFseXRpY3NUcmFja2luZ0V2ZW50KCAnZXZlbnQnLCAnUG9wdXAnLCBjbG9zZVRyaWdnZXIsIHBvcHVwSWQsIHsgbm9uSW50ZXJhY3Rpb246IDEgfSApO1xuXHR9XG59XG5cbi8qKlxuICogRGlzcGxheSBhbmQgY29udHJvbHMgZm9yIHBvcHVwc1xuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBwb3B1cFNlbGVjdG9yXG4gKiBAcGFyYW0ge251bWJlcn0gY29va2llRGF5VG90YWxcbiAqIEBwYXJhbSB7c3RyaW5nfSBwb3B1cFNob3duQ29va2llTmFtZVxuICogQHBhcmFtIHtzdHJpbmd9IHBvcHVwVmlzaWJsZUNsYXNzXG4gKiBAcGFyYW0ge3N0cmluZ30gY2hlY2tTZXNzaW9uQ2xhc3NcbiAqL1xuZnVuY3Rpb24gcG9wdXBEaXNwbGF5KCBwb3B1cFNlbGVjdG9yLCBjb29raWVEYXlUb3RhbCwgcG9wdXBTaG93bkNvb2tpZU5hbWUsIHBvcHVwVmlzaWJsZUNsYXNzLCBjaGVja1Nlc3Npb25DbGFzcyApIHtcblx0Y29uc3QgbGFzdEZvY3VzID0gZG9jdW1lbnQuYWN0aXZlRWxlbWVudDtcblx0Ly8gcHV0IGluIGEgY2xvc2UgYnV0dG9uIGF0IHRoZSBlbmRcblx0JCggJy4nICsgcG9wdXBTZWxlY3RvciArICcgLm0td3AtaW5zZXJ0LW1lc3NhZ2UtaXRlbScgKS5hcHBlbmQoICc8YSBocmVmPVwiI1wiIGNsYXNzPVwic20tY2xvc2UtYnRuXCIgYXJpYS1sYWJlbD1cIkNsb3NlXCI+PGkgY2xhc3M9XCJmYXMgZmEtdGltZXNcIiBhcmlhLWhpZGRlbj1cInRydWVcIj48L2k+PC9hPicgKTtcblx0Ly8gQ2hlY2sgaWYgd2Ugc2hvdWxkIGJlIHNob3dpbmcgdGhlIHBvcHVwXG5cdGlmIChcblx0XHQndHJ1ZScgIT09IGdldENvb2tpZSggcG9wdXBTaG93bkNvb2tpZU5hbWUgKSAmJlxuXHRcdCEgJCggJy4nICsgcG9wdXBTZWxlY3RvciApLmhhc0NsYXNzKCBjaGVja1Nlc3Npb25DbGFzcyApXG5cdCkge1xuXHRcdHNob3dQb3B1cCggcG9wdXBTZWxlY3RvciwgY29va2llRGF5VG90YWwsIHBvcHVwU2hvd25Db29raWVOYW1lLCBwb3B1cFZpc2libGVDbGFzcyApO1xuXHR9XG5cblx0Ly8gY2xpY2sgb24gbG9naW4gbGluayBpbnNpZGUgcG9wdXBcblx0JCggJy4nICsgcG9wdXBTZWxlY3RvciApLm9uKCAnY2xpY2snLCAnLm1lc3NhZ2UtbG9naW4nLCBmdW5jdGlvbigpIHtcblx0XHRjb25zdCB1cmwgPSAkKCB0aGlzICkuYXR0ciggJ2hyZWYnICk7XG5cdFx0YW5hbHl0aWNzVHJhY2tpbmdFdmVudCggJ2V2ZW50JywgJ1BvcHVwJywgJ0xvZ2luIExpbmsnLCB1cmwgKTtcblx0fSApO1xuXG5cdGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoICdjbGljaycsIGZ1bmN0aW9uKCBldmVudCApIHtcblx0XHRpZiAoXG5cdFx0XHQhICQoIGV2ZW50LnRhcmdldCApLmNsb3Nlc3QoICcuJyArIHBvcHVwU2VsZWN0b3IgKS5pcyggJy4nICsgcG9wdXBTZWxlY3RvciApICYmXG5cdFx0XHQkKCAnLicgKyBwb3B1cFNlbGVjdG9yICkuaGFzQ2xhc3MoIHBvcHVwVmlzaWJsZUNsYXNzIClcblx0XHQpIHtcblx0XHRcdGhpZGVQb3B1cCggcG9wdXBTZWxlY3RvciwgcG9wdXBWaXNpYmxlQ2xhc3MsIGxhc3RGb2N1cywgJ0NsaWNrIE91dHNpZGUgdG8gQ2xvc2UnICk7XG5cdFx0fVxuXHR9LCB0cnVlICk7XG5cblx0Ly8gcG9wdXAgY2xvc2UgYnV0dG9uXG5cdCQoICcuJyArIHBvcHVwU2VsZWN0b3IgKS5vbiggJ2NsaWNrJywgJy5zbS1jbG9zZS1idG4nLCBmdW5jdGlvbiggZSApIHtcblx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0aGlkZVBvcHVwKCBwb3B1cFNlbGVjdG9yLCBwb3B1cFZpc2libGVDbGFzcywgbGFzdEZvY3VzLCAnQ2xvc2UgQnV0dG9uJyApO1xuXHR9ICk7XG5cblx0Ly8gZXNjYXBlIGtleSBwcmVzc1xuXHQkKCBkb2N1bWVudCApLmtleXVwKCBmdW5jdGlvbiggZSApIHtcblx0XHRpZiAoIDI3ID09PSBlLmtleUNvZGUgKSB7XG5cdFx0XHRoaWRlUG9wdXAoIHBvcHVwU2VsZWN0b3IsIHBvcHVwVmlzaWJsZUNsYXNzLCBsYXN0Rm9jdXMsICdFc2NhcGUgS2V5JyApO1xuXHRcdH1cblx0fSApO1xuXG5cdC8vIGNsaWNrIG9uIGEgbm9uLWxvZ2luIG9yIGNsb3NlIGxpbmsgaW5zaWRlIHBvcHVwXG5cdCQoICcuJyArIHBvcHVwU2VsZWN0b3IgKS5vbiggJ2NsaWNrJywgJ2E6bm90KCAuc20tY2xvc2UtYnRuLCAubWVzc2FnZS1sb2dpbiApJywgZnVuY3Rpb24oKSB7XG5cdFx0Y29uc3QgcG9wdXBJZCA9IGdldFBvc3RJZCggcG9wdXBTZWxlY3RvciApO1xuXHRcdGFuYWx5dGljc1RyYWNraW5nRXZlbnQoICdldmVudCcsICdQb3B1cCcsICdDbGljaycsIHBvcHVwSWQgKTtcblx0fSApO1xufVxuXG5mdW5jdGlvbiBtZXNzYWdlQW5hbHl0aWNzKCBtZXNzYWdlICkge1xuXHRjb25zdCBtZXNzYWdlUmVnaW9uID0gZ2V0TWVzc2FnZVJlZ2lvbiggJy4nICsgbWVzc2FnZSApO1xuXHRjb25zdCBtZXNzYWdlSWQgPSBnZXRQb3N0SWQoIG1lc3NhZ2UgKTtcblx0aWYgKCAkKCAnLicgKyBtZXNzYWdlICkuaXMoICc6dmlzaWJsZScgKSApIHtcblx0XHRhbmFseXRpY3NUcmFja2luZ0V2ZW50KCAnZXZlbnQnLCBtZXNzYWdlUmVnaW9uLCAnU2hvdycsIG1lc3NhZ2VJZCwgeyBub25JbnRlcmFjdGlvbjogMSB9ICk7XG5cdH1cblx0Ly8gY2xpY2sgb24gbG9naW4gbGluayBpbnNpZGUgYSBtZXNzYWdlXG5cdCQoICcuJyArIG1lc3NhZ2UgKS5vbiggJ2NsaWNrJywgJy5tZXNzYWdlLWxvZ2luJywgZnVuY3Rpb24oKSB7XG5cdFx0Y29uc3QgdXJsID0gJCggdGhpcyApLmF0dHIoICdocmVmJyApO1xuXHRcdGFuYWx5dGljc1RyYWNraW5nRXZlbnQoICdldmVudCcsIG1lc3NhZ2VSZWdpb24sICdMb2dpbiBMaW5rJywgdXJsICk7XG5cdH0gKTtcblxuXHQvLyBjbGljayBvbiBhIG5vbi1sb2dpbiBvciBjbG9zZSBsaW5rIGluc2lkZSBhIG1lc3NhZ2Vcblx0JCggJy4nICsgbWVzc2FnZSApLm9uKCAnY2xpY2snLCAnYTpub3QoIC5zbS1jbG9zZS1idG4sIC5tZXNzYWdlLWxvZ2luICknLCBmdW5jdGlvbigpIHtcblx0XHRhbmFseXRpY3NUcmFja2luZ0V2ZW50KCAnZXZlbnQnLCBtZXNzYWdlUmVnaW9uLCAnQ2xpY2snLCBtZXNzYWdlSWQgKTtcblx0fSApO1xufVxuXG4vKipcbiAqIFdoZW4galF1ZXJ5IGlzIGxvYWRlZCwgc2V0IHVwIHNlc3Npb24gdHJhY2tpbmcgYW5kIHBvcHVwIGRpc3BsYXlcbiAqXG4gKi9cbiQoIGRvY3VtZW50ICkucmVhZHkoIGZ1bmN0aW9uKCkge1xuXHRjb25zdCBwb3B1cFNlbGVjdG9yID0gJ3dwLW1lc3NhZ2UtaW5zZXJ0ZXItbWVzc2FnZS1yZWdpb24tcG9wdXAnO1xuXHRjb25zdCBwb3B1cFNob3duQ29va2llTmFtZSA9ICdzbS1zaG93bic7XG5cdGNvbnN0IHBvcHVwVmlzaWJsZUNsYXNzID0gJ3dwLW1lc3NhZ2UtaW5zZXJ0ZXItbWVzc2FnZS1wb3B1cC12aXNpYmxlJztcblx0Y29uc3QgY2hlY2tTZXNzaW9uQ2xhc3MgPSAnY2hlY2stc2Vzc2lvbi1tZXNzYWdlJztcblx0Y29uc3QgbWVzc2FnZVNlbGVjdG9yID0gJ3dwLW1lc3NhZ2UtaW5zZXJ0ZXItbWVzc2FnZSc7XG5cblx0Ly8gR2V0IG91ciB2YWx1ZSBmb3IgZGF5cyBhbmQgaG91cnMgdG8gc2V0IGNvb2tpZVxuXHRjb25zdCBjbG9zZVRpbWVEYXlzID0gcGFyc2VJbnQoICQoICcuJyArIHBvcHVwU2VsZWN0b3IgKS5kYXRhKCAnY2xvc2UtdGltZS1kYXlzJyApICkgfHwgMDtcblx0Y29uc3QgY2xvc2VUaW1lSG91cnMgPSAoIHBhcnNlSW50KCAkKCAnLicgKyBwb3B1cFNlbGVjdG9yICkuZGF0YSggJ2Nsb3NlLXRpbWUtaG91cnMnICkgKSB8fCAwICkgLyAyNDtcblx0Ly8gT3VyIFRvdGFsIGZvciB3aGVuIHRoZSBjb29raWUgc2hvdWxkIGV4cGlyZSBhbmQgc2hvdyB0aGUgYmFubmVyIGFnYWluXG5cdGNvbnN0IGNvb2tpZURheVRvdGFsID0gY2xvc2VUaW1lRGF5cyArIGNsb3NlVGltZUhvdXJzO1xuXG5cdC8vIFNlc3Npb24gVmFsaWRhdGluZyBhbmQgc2hvd2luZyBwcm9wZXIgYmFubmVyXG5cdGNvbnN0IG9wZXJhdG9ycyA9IHtcblx0XHRndCggYSwgYiApIHtcblx0XHRcdHJldHVybiBhID49IGI7XG5cdFx0fSxcblx0XHRsdCggYSwgYiApIHtcblx0XHRcdHJldHVybiBhIDw9IGI7XG5cdFx0fSxcblx0fTtcblxuXHRjb25zdCBjdXJyZW50Q291bnQgPSBzZXRDdXJyZW50Q291bnQoKTtcblxuXHRpZiAoIDAgPCAkKCAnLicgKyBjaGVja1Nlc3Npb25DbGFzcyApLmxlbmd0aCApIHtcblx0XHQkKCAnLicgKyBjaGVja1Nlc3Npb25DbGFzcyApLmVhY2goIGZ1bmN0aW9uKCkge1xuXHRcdFx0Y29uc3QgYmFubmVyU2Vzc2lvbkNvdW50ID0gcGFyc2VJbnQoICQoIHRoaXMgKS5kYXRhKCAnc2Vzc2lvbi1jb3VudC10by1jaGVjaycgKSApO1xuXHRcdFx0Y29uc3QgYmFubmVyU2Vzc2lvbk9wZXJhdG9yID0gJCggdGhpcyApLmRhdGEoICdzZXNzaW9uLWNvdW50LW9wZXJhdG9yJyApO1xuXHRcdFx0aWYgKFxuXHRcdFx0XHRvcGVyYXRvcnNbIGJhbm5lclNlc3Npb25PcGVyYXRvciBdKFxuXHRcdFx0XHRcdGN1cnJlbnRDb3VudCxcblx0XHRcdFx0XHRiYW5uZXJTZXNzaW9uQ291bnRcblx0XHRcdFx0KVxuXHRcdFx0KSB7XG5cdFx0XHRcdGlmICggISAkKCB0aGlzICkuaGFzQ2xhc3MoIHBvcHVwU2VsZWN0b3IgKSApIHtcblx0XHRcdFx0XHQkKCB0aGlzICkuYWRkQ2xhc3MoICd2YWxpZGF0ZWQnICk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoICEgZ2V0Q29va2llKCBwb3B1cFNob3duQ29va2llTmFtZSApICkge1xuXHRcdFx0XHRcdCQoIHRoaXMgKS5hZGRDbGFzcyggJ3ZhbGlkYXRlZCcgKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH0gKTtcblx0fVxuXG5cdGlmICggMCA8ICQoICcuJyArIHBvcHVwU2VsZWN0b3IgKS5sZW5ndGggKSB7XG5cdFx0cG9wdXBEaXNwbGF5KCBwb3B1cFNlbGVjdG9yLCBjb29raWVEYXlUb3RhbCwgcG9wdXBTaG93bkNvb2tpZU5hbWUsIHBvcHVwVmlzaWJsZUNsYXNzICk7XG5cdH1cblxuXHRpZiAoIDAgPCAkKCAnLicgKyBtZXNzYWdlU2VsZWN0b3IgKyAnOm5vdCggLicgKyBwb3B1cFNlbGVjdG9yICsgJyApJyApLmxlbmd0aCApIHtcblx0XHRtZXNzYWdlQW5hbHl0aWNzKCBtZXNzYWdlU2VsZWN0b3IgKyAnOm5vdCggLicgKyBwb3B1cFNlbGVjdG9yICsgJyApJyApO1xuXHR9XG5cbn0gKTtcbiJdfQ==
}(jQuery));
