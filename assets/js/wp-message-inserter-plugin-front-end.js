;(function($) {
"use strict";

/**
 * Sets cookies
 *
 * @param {string} name
 * @param {string} value
 * @param {number} days
 */
function setCookie(name, value, days) {
  var d = new Date();
  d.setTime(d.getTime() + 86400000 * days);
  document.cookie = name + "=" + value + ";path=/;expires=" + d.toGMTString();
}
/**
 * Reads cookies
 *
 * @param {string} name
 */


function getCookie(name) {
  var v = document.cookie.match("(^|;) ?" + name + "=([^;]*)(;|$)");
  return v ? v[2] : null;
}
/**
 * Creating Analytics events
 *
 * @param {string} type
 * @param {string} category
 * @param {string} action
 * @param {string} label
 * @param {Array} value
 */


function analyticsTrackingEvent(type, category, action, label, value) {
  category = "Site Message: " + category.charAt(0).toUpperCase() + category.slice(1);

  if ("undefined" !== typeof ga) {
    if ("undefined" === typeof value) {
      ga("send", type, category, action, label);
    } else {
      ga("send", type, category, action, label, value);
    }
  } else {}
}
/**
 * Faux "Session" checking/setting
 *
 * @return {number} currentCount
 */


function setCurrentCount() {
  // Timestamp stored on the cookie
  var currentCount = getCookie("count");
  var timestamp = Math.floor(new Date().getTime() / 1000);
  var cookieExpiration = 30; // expire the cooke in 30 days

  if (!getCookie("count")) {
    // First Visit - set count to 1
    setCookie("count", 1, cookieExpiration); // Set a timecheck cookie for an hour from now

    setCookie("timecheck", timestamp + 3600, cookieExpiration);
  } else if (timestamp > getCookie("timecheck")) {
    // Update Timecheck to new value
    setCookie("timecheck", timestamp + 3600, cookieExpiration); // Count exists already and it has been an hour. Update count

    setCookie("count", ++currentCount, cookieExpiration);
  }

  var urlParams = new URLSearchParams(window.location.search);

  if (urlParams.get("count") !== null) {
    currentCount = parseInt(urlParams.get("count"));
  }

  return currentCount;
}
/**
 * Get the WordPress post ID for a given popup.
 *
 * @param {string} popupSelector
 * @return {number} postId
 */


function getPostId(popupSelector) {
  var postId = 0;
  var classList = $("." + popupSelector).attr("class").split(/\s+/);
  $.each(classList, function (index, item) {
    if (0 < item.indexOf("message-id")) {
      postId = item.substring(item.lastIndexOf("-") + 1);
      return false; // break each and postId will be returned
    }
  });
  return postId;
}
/**
 * Get the region for a given message.
 *
 * @param {Object} message
 * @return {string} region
 */


function getMessageRegion(message) {
  var region = "";
  var classList = $(message).attr("class").split(/\s+/);
  $.each(classList, function (index, item) {
    if (0 < item.indexOf("message-region")) {
      region = item.substring(item.lastIndexOf("-") + 1);
      return false; // break each and region will be returned
    }
  });
  return region;
}
/**
 * Show a specific popup. Sets a cookie and adds a visibility class.
 *
 * @param {string} popupSelector
 * @param {number} cookieDayTotal
 * @param {string} popupShownCookieName
 * @param {string} popupVisibleClass
 */


function showPopup(popupSelector, cookieDayTotal, popupShownCookieName, popupVisibleClass) {
  var popupId = 0;
  setCookie(popupShownCookieName, "true", cookieDayTotal);

  if (0 < $(".validated").length) {
    $("." + popupSelector + ".validated").addClass(popupVisibleClass);
    popupId = getPostId(popupSelector + ".validated");
  } else {
    $("." + popupSelector + ":first").addClass(popupVisibleClass);
    popupId = getPostId(popupSelector + ":first");
  }

  if (0 !== popupId) {
    analyticsTrackingEvent("event", "Popup", "Show", popupId, {
      nonInteraction: 1
    });
  }
}
/**
 * Show a specific popup. Sets a cookie and adds a visibility class.
 *
 * @param {string} popupSelector
 * @param {string} popupVisibleClass
 * @param {Object} lastFocus
 * @param {string} closeTrigger
 */


function hidePopup(popupSelector, popupVisibleClass, lastFocus, closeTrigger) {
  lastFocus.focus();
  $("." + popupSelector).removeClass(popupVisibleClass);
  var popupId = getPostId(popupSelector);

  if (0 !== popupId) {
    analyticsTrackingEvent("event", "Popup", closeTrigger, popupId, {
      nonInteraction: 1
    });
  }
}
/**
 * Display and controls for popups
 *
 * @param {string} popupSelector
 * @param {number} cookieDayTotal
 * @param {string} popupShownCookieName
 * @param {string} popupVisibleClass
 * @param {string} checkSessionClass
 */


function popupDisplay(popupSelector, cookieDayTotal, popupShownCookieName, popupVisibleClass, checkSessionClass) {
  var lastFocus = document.activeElement; // put in a close button at the end

  $("." + popupSelector + " .m-wp-insert-message-item").append('<a href="#" class="sm-close-btn" aria-label="Close"><i class="far fa-times-circle" aria-hidden="true"></i></i></a>'); // Check if we should be showing the popup

  if ("true" !== getCookie(popupShownCookieName) && !$("." + popupSelector).hasClass(checkSessionClass)) {
    showPopup(popupSelector, cookieDayTotal, popupShownCookieName, popupVisibleClass);
  } // click on login link inside popup


  $("." + popupSelector).on("click", ".message-login", function () {
    var url = $(this).attr("href");
    analyticsTrackingEvent("event", "Popup", "Login Link", url);
  });
  document.addEventListener("click", function (event) {
    if (!$(event.target).closest("." + popupSelector).is("." + popupSelector) && $("." + popupSelector).hasClass(popupVisibleClass)) {
      hidePopup(popupSelector, popupVisibleClass, lastFocus, "Click Outside to Close");
    }
  }, true); // popup close button

  $("." + popupSelector).on("click", ".sm-close-btn", function (e) {
    e.preventDefault();
    hidePopup(popupSelector, popupVisibleClass, lastFocus, "Close Button");
  }); // escape key press

  $(document).keyup(function (e) {
    if (27 === e.keyCode) {
      hidePopup(popupSelector, popupVisibleClass, lastFocus, "Escape Key");
    }
  }); // click on a non-login or close link inside popup

  $("." + popupSelector).on("click", "a:not( .sm-close-btn, .message-login )", function () {
    var popupId = getPostId(popupSelector);
    analyticsTrackingEvent("event", "Popup", "Click", popupId);
  });
}

function messageAnalytics(message) {
  var messageRegion = getMessageRegion("." + message);
  var messageId = getPostId(message);

  if ($("." + message).is(":visible")) {
    analyticsTrackingEvent("event", messageRegion, "Show", messageId, {
      nonInteraction: 1
    });
  } // click on login link inside a message


  $("." + message).on("click", ".message-login", function () {
    var url = $(this).attr("href");
    analyticsTrackingEvent("event", messageRegion, "Login Link", url);
  }); // click on a non-login or close link inside a message

  $("." + message).on("click", "a:not( .sm-close-btn, .message-login )", function () {
    analyticsTrackingEvent("event", messageRegion, "Click", messageId);
  });
}
/**
 * When jQuery is loaded, set up session tracking and popup display
 *
 */


$(document).ready(function () {
  var popupSelector = "wp-message-inserter-message-region-popup";
  var popupShownCookieName = "sm-shown";
  var popupVisibleClass = "wp-message-inserter-message-popup-visible";
  var checkSessionClass = "check-session-message";
  var messageSelector = "wp-message-inserter-message"; // Get our value for days and hours to set cookie

  var closeTimeDays = parseInt($("." + popupSelector).data("close-time-days")) || 0;
  var closeTimeHours = (parseInt($("." + popupSelector).data("close-time-hours")) || 0) / 24; // Our Total for when the cookie should expire and show the banner again

  var cookieDayTotal = closeTimeDays + closeTimeHours; // Session Validating and showing proper banner

  var operators = {
    gt: function gt(a, b) {
      return a >= b;
    },
    lt: function lt(a, b) {
      return a <= b;
    }
  };
  var currentCount = setCurrentCount();

  if (0 < $("." + checkSessionClass).length) {
    $("." + checkSessionClass).each(function () {
      var bannerSessionCount = parseInt($(this).data("session-count-to-check"));
      var bannerSessionOperator = $(this).data("session-count-operator");

      if (operators[bannerSessionOperator](currentCount, bannerSessionCount)) {
        if (!$(this).hasClass(popupSelector)) {
          $(this).addClass("validated");
        } else if (!getCookie(popupShownCookieName)) {
          $(this).addClass("validated");
        }
      }
    });
  }

  if (0 < $("." + popupSelector).length) {
    popupDisplay(popupSelector, cookieDayTotal, popupShownCookieName, popupVisibleClass);
  }

  if (0 < $("." + messageSelector + ":not( ." + popupSelector + " )").length) {
    messageAnalytics(messageSelector + ":not( ." + popupSelector + " )");
  }
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIjAxLW1lc3NhZ2VzLmpzIl0sIm5hbWVzIjpbInNldENvb2tpZSIsIm5hbWUiLCJ2YWx1ZSIsImRheXMiLCJkIiwiRGF0ZSIsInNldFRpbWUiLCJnZXRUaW1lIiwiZG9jdW1lbnQiLCJjb29raWUiLCJ0b0dNVFN0cmluZyIsImdldENvb2tpZSIsInYiLCJtYXRjaCIsImFuYWx5dGljc1RyYWNraW5nRXZlbnQiLCJ0eXBlIiwiY2F0ZWdvcnkiLCJhY3Rpb24iLCJsYWJlbCIsImNoYXJBdCIsInRvVXBwZXJDYXNlIiwic2xpY2UiLCJnYSIsInNldEN1cnJlbnRDb3VudCIsImN1cnJlbnRDb3VudCIsInRpbWVzdGFtcCIsIk1hdGgiLCJmbG9vciIsImNvb2tpZUV4cGlyYXRpb24iLCJ1cmxQYXJhbXMiLCJVUkxTZWFyY2hQYXJhbXMiLCJ3aW5kb3ciLCJsb2NhdGlvbiIsInNlYXJjaCIsImdldCIsInBhcnNlSW50IiwiZ2V0UG9zdElkIiwicG9wdXBTZWxlY3RvciIsInBvc3RJZCIsImNsYXNzTGlzdCIsIiQiLCJhdHRyIiwic3BsaXQiLCJlYWNoIiwiaW5kZXgiLCJpdGVtIiwiaW5kZXhPZiIsInN1YnN0cmluZyIsImxhc3RJbmRleE9mIiwiZ2V0TWVzc2FnZVJlZ2lvbiIsIm1lc3NhZ2UiLCJyZWdpb24iLCJzaG93UG9wdXAiLCJjb29raWVEYXlUb3RhbCIsInBvcHVwU2hvd25Db29raWVOYW1lIiwicG9wdXBWaXNpYmxlQ2xhc3MiLCJwb3B1cElkIiwibGVuZ3RoIiwiYWRkQ2xhc3MiLCJub25JbnRlcmFjdGlvbiIsImhpZGVQb3B1cCIsImxhc3RGb2N1cyIsImNsb3NlVHJpZ2dlciIsImZvY3VzIiwicmVtb3ZlQ2xhc3MiLCJwb3B1cERpc3BsYXkiLCJjaGVja1Nlc3Npb25DbGFzcyIsImFjdGl2ZUVsZW1lbnQiLCJhcHBlbmQiLCJoYXNDbGFzcyIsIm9uIiwidXJsIiwiYWRkRXZlbnRMaXN0ZW5lciIsImV2ZW50IiwidGFyZ2V0IiwiY2xvc2VzdCIsImlzIiwiZSIsInByZXZlbnREZWZhdWx0Iiwia2V5dXAiLCJrZXlDb2RlIiwibWVzc2FnZUFuYWx5dGljcyIsIm1lc3NhZ2VSZWdpb24iLCJtZXNzYWdlSWQiLCJyZWFkeSIsIm1lc3NhZ2VTZWxlY3RvciIsImNsb3NlVGltZURheXMiLCJkYXRhIiwiY2xvc2VUaW1lSG91cnMiLCJvcGVyYXRvcnMiLCJndCIsImEiLCJiIiwibHQiLCJiYW5uZXJTZXNzaW9uQ291bnQiLCJiYW5uZXJTZXNzaW9uT3BlcmF0b3IiXSwibWFwcGluZ3MiOiI7O0FBQUE7Ozs7Ozs7QUFPQSxTQUFTQSxTQUFULENBQW1CQyxJQUFuQixFQUF5QkMsS0FBekIsRUFBZ0NDLElBQWhDLEVBQXNDO0FBQ3JDLE1BQU1DLENBQUMsR0FBRyxJQUFJQyxJQUFKLEVBQVY7QUFDQUQsRUFBQUEsQ0FBQyxDQUFDRSxPQUFGLENBQVVGLENBQUMsQ0FBQ0csT0FBRixLQUFjLFdBQVdKLElBQW5DO0FBQ0FLLEVBQUFBLFFBQVEsQ0FBQ0MsTUFBVCxHQUFrQlIsSUFBSSxHQUFHLEdBQVAsR0FBYUMsS0FBYixHQUFxQixrQkFBckIsR0FBMENFLENBQUMsQ0FBQ00sV0FBRixFQUE1RDtBQUNBO0FBRUQ7Ozs7Ozs7QUFLQSxTQUFTQyxTQUFULENBQW1CVixJQUFuQixFQUF5QjtBQUN4QixNQUFNVyxDQUFDLEdBQUdKLFFBQVEsQ0FBQ0MsTUFBVCxDQUFnQkksS0FBaEIsQ0FBc0IsWUFBWVosSUFBWixHQUFtQixlQUF6QyxDQUFWO0FBQ0EsU0FBT1csQ0FBQyxHQUFHQSxDQUFDLENBQUMsQ0FBRCxDQUFKLEdBQVUsSUFBbEI7QUFDQTtBQUVEOzs7Ozs7Ozs7OztBQVNBLFNBQVNFLHNCQUFULENBQWdDQyxJQUFoQyxFQUFzQ0MsUUFBdEMsRUFBZ0RDLE1BQWhELEVBQXdEQyxLQUF4RCxFQUErRGhCLEtBQS9ELEVBQXNFO0FBQ3JFYyxFQUFBQSxRQUFRLEdBQ1AsbUJBQW1CQSxRQUFRLENBQUNHLE1BQVQsQ0FBZ0IsQ0FBaEIsRUFBbUJDLFdBQW5CLEVBQW5C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QixHQUFvQ2hELGFBQXBDLEdBQW9ELElBQXJELENBQUQsQ0FBNERvQixNQUFwRSxFQUE0RTtBQUMzRXdCLElBQUFBLGdCQUFnQixDQUFDSSxlQUFlLEdBQUcsU0FBbEIsR0FBOEJoRCxhQUE5QixHQUE4QyxJQUEvQyxDQUFoQjtBQUNBO0FBQ0QsQ0F2REQiLCJmaWxlIjoid3AtbWVzc2FnZS1pbnNlcnRlci1wbHVnaW4tZnJvbnQtZW5kLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBTZXRzIGNvb2tpZXNcbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gbmFtZVxuICogQHBhcmFtIHtzdHJpbmd9IHZhbHVlXG4gKiBAcGFyYW0ge251bWJlcn0gZGF5c1xuICovXG5mdW5jdGlvbiBzZXRDb29raWUobmFtZSwgdmFsdWUsIGRheXMpIHtcblx0Y29uc3QgZCA9IG5ldyBEYXRlKCk7XG5cdGQuc2V0VGltZShkLmdldFRpbWUoKSArIDg2NDAwMDAwICogZGF5cyk7XG5cdGRvY3VtZW50LmNvb2tpZSA9IG5hbWUgKyBcIj1cIiArIHZhbHVlICsgXCI7cGF0aD0vO2V4cGlyZXM9XCIgKyBkLnRvR01UU3RyaW5nKCk7XG59XG5cbi8qKlxuICogUmVhZHMgY29va2llc1xuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBuYW1lXG4gKi9cbmZ1bmN0aW9uIGdldENvb2tpZShuYW1lKSB7XG5cdGNvbnN0IHYgPSBkb2N1bWVudC5jb29raWUubWF0Y2goXCIoXnw7KSA/XCIgKyBuYW1lICsgXCI9KFteO10qKSg7fCQpXCIpO1xuXHRyZXR1cm4gdiA/IHZbMl0gOiBudWxsO1xufVxuXG4vKipcbiAqIENyZWF0aW5nIEFuYWx5dGljcyBldmVudHNcbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gdHlwZVxuICogQHBhcmFtIHtzdHJpbmd9IGNhdGVnb3J5XG4gKiBAcGFyYW0ge3N0cmluZ30gYWN0aW9uXG4gKiBAcGFyYW0ge3N0cmluZ30gbGFiZWxcbiAqIEBwYXJhbSB7QXJyYXl9IHZhbHVlXG4gKi9cbmZ1bmN0aW9uIGFuYWx5dGljc1RyYWNraW5nRXZlbnQodHlwZSwgY2F0ZWdvcnksIGFjdGlvbiwgbGFiZWwsIHZhbHVlKSB7XG5cdGNhdGVnb3J5ID1cblx0XHRcIlNpdGUgTWVzc2FnZTogXCIgKyBjYXRlZ29yeS5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIGNhdGVnb3J5LnNsaWNlKDEpO1xuXHRpZiAoXCJ1bmRlZmluZWRcIiAhPT0gdHlwZW9mIGdhKSB7XG5cdFx0aWYgKFwidW5kZWZpbmVkXCIgPT09IHR5cGVvZiB2YWx1ZSkge1xuXHRcdFx0Z2EoXCJzZW5kXCIsIHR5cGUsIGNhdGVnb3J5LCBhY3Rpb24sIGxhYmVsKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0Z2EoXCJzZW5kXCIsIHR5cGUsIGNhdGVnb3J5LCBhY3Rpb24sIGxhYmVsLCB2YWx1ZSk7XG5cdFx0fVxuXHR9IGVsc2Uge1xuXHR9XG59XG5cbi8qKlxuICogRmF1eCBcIlNlc3Npb25cIiBjaGVja2luZy9zZXR0aW5nXG4gKlxuICogQHJldHVybiB7bnVtYmVyfSBjdXJyZW50Q291bnRcbiAqL1xuZnVuY3Rpb24gc2V0Q3VycmVudENvdW50KCkge1xuXHQvLyBUaW1lc3RhbXAgc3RvcmVkIG9uIHRoZSBjb29raWVcblx0bGV0IGN1cnJlbnRDb3VudCA9IGdldENvb2tpZShcImNvdW50XCIpO1xuXHRjb25zdCB0aW1lc3RhbXAgPSBNYXRoLmZsb29yKG5ldyBEYXRlKCkuZ2V0VGltZSgpIC8gMTAwMCk7XG5cdGNvbnN0IGNvb2tpZUV4cGlyYXRpb24gPSAzMDsgLy8gZXhwaXJlIHRoZSBjb29rZSBpbiAzMCBkYXlzXG5cdGlmICghZ2V0Q29va2llKFwiY291bnRcIikpIHtcblx0XHQvLyBGaXJzdCBWaXNpdCAtIHNldCBjb3VudCB0byAxXG5cdFx0c2V0Q29va2llKFwiY291bnRcIiwgMSwgY29va2llRXhwaXJhdGlvbik7XG5cdFx0Ly8gU2V0IGEgdGltZWNoZWNrIGNvb2tpZSBmb3IgYW4gaG91ciBmcm9tIG5vd1xuXHRcdHNldENvb2tpZShcInRpbWVjaGVja1wiLCB0aW1lc3RhbXAgKyAzNjAwLCBjb29raWVFeHBpcmF0aW9uKTtcblx0fSBlbHNlIGlmICh0aW1lc3RhbXAgPiBnZXRDb29raWUoXCJ0aW1lY2hlY2tcIikpIHtcblx0XHQvLyBVcGRhdGUgVGltZWNoZWNrIHRvIG5ldyB2YWx1ZVxuXHRcdHNldENvb2tpZShcInRpbWVjaGVja1wiLCB0aW1lc3RhbXAgKyAzNjAwLCBjb29raWVFeHBpcmF0aW9uKTtcblx0XHQvLyBDb3VudCBleGlzdHMgYWxyZWFkeSBhbmQgaXQgaGFzIGJlZW4gYW4gaG91ci4gVXBkYXRlIGNvdW50XG5cdFx0c2V0Q29va2llKFwiY291bnRcIiwgKytjdXJyZW50Q291bnQsIGNvb2tpZUV4cGlyYXRpb24pO1xuXHR9XG5cdGNvbnN0IHVybFBhcmFtcyA9IG5ldyBVUkxTZWFyY2hQYXJhbXMod2luZG93LmxvY2F0aW9uLnNlYXJjaCk7XG5cdGlmICh1cmxQYXJhbXMuZ2V0KFwiY291bnRcIikgIT09IG51bGwpIHtcblx0XHRjdXJyZW50Q291bnQgPSBwYXJzZUludCh1cmxQYXJhbXMuZ2V0KFwiY291bnRcIikpO1xuXHR9XG5cdHJldHVybiBjdXJyZW50Q291bnQ7XG59XG5cbi8qKlxuICogR2V0IHRoZSBXb3JkUHJlc3MgcG9zdCBJRCBmb3IgYSBnaXZlbiBwb3B1cC5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gcG9wdXBTZWxlY3RvclxuICogQHJldHVybiB7bnVtYmVyfSBwb3N0SWRcbiAqL1xuZnVuY3Rpb24gZ2V0UG9zdElkKHBvcHVwU2VsZWN0b3IpIHtcblx0bGV0IHBvc3RJZCA9IDA7XG5cdGNvbnN0IGNsYXNzTGlzdCA9ICQoXCIuXCIgKyBwb3B1cFNlbGVjdG9yKVxuXHRcdC5hdHRyKFwiY2xhc3NcIilcblx0XHQuc3BsaXQoL1xccysvKTtcblx0JC5lYWNoKGNsYXNzTGlzdCwgZnVuY3Rpb24oaW5kZXgsIGl0ZW0pIHtcblx0XHRpZiAoMCA8IGl0ZW0uaW5kZXhPZihcIm1lc3NhZ2UtaWRcIikpIHtcblx0XHRcdHBvc3RJZCA9IGl0ZW0uc3Vic3RyaW5nKGl0ZW0ubGFzdEluZGV4T2YoXCItXCIpICsgMSk7XG5cdFx0XHRyZXR1cm4gZmFsc2U7IC8vIGJyZWFrIGVhY2ggYW5kIHBvc3RJZCB3aWxsIGJlIHJldHVybmVkXG5cdFx0fVxuXHR9KTtcblx0cmV0dXJuIHBvc3RJZDtcbn1cblxuLyoqXG4gKiBHZXQgdGhlIHJlZ2lvbiBmb3IgYSBnaXZlbiBtZXNzYWdlLlxuICpcbiAqIEBwYXJhbSB7T2JqZWN0fSBtZXNzYWdlXG4gKiBAcmV0dXJuIHtzdHJpbmd9IHJlZ2lvblxuICovXG5mdW5jdGlvbiBnZXRNZXNzYWdlUmVnaW9uKG1lc3NhZ2UpIHtcblx0bGV0IHJlZ2lvbiA9IFwiXCI7XG5cdGNvbnN0IGNsYXNzTGlzdCA9ICQobWVzc2FnZSlcblx0XHQuYXR0cihcImNsYXNzXCIpXG5cdFx0LnNwbGl0KC9cXHMrLyk7XG5cdCQuZWFjaChjbGFzc0xpc3QsIGZ1bmN0aW9uKGluZGV4LCBpdGVtKSB7XG5cdFx0aWYgKDAgPCBpdGVtLmluZGV4T2YoXCJtZXNzYWdlLXJlZ2lvblwiKSkge1xuXHRcdFx0cmVnaW9uID0gaXRlbS5zdWJzdHJpbmcoaXRlbS5sYXN0SW5kZXhPZihcIi1cIikgKyAxKTtcblx0XHRcdHJldHVybiBmYWxzZTsgLy8gYnJlYWsgZWFjaCBhbmQgcmVnaW9uIHdpbGwgYmUgcmV0dXJuZWRcblx0XHR9XG5cdH0pO1xuXHRyZXR1cm4gcmVnaW9uO1xufVxuXG4vKipcbiAqIFNob3cgYSBzcGVjaWZpYyBwb3B1cC4gU2V0cyBhIGNvb2tpZSBhbmQgYWRkcyBhIHZpc2liaWxpdHkgY2xhc3MuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IHBvcHVwU2VsZWN0b3JcbiAqIEBwYXJhbSB7bnVtYmVyfSBjb29raWVEYXlUb3RhbFxuICogQHBhcmFtIHtzdHJpbmd9IHBvcHVwU2hvd25Db29raWVOYW1lXG4gKiBAcGFyYW0ge3N0cmluZ30gcG9wdXBWaXNpYmxlQ2xhc3NcbiAqL1xuZnVuY3Rpb24gc2hvd1BvcHVwKFxuXHRwb3B1cFNlbGVjdG9yLFxuXHRjb29raWVEYXlUb3RhbCxcblx0cG9wdXBTaG93bkNvb2tpZU5hbWUsXG5cdHBvcHVwVmlzaWJsZUNsYXNzXG4pIHtcblx0bGV0IHBvcHVwSWQgPSAwO1xuXHRzZXRDb29raWUocG9wdXBTaG93bkNvb2tpZU5hbWUsIFwidHJ1ZVwiLCBjb29raWVEYXlUb3RhbCk7XG5cdGlmICgwIDwgJChcIi52YWxpZGF0ZWRcIikubGVuZ3RoKSB7XG5cdFx0JChcIi5cIiArIHBvcHVwU2VsZWN0b3IgKyBcIi52YWxpZGF0ZWRcIikuYWRkQ2xhc3MocG9wdXBWaXNpYmxlQ2xhc3MpO1xuXHRcdHBvcHVwSWQgPSBnZXRQb3N0SWQocG9wdXBTZWxlY3RvciArIFwiLnZhbGlkYXRlZFwiKTtcblx0fSBlbHNlIHtcblx0XHQkKFwiLlwiICsgcG9wdXBTZWxlY3RvciArIFwiOmZpcnN0XCIpLmFkZENsYXNzKHBvcHVwVmlzaWJsZUNsYXNzKTtcblx0XHRwb3B1cElkID0gZ2V0UG9zdElkKHBvcHVwU2VsZWN0b3IgKyBcIjpmaXJzdFwiKTtcblx0fVxuXHRpZiAoMCAhPT0gcG9wdXBJZCkge1xuXHRcdGFuYWx5dGljc1RyYWNraW5nRXZlbnQoXCJldmVudFwiLCBcIlBvcHVwXCIsIFwiU2hvd1wiLCBwb3B1cElkLCB7XG5cdFx0XHRub25JbnRlcmFjdGlvbjogMVxuXHRcdH0pO1xuXHR9XG59XG5cbi8qKlxuICogU2hvdyBhIHNwZWNpZmljIHBvcHVwLiBTZXRzIGEgY29va2llIGFuZCBhZGRzIGEgdmlzaWJpbGl0eSBjbGFzcy5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gcG9wdXBTZWxlY3RvclxuICogQHBhcmFtIHtzdHJpbmd9IHBvcHVwVmlzaWJsZUNsYXNzXG4gKiBAcGFyYW0ge09iamVjdH0gbGFzdEZvY3VzXG4gKiBAcGFyYW0ge3N0cmluZ30gY2xvc2VUcmlnZ2VyXG4gKi9cbmZ1bmN0aW9uIGhpZGVQb3B1cChwb3B1cFNlbGVjdG9yLCBwb3B1cFZpc2libGVDbGFzcywgbGFzdEZvY3VzLCBjbG9zZVRyaWdnZXIpIHtcblx0bGFzdEZvY3VzLmZvY3VzKCk7XG5cdCQoXCIuXCIgKyBwb3B1cFNlbGVjdG9yKS5yZW1vdmVDbGFzcyhwb3B1cFZpc2libGVDbGFzcyk7XG5cdGNvbnN0IHBvcHVwSWQgPSBnZXRQb3N0SWQocG9wdXBTZWxlY3Rvcik7XG5cdGlmICgwICE9PSBwb3B1cElkKSB7XG5cdFx0YW5hbHl0aWNzVHJhY2tpbmdFdmVudChcImV2ZW50XCIsIFwiUG9wdXBcIiwgY2xvc2VUcmlnZ2VyLCBwb3B1cElkLCB7XG5cdFx0XHRub25JbnRlcmFjdGlvbjogMVxuXHRcdH0pO1xuXHR9XG59XG5cbi8qKlxuICogRGlzcGxheSBhbmQgY29udHJvbHMgZm9yIHBvcHVwc1xuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBwb3B1cFNlbGVjdG9yXG4gKiBAcGFyYW0ge251bWJlcn0gY29va2llRGF5VG90YWxcbiAqIEBwYXJhbSB7c3RyaW5nfSBwb3B1cFNob3duQ29va2llTmFtZVxuICogQHBhcmFtIHtzdHJpbmd9IHBvcHVwVmlzaWJsZUNsYXNzXG4gKiBAcGFyYW0ge3N0cmluZ30gY2hlY2tTZXNzaW9uQ2xhc3NcbiAqL1xuZnVuY3Rpb24gcG9wdXBEaXNwbGF5KFxuXHRwb3B1cFNlbGVjdG9yLFxuXHRjb29raWVEYXlUb3RhbCxcblx0cG9wdXBTaG93bkNvb2tpZU5hbWUsXG5cdHBvcHVwVmlzaWJsZUNsYXNzLFxuXHRjaGVja1Nlc3Npb25DbGFzc1xuKSB7XG5cdGNvbnN0IGxhc3RGb2N1cyA9IGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQ7XG5cdC8vIHB1dCBpbiBhIGNsb3NlIGJ1dHRvbiBhdCB0aGUgZW5kXG5cdCQoXCIuXCIgKyBwb3B1cFNlbGVjdG9yICsgXCIgLm0td3AtaW5zZXJ0LW1lc3NhZ2UtaXRlbVwiKS5hcHBlbmQoXG5cdFx0JzxhIGhyZWY9XCIjXCIgY2xhc3M9XCJzbS1jbG9zZS1idG5cIiBhcmlhLWxhYmVsPVwiQ2xvc2VcIj48aSBjbGFzcz1cImZhciBmYS10aW1lcy1jaXJjbGVcIiBhcmlhLWhpZGRlbj1cInRydWVcIj48L2k+PC9pPjwvYT4nXG5cdCk7XG5cdC8vIENoZWNrIGlmIHdlIHNob3VsZCBiZSBzaG93aW5nIHRoZSBwb3B1cFxuXHRpZiAoXG5cdFx0XCJ0cnVlXCIgIT09IGdldENvb2tpZShwb3B1cFNob3duQ29va2llTmFtZSkgJiZcblx0XHQhJChcIi5cIiArIHBvcHVwU2VsZWN0b3IpLmhhc0NsYXNzKGNoZWNrU2Vzc2lvbkNsYXNzKVxuXHQpIHtcblx0XHRzaG93UG9wdXAoXG5cdFx0XHRwb3B1cFNlbGVjdG9yLFxuXHRcdFx0Y29va2llRGF5VG90YWwsXG5cdFx0XHRwb3B1cFNob3duQ29va2llTmFtZSxcblx0XHRcdHBvcHVwVmlzaWJsZUNsYXNzXG5cdFx0KTtcblx0fVxuXG5cdC8vIGNsaWNrIG9uIGxvZ2luIGxpbmsgaW5zaWRlIHBvcHVwXG5cdCQoXCIuXCIgKyBwb3B1cFNlbGVjdG9yKS5vbihcImNsaWNrXCIsIFwiLm1lc3NhZ2UtbG9naW5cIiwgZnVuY3Rpb24oKSB7XG5cdFx0Y29uc3QgdXJsID0gJCh0aGlzKS5hdHRyKFwiaHJlZlwiKTtcblx0XHRhbmFseXRpY3NUcmFja2luZ0V2ZW50KFwiZXZlbnRcIiwgXCJQb3B1cFwiLCBcIkxvZ2luIExpbmtcIiwgdXJsKTtcblx0fSk7XG5cblx0ZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcblx0XHRcImNsaWNrXCIsXG5cdFx0ZnVuY3Rpb24oZXZlbnQpIHtcblx0XHRcdGlmIChcblx0XHRcdFx0ISQoZXZlbnQudGFyZ2V0KVxuXHRcdFx0XHRcdC5jbG9zZXN0KFwiLlwiICsgcG9wdXBTZWxlY3Rvcilcblx0XHRcdFx0XHQuaXMoXCIuXCIgKyBwb3B1cFNlbGVjdG9yKSAmJlxuXHRcdFx0XHQkKFwiLlwiICsgcG9wdXBTZWxlY3RvcikuaGFzQ2xhc3MocG9wdXBWaXNpYmxlQ2xhc3MpXG5cdFx0XHQpIHtcblx0XHRcdFx0aGlkZVBvcHVwKFxuXHRcdFx0XHRcdHBvcHVwU2VsZWN0b3IsXG5cdFx0XHRcdFx0cG9wdXBWaXNpYmxlQ2xhc3MsXG5cdFx0XHRcdFx0bGFzdEZvY3VzLFxuXHRcdFx0XHRcdFwiQ2xpY2sgT3V0c2lkZSB0byBDbG9zZVwiXG5cdFx0XHRcdCk7XG5cdFx0XHR9XG5cdFx0fSxcblx0XHR0cnVlXG5cdCk7XG5cblx0Ly8gcG9wdXAgY2xvc2UgYnV0dG9uXG5cdCQoXCIuXCIgKyBwb3B1cFNlbGVjdG9yKS5vbihcImNsaWNrXCIsIFwiLnNtLWNsb3NlLWJ0blwiLCBmdW5jdGlvbihlKSB7XG5cdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdGhpZGVQb3B1cChwb3B1cFNlbGVjdG9yLCBwb3B1cFZpc2libGVDbGFzcywgbGFzdEZvY3VzLCBcIkNsb3NlIEJ1dHRvblwiKTtcblx0fSk7XG5cblx0Ly8gZXNjYXBlIGtleSBwcmVzc1xuXHQkKGRvY3VtZW50KS5rZXl1cChmdW5jdGlvbihlKSB7XG5cdFx0aWYgKDI3ID09PSBlLmtleUNvZGUpIHtcblx0XHRcdGhpZGVQb3B1cChwb3B1cFNlbGVjdG9yLCBwb3B1cFZpc2libGVDbGFzcywgbGFzdEZvY3VzLCBcIkVzY2FwZSBLZXlcIik7XG5cdFx0fVxuXHR9KTtcblxuXHQvLyBjbGljayBvbiBhIG5vbi1sb2dpbiBvciBjbG9zZSBsaW5rIGluc2lkZSBwb3B1cFxuXHQkKFwiLlwiICsgcG9wdXBTZWxlY3Rvcikub24oXG5cdFx0XCJjbGlja1wiLFxuXHRcdFwiYTpub3QoIC5zbS1jbG9zZS1idG4sIC5tZXNzYWdlLWxvZ2luIClcIixcblx0XHRmdW5jdGlvbigpIHtcblx0XHRcdGNvbnN0IHBvcHVwSWQgPSBnZXRQb3N0SWQocG9wdXBTZWxlY3Rvcik7XG5cdFx0XHRhbmFseXRpY3NUcmFja2luZ0V2ZW50KFwiZXZlbnRcIiwgXCJQb3B1cFwiLCBcIkNsaWNrXCIsIHBvcHVwSWQpO1xuXHRcdH1cblx0KTtcbn1cblxuZnVuY3Rpb24gbWVzc2FnZUFuYWx5dGljcyhtZXNzYWdlKSB7XG5cdGNvbnN0IG1lc3NhZ2VSZWdpb24gPSBnZXRNZXNzYWdlUmVnaW9uKFwiLlwiICsgbWVzc2FnZSk7XG5cdGNvbnN0IG1lc3NhZ2VJZCA9IGdldFBvc3RJZChtZXNzYWdlKTtcblx0aWYgKCQoXCIuXCIgKyBtZXNzYWdlKS5pcyhcIjp2aXNpYmxlXCIpKSB7XG5cdFx0YW5hbHl0aWNzVHJhY2tpbmdFdmVudChcImV2ZW50XCIsIG1lc3NhZ2VSZWdpb24sIFwiU2hvd1wiLCBtZXNzYWdlSWQsIHtcblx0XHRcdG5vbkludGVyYWN0aW9uOiAxXG5cdFx0fSk7XG5cdH1cblx0Ly8gY2xpY2sgb24gbG9naW4gbGluayBpbnNpZGUgYSBtZXNzYWdlXG5cdCQoXCIuXCIgKyBtZXNzYWdlKS5vbihcImNsaWNrXCIsIFwiLm1lc3NhZ2UtbG9naW5cIiwgZnVuY3Rpb24oKSB7XG5cdFx0Y29uc3QgdXJsID0gJCh0aGlzKS5hdHRyKFwiaHJlZlwiKTtcblx0XHRhbmFseXRpY3NUcmFja2luZ0V2ZW50KFwiZXZlbnRcIiwgbWVzc2FnZVJlZ2lvbiwgXCJMb2dpbiBMaW5rXCIsIHVybCk7XG5cdH0pO1xuXG5cdC8vIGNsaWNrIG9uIGEgbm9uLWxvZ2luIG9yIGNsb3NlIGxpbmsgaW5zaWRlIGEgbWVzc2FnZVxuXHQkKFwiLlwiICsgbWVzc2FnZSkub24oXG5cdFx0XCJjbGlja1wiLFxuXHRcdFwiYTpub3QoIC5zbS1jbG9zZS1idG4sIC5tZXNzYWdlLWxvZ2luIClcIixcblx0XHRmdW5jdGlvbigpIHtcblx0XHRcdGFuYWx5dGljc1RyYWNraW5nRXZlbnQoXCJldmVudFwiLCBtZXNzYWdlUmVnaW9uLCBcIkNsaWNrXCIsIG1lc3NhZ2VJZCk7XG5cdFx0fVxuXHQpO1xufVxuXG4vKipcbiAqIFdoZW4galF1ZXJ5IGlzIGxvYWRlZCwgc2V0IHVwIHNlc3Npb24gdHJhY2tpbmcgYW5kIHBvcHVwIGRpc3BsYXlcbiAqXG4gKi9cbiQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkge1xuXHRjb25zdCBwb3B1cFNlbGVjdG9yID0gXCJ3cC1tZXNzYWdlLWluc2VydGVyLW1lc3NhZ2UtcmVnaW9uLXBvcHVwXCI7XG5cdGNvbnN0IHBvcHVwU2hvd25Db29raWVOYW1lID0gXCJzbS1zaG93blwiO1xuXHRjb25zdCBwb3B1cFZpc2libGVDbGFzcyA9IFwid3AtbWVzc2FnZS1pbnNlcnRlci1tZXNzYWdlLXBvcHVwLXZpc2libGVcIjtcblx0Y29uc3QgY2hlY2tTZXNzaW9uQ2xhc3MgPSBcImNoZWNrLXNlc3Npb24tbWVzc2FnZVwiO1xuXHRjb25zdCBtZXNzYWdlU2VsZWN0b3IgPSBcIndwLW1lc3NhZ2UtaW5zZXJ0ZXItbWVzc2FnZVwiO1xuXG5cdC8vIEdldCBvdXIgdmFsdWUgZm9yIGRheXMgYW5kIGhvdXJzIHRvIHNldCBjb29raWVcblx0Y29uc3QgY2xvc2VUaW1lRGF5cyA9XG5cdFx0cGFyc2VJbnQoJChcIi5cIiArIHBvcHVwU2VsZWN0b3IpLmRhdGEoXCJjbG9zZS10aW1lLWRheXNcIikpIHx8IDA7XG5cdGNvbnN0IGNsb3NlVGltZUhvdXJzID1cblx0XHQocGFyc2VJbnQoJChcIi5cIiArIHBvcHVwU2VsZWN0b3IpLmRhdGEoXCJjbG9zZS10aW1lLWhvdXJzXCIpKSB8fCAwKSAvIDI0O1xuXHQvLyBPdXIgVG90YWwgZm9yIHdoZW4gdGhlIGNvb2tpZSBzaG91bGQgZXhwaXJlIGFuZCBzaG93IHRoZSBiYW5uZXIgYWdhaW5cblx0Y29uc3QgY29va2llRGF5VG90YWwgPSBjbG9zZVRpbWVEYXlzICsgY2xvc2VUaW1lSG91cnM7XG5cblx0Ly8gU2Vzc2lvbiBWYWxpZGF0aW5nIGFuZCBzaG93aW5nIHByb3BlciBiYW5uZXJcblx0Y29uc3Qgb3BlcmF0b3JzID0ge1xuXHRcdGd0KGEsIGIpIHtcblx0XHRcdHJldHVybiBhID49IGI7XG5cdFx0fSxcblx0XHRsdChhLCBiKSB7XG5cdFx0XHRyZXR1cm4gYSA8PSBiO1xuXHRcdH1cblx0fTtcblxuXHRjb25zdCBjdXJyZW50Q291bnQgPSBzZXRDdXJyZW50Q291bnQoKTtcblxuXHRpZiAoMCA8ICQoXCIuXCIgKyBjaGVja1Nlc3Npb25DbGFzcykubGVuZ3RoKSB7XG5cdFx0JChcIi5cIiArIGNoZWNrU2Vzc2lvbkNsYXNzKS5lYWNoKGZ1bmN0aW9uKCkge1xuXHRcdFx0Y29uc3QgYmFubmVyU2Vzc2lvbkNvdW50ID0gcGFyc2VJbnQoXG5cdFx0XHRcdCQodGhpcykuZGF0YShcInNlc3Npb24tY291bnQtdG8tY2hlY2tcIilcblx0XHRcdCk7XG5cdFx0XHRjb25zdCBiYW5uZXJTZXNzaW9uT3BlcmF0b3IgPSAkKHRoaXMpLmRhdGEoXCJzZXNzaW9uLWNvdW50LW9wZXJhdG9yXCIpO1xuXHRcdFx0aWYgKG9wZXJhdG9yc1tiYW5uZXJTZXNzaW9uT3BlcmF0b3JdKGN1cnJlbnRDb3VudCwgYmFubmVyU2Vzc2lvbkNvdW50KSkge1xuXHRcdFx0XHRpZiAoISQodGhpcykuaGFzQ2xhc3MocG9wdXBTZWxlY3RvcikpIHtcblx0XHRcdFx0XHQkKHRoaXMpLmFkZENsYXNzKFwidmFsaWRhdGVkXCIpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCFnZXRDb29raWUocG9wdXBTaG93bkNvb2tpZU5hbWUpKSB7XG5cdFx0XHRcdFx0JCh0aGlzKS5hZGRDbGFzcyhcInZhbGlkYXRlZFwiKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH0pO1xuXHR9XG5cblx0aWYgKDAgPCAkKFwiLlwiICsgcG9wdXBTZWxlY3RvcikubGVuZ3RoKSB7XG5cdFx0cG9wdXBEaXNwbGF5KFxuXHRcdFx0cG9wdXBTZWxlY3Rvcixcblx0XHRcdGNvb2tpZURheVRvdGFsLFxuXHRcdFx0cG9wdXBTaG93bkNvb2tpZU5hbWUsXG5cdFx0XHRwb3B1cFZpc2libGVDbGFzc1xuXHRcdCk7XG5cdH1cblxuXHRpZiAoMCA8ICQoXCIuXCIgKyBtZXNzYWdlU2VsZWN0b3IgKyBcIjpub3QoIC5cIiArIHBvcHVwU2VsZWN0b3IgKyBcIiApXCIpLmxlbmd0aCkge1xuXHRcdG1lc3NhZ2VBbmFseXRpY3MobWVzc2FnZVNlbGVjdG9yICsgXCI6bm90KCAuXCIgKyBwb3B1cFNlbGVjdG9yICsgXCIgKVwiKTtcblx0fVxufSk7XG4iXX0=
}(jQuery));
