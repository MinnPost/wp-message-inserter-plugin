;(function($) {
"use strict";

/**
 * Sets cookies
 *
 * @param {string} name
 * @param {string} value
 * @param {number} days
 */
function setCookie(name, value, days) {
  var d = new Date();
  d.setTime(d.getTime() + 86400000 * days);
  document.cookie = name + '=' + value + ';path=/;expires=' + d.toGMTString();
}
/**
 * Reads cookies
 *
 * @param {string} name
 */


function getCookie(name) {
  var v = document.cookie.match('(^|;) ?' + name + '=([^;]*)(;|$)');
  return v ? v[2] : null;
}
/**
 * Creating Analytics events
 *
 * @param {string} type
 * @param {string} category
 * @param {string} action
 * @param {string} label
 * @param {Array}  value
 */


function analyticsTrackingEvent(type, category, action, label, value, non_interaction) {
  category = 'Site Message: ' + category.charAt(0).toUpperCase() + category.slice(1);

  if (typeof gtag !== 'undefined') {
    var params = {
      'event_category': category,
      'event_label': label
    };

    if (typeof value !== 'undefined') {
      params.value = value;
    }

    if (typeof non_interaction !== 'undefined') {
      params.non_interaction = non_interaction;
    }

    gtag(type, action, params);
  } else if (typeof ga !== 'undefined') {
    if (non_interaction == 1) {
      value = {
        'nonInteraction': 1
      };
    }

    if ('undefined' === typeof value) {
      ga('send', type, category, action, label);
    } else {
      ga('send', type, category, action, label, value);
    }
  } else {
    return;
  }
}
/**
 * Faux "Session" checking/setting
 *
 * @return {number} currentCount
 */


function setCurrentCount() {
  // Timestamp stored on the cookie
  var currentCount = getCookie('count');
  var timestamp = Math.floor(new Date().getTime() / 1000);
  var cookieExpiration = 30; // expire the cooke in 30 days

  if (!getCookie('count')) {
    // First Visit - set count to 1
    setCookie('count', 1, cookieExpiration); // Set a timecheck cookie for an hour from now

    setCookie('timecheck', timestamp + 3600, cookieExpiration);
  } else if (timestamp > getCookie('timecheck')) {
    // Update Timecheck to new value
    setCookie('timecheck', timestamp + 3600, cookieExpiration); // Count exists already and it has been an hour. Update count

    setCookie('count', ++currentCount, cookieExpiration);
  }

  var urlParams = new URLSearchParams(window.location.search);

  if (urlParams.get('count') !== null) {
    currentCount = parseInt(urlParams.get('count'));
  }

  return currentCount;
}
/**
 * Get the WordPress post ID for a given popup.
 *
 * @param {string} popupSelector
 * @return {number} postId
 */


function getPostId(popupSelector) {
  var postId = 0;
  var classList = $('.' + popupSelector).attr('class').split(/\s+/);
  $.each(classList, function (index, item) {
    if (0 < item.indexOf('message-id')) {
      postId = item.substring(item.lastIndexOf('-') + 1);
      return false; // break each and postId will be returned
    }
  });
  return postId;
}
/**
 * Get the region for a given message.
 *
 * @param {Object} message
 * @return {string} region
 */


function getMessageRegion(message) {
  var region = '';
  var classList = $(message).attr('class').split(/\s+/);
  $.each(classList, function (index, item) {
    if (0 < item.indexOf('message-region')) {
      region = item.substring(item.lastIndexOf('-') + 1);
      return false; // break each and region will be returned
    }
  });
  return region;
}
/**
 * Show a specific popup. Sets a cookie and adds a visibility class.
 *
 * @param {string} popupSelector
 * @param {number} cookieDayTotal
 * @param {string} popupShownCookieName
 * @param {string} popupVisibleClass
 */


function showPopup(popupSelector, cookieDayTotal, popupShownCookieName, popupVisibleClass) {
  var popupId = 0;
  setCookie(popupShownCookieName, 'true', cookieDayTotal);

  if (0 < $('.validated').length) {
    $('.' + popupSelector + '.validated').addClass(popupVisibleClass);
    popupId = getPostId(popupSelector + '.validated');
  } else {
    $('.' + popupSelector + ':first').addClass(popupVisibleClass);
    popupId = getPostId(popupSelector + ':first');
  }

  if (0 !== popupId) {
    analyticsTrackingEvent('event', 'Popup', 'Show', popupId, undefined, 1);
  }
}
/**
 * Show a specific popup. Sets a cookie and adds a visibility class.
 *
 * @param {string} popupSelector
 * @param {string} popupVisibleClass
 * @param {Object} lastFocus
 * @param {string} closeTrigger
 */


function hidePopup(popupSelector, popupVisibleClass, lastFocus, closeTrigger) {
  lastFocus.focus();
  $('.' + popupSelector).removeClass(popupVisibleClass);
  var popupId = getPostId(popupSelector);

  if (0 !== popupId) {
    analyticsTrackingEvent('event', 'Popup', closeTrigger, popupId, undefined, 1);
  }
}
/**
 * Display and controls for popups
 *
 * @param {string} popupSelector
 * @param {number} cookieDayTotal
 * @param {string} popupShownCookieName
 * @param {string} popupVisibleClass
 * @param {string} checkSessionClass
 */


function popupDisplay(popupSelector, cookieDayTotal, popupShownCookieName, popupVisibleClass, checkSessionClass) {
  var lastFocus = document.activeElement; // eslint-disable-line
  // Check if we should be showing the popup

  if ('true' !== getCookie(popupShownCookieName) && !$('.' + popupSelector).hasClass(checkSessionClass)) {
    showPopup(popupSelector, cookieDayTotal, popupShownCookieName, popupVisibleClass);
  } // click on login link inside popup


  $('.' + popupSelector).on('click', '.message-login', function () {
    var url = $(this).attr('href');
    analyticsTrackingEvent('event', 'Popup', 'Login Link', url);
  });
  document.addEventListener('click', function (event) {
    if (!$(event.target).closest('.' + popupSelector).is('.' + popupSelector) && $('.' + popupSelector).hasClass(popupVisibleClass)) {
      hidePopup(popupSelector, popupVisibleClass, lastFocus, 'Click Outside to Close');
    }
  }, true); // popup close button

  $('.' + popupSelector).on('click', '.sm-close-btn', function (e) {
    e.preventDefault();
    hidePopup(popupSelector, popupVisibleClass, lastFocus, 'Close Button');
  }); // escape key press

  $(document).keyup(function (e) {
    if (27 === e.keyCode) {
      hidePopup(popupSelector, popupVisibleClass, lastFocus, 'Escape Key');
    }
  }); // click on a non-login or close link inside popup

  $('.' + popupSelector).on('click', 'a:not( .sm-close-btn, .message-login )', function () {
    var popupId = getPostId(popupSelector);
    analyticsTrackingEvent('event', 'Popup', 'Click', popupId);
  });
}

function messageAnalytics(message) {
  var messageRegion = getMessageRegion('.' + message);
  var messageId = getPostId(message);

  if ($('.' + message).is(':visible')) {
    analyticsTrackingEvent('event', messageRegion, 'Show', messageId, undefined, 1);
  } // click on login link inside a message


  $('.' + message).on('click', '.message-login', function () {
    var url = $(this).attr('href');
    analyticsTrackingEvent('event', messageRegion, 'Login Link', url);
  }); // click on a non-login or close link inside a message

  $('.' + message).on('click', 'a:not( .sm-close-btn, .message-login )', function () {
    analyticsTrackingEvent('event', messageRegion, 'Click', messageId);
  });
}
/**
 * When jQuery is loaded, set up session tracking and popup display
 *
 */


$(document).ready(function () {
  var popupSelector = 'wp-message-inserter-message-region-popup';
  var popupShownCookieName = 'sm-shown';
  var popupVisibleClass = 'wp-message-inserter-message-popup-visible';
  var checkSessionClass = 'check-session-message';
  var messageSelector = 'wp-message-inserter-message'; // Get our value for days and hours to set cookie

  var closeTimeDays = parseInt($('.' + popupSelector).data('close-time-days')) || 0;
  var closeTimeHours = (parseInt($('.' + popupSelector).data('close-time-hours')) || 0) / 24; // Our Total for when the cookie should expire and show the banner again

  var cookieDayTotal = closeTimeDays + closeTimeHours; // Session Validating and showing proper banner

  var operators = {
    gt: function gt(a, b) {
      return a >= b;
    },
    lt: function lt(a, b) {
      return a <= b;
    }
  };
  var currentCount = setCurrentCount();

  if (0 < $('.' + checkSessionClass).length) {
    $('.' + checkSessionClass).each(function () {
      var bannerSessionCount = parseInt($(this).data('session-count-to-check'));
      var bannerSessionOperator = $(this).data('session-count-operator');

      if (operators[bannerSessionOperator](currentCount, bannerSessionCount)) {
        if (!$(this).hasClass(popupSelector)) {
          $(this).addClass('validated');
        } else if (!getCookie(popupShownCookieName)) {
          $(this).addClass('validated');
        }
      }
    });
  }

  if (0 < $('.' + popupSelector).length) {
    popupDisplay(popupSelector, cookieDayTotal, popupShownCookieName, popupVisibleClass);
  }

  if (0 < $('.' + messageSelector + ':not( .' + popupSelector + ' )').length) {
    messageAnalytics(messageSelector + ':not( .' + popupSelector + ' )');
  }
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIjAxLW1lc3NhZ2VzLmpzIl0sIm5hbWVzIjpbInNldENvb2tpZSIsIm5hbWUiLCJ2YWx1ZSIsImRheXMiLCJkIiwiRGF0ZSIsInNldFRpbWUiLCJnZXRUaW1lIiwiZG9jdW1lbnQiLCJjb29raWUiLCJ0b0dNVFN0cmluZyIsImdldENvb2tpZSIsInYiLCJtYXRjaCIsImFuYWx5dGljc1RyYWNraW5nRXZlbnQiLCJ0eXBlIiwiY2F0ZWdvcnkiLCJhY3Rpb24iLCJsYWJlbCIsIm5vbl9pbnRlcmFjdGlvbiIsImNoYXJBdCIsInRvVXBwZXJDYXNlIiwic2xpY2UiLCJndGFnIiwicGFyYW1zIiwiZ2EiLCJzZXRDdXJyZW50Q291bnQiLCJjdXJyZW50Q291bnQiLCJ0aW1lc3RhbXAiLCJNYXRoIiwiZmxvb3IiLCJjb29raWVFeHBpcmF0aW9uIiwidXJsUGFyYW1zIiwiVVJMU2VhcmNoUGFyYW1zIiwid2luZG93IiwibG9jYXRpb24iLCJzZWFyY2giLCJnZXQiLCJwYXJzZUludCIsImdldFBvc3RJZCIsInBvcHVwU2VsZWN0b3IiLCJwb3N0SWQiLCJjbGFzc0xpc3QiLCIkIiwiYXR0ciIsInNwbGl0IiwiZWFjaCIsImluZGV4IiwiaXRlbSIsImluZGV4T2YiLCJzdWJzdHJpbmciLCJsYXN0SW5kZXhPZiIsImdldE1lc3NhZ2VSZWdpb24iLCJtZXNzYWdlIiwicmVnaW9uIiwic2hvd1BvcHVwIiwiY29va2llRGF5VG90YWwiLCJwb3B1cFNob3duQ29va2llTmFtZSIsInBvcHVwVmlzaWJsZUNsYXNzIiwicG9wdXBJZCIsImxlbmd0aCIsImFkZENsYXNzIiwidW5kZWZpbmVkIiwiaGlkZVBvcHVwIiwibGFzdEZvY3VzIiwiY2xvc2VUcmlnZ2VyIiwiZm9jdXMiLCJyZW1vdmVDbGFzcyIsInBvcHVwRGlzcGxheSIsImNoZWNrU2Vzc2lvbkNsYXNzIiwiYWN0aXZlRWxlbWVudCIsImhhc0NsYXNzIiwib24iLCJ1cmwiLCJhZGRFdmVudExpc3RlbmVyIiwiZXZlbnQiLCJ0YXJnZXQiLCJjbG9zZXN0IiwiaXMiLCJlIiwicHJldmVudERlZmF1bHQiLCJrZXl1cCIsImtleUNvZGUiLCJtZXNzYWdlQW5hbHl0aWNzIiwibWVzc2FnZVJlZ2lvbiIsIm1lc3NhZ2VJZCIsInJlYWR5IiwibWVzc2FnZVNlbGVjdG9yIiwiY2xvc2VUaW1lRGF5cyIsImRhdGEiLCJjbG9zZVRpbWVIb3VycyIsIm9wZXJhdG9ycyIsImd0IiwiYSIsImIiLCJsdCIsImJhbm5lclNlc3Npb25Db3VudCIsImJhbm5lclNlc3Npb25PcGVyYXRvciJdLCJtYXBwaW5ncyI6Ijs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVNBLFNBQVQsQ0FBbUJDLElBQW5CLEVBQXlCQyxLQUF6QixFQUFnQ0MsSUFBaEMsRUFBc0M7QUFDckMsTUFBTUMsQ0FBQyxHQUFHLElBQUlDLElBQUosRUFBVjtBQUNBRCxFQUFBQSxDQUFDLENBQUNFLE9BQUYsQ0FBVUYsQ0FBQyxDQUFDRyxPQUFGLEtBQWMsV0FBV0osSUFBbkM7QUFDQUssRUFBQUEsUUFBUSxDQUFDQyxNQUFULEdBQWtCUixJQUFJLEdBQUcsR0FBUCxHQUFhQyxLQUFiLEdBQXFCLGtCQUFyQixHQUEwQ0UsQ0FBQyxDQUFDTSxXQUFGLEVBQTVEO0FBQ0E7QUFFRDtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFDQSxTQUFTQyxTQUFULENBQW1CVixJQUFuQixFQUF5QjtBQUN4QixNQUFNVyxDQUFDLEdBQUdKLFFBQVEsQ0FBQ0MsTUFBVCxDQUFnQkksS0FBaEIsQ0FBc0IsWUFBWVosSUFBWixHQUFtQixlQUF6QyxDQUFWO0FBQ0EsU0FBT1csQ0FBQyxHQUFHQSxDQUFDLENBQUMsQ0FBRCxDQUFKLEdBQVUsSUFBbEI7QUFDQTtBQUVEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBQ0EsU0FBU0Usc0JBQVQsQ0FBZ0NDLElBQWhDLEVBQXNDQyxRQUF0QyxFQUFnREMsTUFBaEQsRUFBd0RDLEtBQXhELEVBQStE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RCxDQUFELENBQVE4QyxJQUFSLENBQzdCLHdCQUQ2QixDQUE5Qjs7QUFHQSxVQUNDRSxTQUFTLENBQUNNLHFCQUFELENBQVQsQ0FDQ3RFLFlBREQsRUFFQ3FFLGtCQUZELENBREQsRUFLRTtBQUNELFlBQUksQ0FBQ3JELENBQUMsQ0FBQyxJQUFELENBQUQsQ0FBUTRCLFFBQVIsQ0FBaUIvQixhQUFqQixDQUFMLEVBQXNDO0FBQ3JDRyxVQUFBQSxDQUFDLENBQUMsSUFBRCxDQUFELENBQVFrQixRQUFSLENBQWlCLFdBQWpCO0FBQ0EsU0FGRCxNQUVPLElBQUksQ0FBQ2xELFNBQVMsQ0FBQzhDLG9CQUFELENBQWQsRUFBc0M7QUFDNUNkLFVBQUFBLENBQUMsQ0FBQyxJQUFELENBQUQsQ0FBUWtCLFFBQVIsQ0FBaUIsV0FBakI7QUFDQTtBQUNEO0FBQ0QsS0FuQkQ7QUFvQkE7O0FBRUQsTUFBSSxJQUFJbEIsQ0FBQyxDQUFDLE1BQU1ILGFBQVAsQ0FBRCxDQUF1Qm9CLE1BQS9CLEVBQXVDO0FBQ3RDUSxJQUFBQSxZQUFZLENBQ1g1QixhQURXLEVBRVhnQixjQUZXLEVBR1hDLG9CQUhXLEVBSVhDLGlCQUpXLENBQVo7QUFNQTs7QUFFRCxNQUNDLElBQUlmLENBQUMsQ0FBQyxNQUFNNEMsZUFBTixHQUF3QixTQUF4QixHQUFvQy9DLGFBQXBDLEdBQW9ELElBQXJELENBQUQsQ0FBNERvQixNQURqRSxFQUVFO0FBQ0R1QixJQUFBQSxnQkFBZ0IsQ0FBQ0ksZUFBZSxHQUFHLFNBQWxCLEdBQThCL0MsYUFBOUIsR0FBOEMsSUFBL0MsQ0FBaEI7QUFDQTtBQUNELENBaEVEIiwiZmlsZSI6IndwLW1lc3NhZ2UtaW5zZXJ0ZXItcGx1Z2luLWZyb250LWVuZC5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogU2V0cyBjb29raWVzXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IG5hbWVcbiAqIEBwYXJhbSB7c3RyaW5nfSB2YWx1ZVxuICogQHBhcmFtIHtudW1iZXJ9IGRheXNcbiAqL1xuZnVuY3Rpb24gc2V0Q29va2llKG5hbWUsIHZhbHVlLCBkYXlzKSB7XG5cdGNvbnN0IGQgPSBuZXcgRGF0ZSgpO1xuXHRkLnNldFRpbWUoZC5nZXRUaW1lKCkgKyA4NjQwMDAwMCAqIGRheXMpO1xuXHRkb2N1bWVudC5jb29raWUgPSBuYW1lICsgJz0nICsgdmFsdWUgKyAnO3BhdGg9LztleHBpcmVzPScgKyBkLnRvR01UU3RyaW5nKCk7XG59XG5cbi8qKlxuICogUmVhZHMgY29va2llc1xuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBuYW1lXG4gKi9cbmZ1bmN0aW9uIGdldENvb2tpZShuYW1lKSB7XG5cdGNvbnN0IHYgPSBkb2N1bWVudC5jb29raWUubWF0Y2goJyhefDspID8nICsgbmFtZSArICc9KFteO10qKSg7fCQpJyk7XG5cdHJldHVybiB2ID8gdlsyXSA6IG51bGw7XG59XG5cbi8qKlxuICogQ3JlYXRpbmcgQW5hbHl0aWNzIGV2ZW50c1xuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSB0eXBlXG4gKiBAcGFyYW0ge3N0cmluZ30gY2F0ZWdvcnlcbiAqIEBwYXJhbSB7c3RyaW5nfSBhY3Rpb25cbiAqIEBwYXJhbSB7c3RyaW5nfSBsYWJlbFxuICogQHBhcmFtIHtBcnJheX0gIHZhbHVlXG4gKi9cbmZ1bmN0aW9uIGFuYWx5dGljc1RyYWNraW5nRXZlbnQodHlwZSwgY2F0ZWdvcnksIGFjdGlvbiwgbGFiZWwsIHZhbHVlLCBub25faW50ZXJhY3Rpb24pIHtcblx0Y2F0ZWdvcnkgPSAnU2l0ZSBNZXNzYWdlOiAnICsgY2F0ZWdvcnkuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyBjYXRlZ29yeS5zbGljZSgxKTtcblx0aWYgKCB0eXBlb2YgZ3RhZyAhPT0gJ3VuZGVmaW5lZCcgKSB7XG5cdFx0dmFyIHBhcmFtcyA9IHtcblx0XHRcdCdldmVudF9jYXRlZ29yeSc6IGNhdGVnb3J5LFxuXHRcdFx0J2V2ZW50X2xhYmVsJzogbGFiZWxcblx0XHR9O1xuXHRcdGlmICggdHlwZW9mIHZhbHVlICE9PSAndW5kZWZpbmVkJyApIHtcblx0XHRcdHBhcmFtcy52YWx1ZSA9IHZhbHVlO1xuXHRcdH1cblx0XHRpZiAoIHR5cGVvZiBub25faW50ZXJhY3Rpb24gIT09ICd1bmRlZmluZWQnICkge1xuXHRcdFx0cGFyYW1zLm5vbl9pbnRlcmFjdGlvbiA9IG5vbl9pbnRlcmFjdGlvbjtcblx0XHR9XG5cdFx0Z3RhZyggdHlwZSwgYWN0aW9uLCBwYXJhbXMgKTtcblx0fSBlbHNlIGlmICggdHlwZW9mIGdhICE9PSAndW5kZWZpbmVkJyApIHtcblx0XHRpZiAoIG5vbl9pbnRlcmFjdGlvbiA9PSAxICkge1xuXHRcdFx0dmFsdWUgPSB7ICdub25JbnRlcmFjdGlvbic6IDEgfTtcblx0XHR9XG5cdFx0aWYgKCd1bmRlZmluZWQnID09PSB0eXBlb2YgdmFsdWUpIHtcblx0XHRcdGdhKCdzZW5kJywgdHlwZSwgY2F0ZWdvcnksIGFjdGlvbiwgbGFiZWwpO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRnYSgnc2VuZCcsIHR5cGUsIGNhdGVnb3J5LCBhY3Rpb24sIGxhYmVsLCB2YWx1ZSk7XG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdHJldHVybjtcblx0fVxufVxuXG4vKipcbiAqIEZhdXggXCJTZXNzaW9uXCIgY2hlY2tpbmcvc2V0dGluZ1xuICpcbiAqIEByZXR1cm4ge251bWJlcn0gY3VycmVudENvdW50XG4gKi9cbmZ1bmN0aW9uIHNldEN1cnJlbnRDb3VudCgpIHtcblx0Ly8gVGltZXN0YW1wIHN0b3JlZCBvbiB0aGUgY29va2llXG5cdGxldCBjdXJyZW50Q291bnQgPSBnZXRDb29raWUoJ2NvdW50Jyk7XG5cdGNvbnN0IHRpbWVzdGFtcCA9IE1hdGguZmxvb3IobmV3IERhdGUoKS5nZXRUaW1lKCkgLyAxMDAwKTtcblx0Y29uc3QgY29va2llRXhwaXJhdGlvbiA9IDMwOyAvLyBleHBpcmUgdGhlIGNvb2tlIGluIDMwIGRheXNcblx0aWYgKCFnZXRDb29raWUoJ2NvdW50JykpIHtcblx0XHQvLyBGaXJzdCBWaXNpdCAtIHNldCBjb3VudCB0byAxXG5cdFx0c2V0Q29va2llKCdjb3VudCcsIDEsIGNvb2tpZUV4cGlyYXRpb24pO1xuXHRcdC8vIFNldCBhIHRpbWVjaGVjayBjb29raWUgZm9yIGFuIGhvdXIgZnJvbSBub3dcblx0XHRzZXRDb29raWUoJ3RpbWVjaGVjaycsIHRpbWVzdGFtcCArIDM2MDAsIGNvb2tpZUV4cGlyYXRpb24pO1xuXHR9IGVsc2UgaWYgKHRpbWVzdGFtcCA+IGdldENvb2tpZSgndGltZWNoZWNrJykpIHtcblx0XHQvLyBVcGRhdGUgVGltZWNoZWNrIHRvIG5ldyB2YWx1ZVxuXHRcdHNldENvb2tpZSgndGltZWNoZWNrJywgdGltZXN0YW1wICsgMzYwMCwgY29va2llRXhwaXJhdGlvbik7XG5cdFx0Ly8gQ291bnQgZXhpc3RzIGFscmVhZHkgYW5kIGl0IGhhcyBiZWVuIGFuIGhvdXIuIFVwZGF0ZSBjb3VudFxuXHRcdHNldENvb2tpZSgnY291bnQnLCArK2N1cnJlbnRDb3VudCwgY29va2llRXhwaXJhdGlvbik7XG5cdH1cblx0Y29uc3QgdXJsUGFyYW1zID0gbmV3IFVSTFNlYXJjaFBhcmFtcyh3aW5kb3cubG9jYXRpb24uc2VhcmNoKTtcblx0aWYgKHVybFBhcmFtcy5nZXQoJ2NvdW50JykgIT09IG51bGwpIHtcblx0XHRjdXJyZW50Q291bnQgPSBwYXJzZUludCh1cmxQYXJhbXMuZ2V0KCdjb3VudCcpKTtcblx0fVxuXHRyZXR1cm4gY3VycmVudENvdW50O1xufVxuXG4vKipcbiAqIEdldCB0aGUgV29yZFByZXNzIHBvc3QgSUQgZm9yIGEgZ2l2ZW4gcG9wdXAuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IHBvcHVwU2VsZWN0b3JcbiAqIEByZXR1cm4ge251bWJlcn0gcG9zdElkXG4gKi9cbmZ1bmN0aW9uIGdldFBvc3RJZChwb3B1cFNlbGVjdG9yKSB7XG5cdGxldCBwb3N0SWQgPSAwO1xuXHRjb25zdCBjbGFzc0xpc3QgPSAkKCcuJyArIHBvcHVwU2VsZWN0b3IpXG5cdFx0LmF0dHIoJ2NsYXNzJylcblx0XHQuc3BsaXQoL1xccysvKTtcblx0JC5lYWNoKGNsYXNzTGlzdCwgZnVuY3Rpb24gKGluZGV4LCBpdGVtKSB7XG5cdFx0aWYgKDAgPCBpdGVtLmluZGV4T2YoJ21lc3NhZ2UtaWQnKSkge1xuXHRcdFx0cG9zdElkID0gaXRlbS5zdWJzdHJpbmcoaXRlbS5sYXN0SW5kZXhPZignLScpICsgMSk7XG5cdFx0XHRyZXR1cm4gZmFsc2U7IC8vIGJyZWFrIGVhY2ggYW5kIHBvc3RJZCB3aWxsIGJlIHJldHVybmVkXG5cdFx0fVxuXHR9KTtcblx0cmV0dXJuIHBvc3RJZDtcbn1cblxuLyoqXG4gKiBHZXQgdGhlIHJlZ2lvbiBmb3IgYSBnaXZlbiBtZXNzYWdlLlxuICpcbiAqIEBwYXJhbSB7T2JqZWN0fSBtZXNzYWdlXG4gKiBAcmV0dXJuIHtzdHJpbmd9IHJlZ2lvblxuICovXG5mdW5jdGlvbiBnZXRNZXNzYWdlUmVnaW9uKG1lc3NhZ2UpIHtcblx0bGV0IHJlZ2lvbiA9ICcnO1xuXHRjb25zdCBjbGFzc0xpc3QgPSAkKG1lc3NhZ2UpLmF0dHIoJ2NsYXNzJykuc3BsaXQoL1xccysvKTtcblx0JC5lYWNoKGNsYXNzTGlzdCwgZnVuY3Rpb24gKGluZGV4LCBpdGVtKSB7XG5cdFx0aWYgKDAgPCBpdGVtLmluZGV4T2YoJ21lc3NhZ2UtcmVnaW9uJykpIHtcblx0XHRcdHJlZ2lvbiA9IGl0ZW0uc3Vic3RyaW5nKGl0ZW0ubGFzdEluZGV4T2YoJy0nKSArIDEpO1xuXHRcdFx0cmV0dXJuIGZhbHNlOyAvLyBicmVhayBlYWNoIGFuZCByZWdpb24gd2lsbCBiZSByZXR1cm5lZFxuXHRcdH1cblx0fSk7XG5cdHJldHVybiByZWdpb247XG59XG5cbi8qKlxuICogU2hvdyBhIHNwZWNpZmljIHBvcHVwLiBTZXRzIGEgY29va2llIGFuZCBhZGRzIGEgdmlzaWJpbGl0eSBjbGFzcy5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gcG9wdXBTZWxlY3RvclxuICogQHBhcmFtIHtudW1iZXJ9IGNvb2tpZURheVRvdGFsXG4gKiBAcGFyYW0ge3N0cmluZ30gcG9wdXBTaG93bkNvb2tpZU5hbWVcbiAqIEBwYXJhbSB7c3RyaW5nfSBwb3B1cFZpc2libGVDbGFzc1xuICovXG5mdW5jdGlvbiBzaG93UG9wdXAoXG5cdHBvcHVwU2VsZWN0b3IsXG5cdGNvb2tpZURheVRvdGFsLFxuXHRwb3B1cFNob3duQ29va2llTmFtZSxcblx0cG9wdXBWaXNpYmxlQ2xhc3Ncbikge1xuXHRsZXQgcG9wdXBJZCA9IDA7XG5cdHNldENvb2tpZShwb3B1cFNob3duQ29va2llTmFtZSwgJ3RydWUnLCBjb29raWVEYXlUb3RhbCk7XG5cdGlmICgwIDwgJCgnLnZhbGlkYXRlZCcpLmxlbmd0aCkge1xuXHRcdCQoJy4nICsgcG9wdXBTZWxlY3RvciArICcudmFsaWRhdGVkJykuYWRkQ2xhc3MocG9wdXBWaXNpYmxlQ2xhc3MpO1xuXHRcdHBvcHVwSWQgPSBnZXRQb3N0SWQocG9wdXBTZWxlY3RvciArICcudmFsaWRhdGVkJyk7XG5cdH0gZWxzZSB7XG5cdFx0JCgnLicgKyBwb3B1cFNlbGVjdG9yICsgJzpmaXJzdCcpLmFkZENsYXNzKHBvcHVwVmlzaWJsZUNsYXNzKTtcblx0XHRwb3B1cElkID0gZ2V0UG9zdElkKHBvcHVwU2VsZWN0b3IgKyAnOmZpcnN0Jyk7XG5cdH1cblx0aWYgKDAgIT09IHBvcHVwSWQpIHtcblx0XHRhbmFseXRpY3NUcmFja2luZ0V2ZW50KCdldmVudCcsICdQb3B1cCcsICdTaG93JywgcG9wdXBJZCwgdW5kZWZpbmVkLCAxKTtcblx0fVxufVxuXG4vKipcbiAqIFNob3cgYSBzcGVjaWZpYyBwb3B1cC4gU2V0cyBhIGNvb2tpZSBhbmQgYWRkcyBhIHZpc2liaWxpdHkgY2xhc3MuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IHBvcHVwU2VsZWN0b3JcbiAqIEBwYXJhbSB7c3RyaW5nfSBwb3B1cFZpc2libGVDbGFzc1xuICogQHBhcmFtIHtPYmplY3R9IGxhc3RGb2N1c1xuICogQHBhcmFtIHtzdHJpbmd9IGNsb3NlVHJpZ2dlclxuICovXG5mdW5jdGlvbiBoaWRlUG9wdXAocG9wdXBTZWxlY3RvciwgcG9wdXBWaXNpYmxlQ2xhc3MsIGxhc3RGb2N1cywgY2xvc2VUcmlnZ2VyKSB7XG5cdGxhc3RGb2N1cy5mb2N1cygpO1xuXHQkKCcuJyArIHBvcHVwU2VsZWN0b3IpLnJlbW92ZUNsYXNzKHBvcHVwVmlzaWJsZUNsYXNzKTtcblx0Y29uc3QgcG9wdXBJZCA9IGdldFBvc3RJZChwb3B1cFNlbGVjdG9yKTtcblx0aWYgKDAgIT09IHBvcHVwSWQpIHtcblx0XHRhbmFseXRpY3NUcmFja2luZ0V2ZW50KCdldmVudCcsICdQb3B1cCcsIGNsb3NlVHJpZ2dlciwgcG9wdXBJZCwgdW5kZWZpbmVkLCAxKTtcblx0fVxufVxuXG4vKipcbiAqIERpc3BsYXkgYW5kIGNvbnRyb2xzIGZvciBwb3B1cHNcbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gcG9wdXBTZWxlY3RvclxuICogQHBhcmFtIHtudW1iZXJ9IGNvb2tpZURheVRvdGFsXG4gKiBAcGFyYW0ge3N0cmluZ30gcG9wdXBTaG93bkNvb2tpZU5hbWVcbiAqIEBwYXJhbSB7c3RyaW5nfSBwb3B1cFZpc2libGVDbGFzc1xuICogQHBhcmFtIHtzdHJpbmd9IGNoZWNrU2Vzc2lvbkNsYXNzXG4gKi9cbmZ1bmN0aW9uIHBvcHVwRGlzcGxheShcblx0cG9wdXBTZWxlY3Rvcixcblx0Y29va2llRGF5VG90YWwsXG5cdHBvcHVwU2hvd25Db29raWVOYW1lLFxuXHRwb3B1cFZpc2libGVDbGFzcyxcblx0Y2hlY2tTZXNzaW9uQ2xhc3Ncbikge1xuXHRjb25zdCBsYXN0Rm9jdXMgPSBkb2N1bWVudC5hY3RpdmVFbGVtZW50OyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lXG5cdC8vIENoZWNrIGlmIHdlIHNob3VsZCBiZSBzaG93aW5nIHRoZSBwb3B1cFxuXHRpZiAoXG5cdFx0J3RydWUnICE9PSBnZXRDb29raWUocG9wdXBTaG93bkNvb2tpZU5hbWUpICYmXG5cdFx0ISQoJy4nICsgcG9wdXBTZWxlY3RvcikuaGFzQ2xhc3MoY2hlY2tTZXNzaW9uQ2xhc3MpXG5cdCkge1xuXHRcdHNob3dQb3B1cChcblx0XHRcdHBvcHVwU2VsZWN0b3IsXG5cdFx0XHRjb29raWVEYXlUb3RhbCxcblx0XHRcdHBvcHVwU2hvd25Db29raWVOYW1lLFxuXHRcdFx0cG9wdXBWaXNpYmxlQ2xhc3Ncblx0XHQpO1xuXHR9XG5cblx0Ly8gY2xpY2sgb24gbG9naW4gbGluayBpbnNpZGUgcG9wdXBcblx0JCgnLicgKyBwb3B1cFNlbGVjdG9yKS5vbignY2xpY2snLCAnLm1lc3NhZ2UtbG9naW4nLCBmdW5jdGlvbiAoKSB7XG5cdFx0Y29uc3QgdXJsID0gJCh0aGlzKS5hdHRyKCdocmVmJyk7XG5cdFx0YW5hbHl0aWNzVHJhY2tpbmdFdmVudCgnZXZlbnQnLCAnUG9wdXAnLCAnTG9naW4gTGluaycsIHVybCk7XG5cdH0pO1xuXG5cdGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXG5cdFx0J2NsaWNrJyxcblx0XHRmdW5jdGlvbiAoZXZlbnQpIHtcblx0XHRcdGlmIChcblx0XHRcdFx0ISQoZXZlbnQudGFyZ2V0KVxuXHRcdFx0XHRcdC5jbG9zZXN0KCcuJyArIHBvcHVwU2VsZWN0b3IpXG5cdFx0XHRcdFx0LmlzKCcuJyArIHBvcHVwU2VsZWN0b3IpICYmXG5cdFx0XHRcdCQoJy4nICsgcG9wdXBTZWxlY3RvcikuaGFzQ2xhc3MocG9wdXBWaXNpYmxlQ2xhc3MpXG5cdFx0XHQpIHtcblx0XHRcdFx0aGlkZVBvcHVwKFxuXHRcdFx0XHRcdHBvcHVwU2VsZWN0b3IsXG5cdFx0XHRcdFx0cG9wdXBWaXNpYmxlQ2xhc3MsXG5cdFx0XHRcdFx0bGFzdEZvY3VzLFxuXHRcdFx0XHRcdCdDbGljayBPdXRzaWRlIHRvIENsb3NlJ1xuXHRcdFx0XHQpO1xuXHRcdFx0fVxuXHRcdH0sXG5cdFx0dHJ1ZVxuXHQpO1xuXG5cdC8vIHBvcHVwIGNsb3NlIGJ1dHRvblxuXHQkKCcuJyArIHBvcHVwU2VsZWN0b3IpLm9uKCdjbGljaycsICcuc20tY2xvc2UtYnRuJywgZnVuY3Rpb24gKGUpIHtcblx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0aGlkZVBvcHVwKHBvcHVwU2VsZWN0b3IsIHBvcHVwVmlzaWJsZUNsYXNzLCBsYXN0Rm9jdXMsICdDbG9zZSBCdXR0b24nKTtcblx0fSk7XG5cblx0Ly8gZXNjYXBlIGtleSBwcmVzc1xuXHQkKGRvY3VtZW50KS5rZXl1cChmdW5jdGlvbiAoZSkge1xuXHRcdGlmICgyNyA9PT0gZS5rZXlDb2RlKSB7XG5cdFx0XHRoaWRlUG9wdXAoXG5cdFx0XHRcdHBvcHVwU2VsZWN0b3IsXG5cdFx0XHRcdHBvcHVwVmlzaWJsZUNsYXNzLFxuXHRcdFx0XHRsYXN0Rm9jdXMsXG5cdFx0XHRcdCdFc2NhcGUgS2V5J1xuXHRcdFx0KTtcblx0XHR9XG5cdH0pO1xuXG5cdC8vIGNsaWNrIG9uIGEgbm9uLWxvZ2luIG9yIGNsb3NlIGxpbmsgaW5zaWRlIHBvcHVwXG5cdCQoJy4nICsgcG9wdXBTZWxlY3Rvcikub24oXG5cdFx0J2NsaWNrJyxcblx0XHQnYTpub3QoIC5zbS1jbG9zZS1idG4sIC5tZXNzYWdlLWxvZ2luICknLFxuXHRcdGZ1bmN0aW9uICgpIHtcblx0XHRcdGNvbnN0IHBvcHVwSWQgPSBnZXRQb3N0SWQocG9wdXBTZWxlY3Rvcik7XG5cdFx0XHRhbmFseXRpY3NUcmFja2luZ0V2ZW50KCdldmVudCcsICdQb3B1cCcsICdDbGljaycsIHBvcHVwSWQpO1xuXHRcdH1cblx0KTtcbn1cblxuZnVuY3Rpb24gbWVzc2FnZUFuYWx5dGljcyhtZXNzYWdlKSB7XG5cdGNvbnN0IG1lc3NhZ2VSZWdpb24gPSBnZXRNZXNzYWdlUmVnaW9uKCcuJyArIG1lc3NhZ2UpO1xuXHRjb25zdCBtZXNzYWdlSWQgPSBnZXRQb3N0SWQobWVzc2FnZSk7XG5cdGlmICgkKCcuJyArIG1lc3NhZ2UpLmlzKCc6dmlzaWJsZScpKSB7XG5cdFx0YW5hbHl0aWNzVHJhY2tpbmdFdmVudCgnZXZlbnQnLCBtZXNzYWdlUmVnaW9uLCAnU2hvdycsIG1lc3NhZ2VJZCwgdW5kZWZpbmVkLCAxKTtcblx0fVxuXHQvLyBjbGljayBvbiBsb2dpbiBsaW5rIGluc2lkZSBhIG1lc3NhZ2Vcblx0JCgnLicgKyBtZXNzYWdlKS5vbignY2xpY2snLCAnLm1lc3NhZ2UtbG9naW4nLCBmdW5jdGlvbiAoKSB7XG5cdFx0Y29uc3QgdXJsID0gJCh0aGlzKS5hdHRyKCdocmVmJyk7XG5cdFx0YW5hbHl0aWNzVHJhY2tpbmdFdmVudCgnZXZlbnQnLCBtZXNzYWdlUmVnaW9uLCAnTG9naW4gTGluaycsIHVybCk7XG5cdH0pO1xuXG5cdC8vIGNsaWNrIG9uIGEgbm9uLWxvZ2luIG9yIGNsb3NlIGxpbmsgaW5zaWRlIGEgbWVzc2FnZVxuXHQkKCcuJyArIG1lc3NhZ2UpLm9uKFxuXHRcdCdjbGljaycsXG5cdFx0J2E6bm90KCAuc20tY2xvc2UtYnRuLCAubWVzc2FnZS1sb2dpbiApJyxcblx0XHRmdW5jdGlvbiAoKSB7XG5cdFx0XHRhbmFseXRpY3NUcmFja2luZ0V2ZW50KCdldmVudCcsIG1lc3NhZ2VSZWdpb24sICdDbGljaycsIG1lc3NhZ2VJZCk7XG5cdFx0fVxuXHQpO1xufVxuXG4vKipcbiAqIFdoZW4galF1ZXJ5IGlzIGxvYWRlZCwgc2V0IHVwIHNlc3Npb24gdHJhY2tpbmcgYW5kIHBvcHVwIGRpc3BsYXlcbiAqXG4gKi9cbiQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uICgpIHtcblx0Y29uc3QgcG9wdXBTZWxlY3RvciA9ICd3cC1tZXNzYWdlLWluc2VydGVyLW1lc3NhZ2UtcmVnaW9uLXBvcHVwJztcblx0Y29uc3QgcG9wdXBTaG93bkNvb2tpZU5hbWUgPSAnc20tc2hvd24nO1xuXHRjb25zdCBwb3B1cFZpc2libGVDbGFzcyA9ICd3cC1tZXNzYWdlLWluc2VydGVyLW1lc3NhZ2UtcG9wdXAtdmlzaWJsZSc7XG5cdGNvbnN0IGNoZWNrU2Vzc2lvbkNsYXNzID0gJ2NoZWNrLXNlc3Npb24tbWVzc2FnZSc7XG5cdGNvbnN0IG1lc3NhZ2VTZWxlY3RvciA9ICd3cC1tZXNzYWdlLWluc2VydGVyLW1lc3NhZ2UnO1xuXG5cdC8vIEdldCBvdXIgdmFsdWUgZm9yIGRheXMgYW5kIGhvdXJzIHRvIHNldCBjb29raWVcblx0Y29uc3QgY2xvc2VUaW1lRGF5cyA9XG5cdFx0cGFyc2VJbnQoJCgnLicgKyBwb3B1cFNlbGVjdG9yKS5kYXRhKCdjbG9zZS10aW1lLWRheXMnKSkgfHwgMDtcblx0Y29uc3QgY2xvc2VUaW1lSG91cnMgPVxuXHRcdChwYXJzZUludCgkKCcuJyArIHBvcHVwU2VsZWN0b3IpLmRhdGEoJ2Nsb3NlLXRpbWUtaG91cnMnKSkgfHwgMCkgLyAyNDtcblx0Ly8gT3VyIFRvdGFsIGZvciB3aGVuIHRoZSBjb29raWUgc2hvdWxkIGV4cGlyZSBhbmQgc2hvdyB0aGUgYmFubmVyIGFnYWluXG5cdGNvbnN0IGNvb2tpZURheVRvdGFsID0gY2xvc2VUaW1lRGF5cyArIGNsb3NlVGltZUhvdXJzO1xuXG5cdC8vIFNlc3Npb24gVmFsaWRhdGluZyBhbmQgc2hvd2luZyBwcm9wZXIgYmFubmVyXG5cdGNvbnN0IG9wZXJhdG9ycyA9IHtcblx0XHRndChhLCBiKSB7XG5cdFx0XHRyZXR1cm4gYSA+PSBiO1xuXHRcdH0sXG5cdFx0bHQoYSwgYikge1xuXHRcdFx0cmV0dXJuIGEgPD0gYjtcblx0XHR9LFxuXHR9O1xuXG5cdGNvbnN0IGN1cnJlbnRDb3VudCA9IHNldEN1cnJlbnRDb3VudCgpO1xuXG5cdGlmICgwIDwgJCgnLicgKyBjaGVja1Nlc3Npb25DbGFzcykubGVuZ3RoKSB7XG5cdFx0JCgnLicgKyBjaGVja1Nlc3Npb25DbGFzcykuZWFjaChmdW5jdGlvbiAoKSB7XG5cdFx0XHRjb25zdCBiYW5uZXJTZXNzaW9uQ291bnQgPSBwYXJzZUludChcblx0XHRcdFx0JCh0aGlzKS5kYXRhKCdzZXNzaW9uLWNvdW50LXRvLWNoZWNrJylcblx0XHRcdCk7XG5cdFx0XHRjb25zdCBiYW5uZXJTZXNzaW9uT3BlcmF0b3IgPSAkKHRoaXMpLmRhdGEoXG5cdFx0XHRcdCdzZXNzaW9uLWNvdW50LW9wZXJhdG9yJ1xuXHRcdFx0KTtcblx0XHRcdGlmIChcblx0XHRcdFx0b3BlcmF0b3JzW2Jhbm5lclNlc3Npb25PcGVyYXRvcl0oXG5cdFx0XHRcdFx0Y3VycmVudENvdW50LFxuXHRcdFx0XHRcdGJhbm5lclNlc3Npb25Db3VudFxuXHRcdFx0XHQpXG5cdFx0XHQpIHtcblx0XHRcdFx0aWYgKCEkKHRoaXMpLmhhc0NsYXNzKHBvcHVwU2VsZWN0b3IpKSB7XG5cdFx0XHRcdFx0JCh0aGlzKS5hZGRDbGFzcygndmFsaWRhdGVkJyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIWdldENvb2tpZShwb3B1cFNob3duQ29va2llTmFtZSkpIHtcblx0XHRcdFx0XHQkKHRoaXMpLmFkZENsYXNzKCd2YWxpZGF0ZWQnKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH0pO1xuXHR9XG5cblx0aWYgKDAgPCAkKCcuJyArIHBvcHVwU2VsZWN0b3IpLmxlbmd0aCkge1xuXHRcdHBvcHVwRGlzcGxheShcblx0XHRcdHBvcHVwU2VsZWN0b3IsXG5cdFx0XHRjb29raWVEYXlUb3RhbCxcblx0XHRcdHBvcHVwU2hvd25Db29raWVOYW1lLFxuXHRcdFx0cG9wdXBWaXNpYmxlQ2xhc3Ncblx0XHQpO1xuXHR9XG5cblx0aWYgKFxuXHRcdDAgPCAkKCcuJyArIG1lc3NhZ2VTZWxlY3RvciArICc6bm90KCAuJyArIHBvcHVwU2VsZWN0b3IgKyAnICknKS5sZW5ndGhcblx0KSB7XG5cdFx0bWVzc2FnZUFuYWx5dGljcyhtZXNzYWdlU2VsZWN0b3IgKyAnOm5vdCggLicgKyBwb3B1cFNlbGVjdG9yICsgJyApJyk7XG5cdH1cbn0pO1xuIl19
}(jQuery));
