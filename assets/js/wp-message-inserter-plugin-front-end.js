;(function($) {
"use strict";

/**
 * Sets cookies
 *
 * @param {string} name
 * @param {string} value
 * @param {number} days
 */
function setCookie(name, value, days) {
  var d = new Date();
  d.setTime(d.getTime() + 86400000 * days);
  document.cookie = name + '=' + value + ';path=/;expires=' + d.toGMTString();
}
/**
 * Reads cookies
 *
 * @param {string} name
 */


function getCookie(name) {
  var v = document.cookie.match('(^|;) ?' + name + '=([^;]*)(;|$)');
  return v ? v[2] : null;
}
/**
 * Faux "Session" checking/setting
 *
 * @return {number} currentCount
 */


function setCurrentCount() {
  // Timestamp stored on the cookie
  var currentCount = getCookie('count');
  var timestamp = Math.floor(new Date().getTime() / 1000);
  var cookieExpiration = 30; // expire the cooke in 30 days

  if (!getCookie('count')) {
    // First Visit - set count to 1
    setCookie('count', 1, cookieExpiration); // Set a timecheck cookie for an hour from now

    setCookie('timecheck', timestamp + 3600, cookieExpiration);
  } else if (timestamp > getCookie('timecheck')) {
    // Update Timecheck to new value
    setCookie('timecheck', timestamp + 3600, cookieExpiration); // Count exists already and it has been an hour. Update count

    setCookie('count', ++currentCount, cookieExpiration);
  }

  var urlParams = new URLSearchParams(window.location.search);

  if (urlParams.get('count') !== null) {
    currentCount = parseInt(urlParams.get('count'));
  }

  return currentCount;
}
/**
 * Show a specific popup. Sets a cookie and adds a visibility class.
 *
 * @param {string} popupSelector
 * @param {number} cookieDayTotal
 * @param {string} popupShownCookieName
 * @param {string} popupVisibleClass
 */


function showPopup(popupSelector, cookieDayTotal, popupShownCookieName, popupVisibleClass) {
  setCookie(popupShownCookieName, 'true', cookieDayTotal);

  if (0 < $('.validated').length) {
    $('.' + popupSelector + '.validated').addClass(popupVisibleClass);
  } else {
    $('.' + popupSelector + ':first').addClass(popupVisibleClass);
  }
}
/**
 * Show a specific popup. Sets a cookie and adds a visibility class.
 *
 * @param {string} popupSelector
 * @param {string} popupVisibleClass
 * @param {Object} lastFocus
 */


function hidePopup(popupSelector, popupVisibleClass, lastFocus) {
  lastFocus.focus();
  $('.' + popupSelector).removeClass(popupVisibleClass);
}
/**
 * Display and controls for popups
 *
 * @param {string} popupSelector
 * @param {number} cookieDayTotal
 * @param {string} popupShownCookieName
 * @param {string} popupVisibleClass
 * @param {string} checkSessionClass
 */


function popupDisplay(popupSelector, cookieDayTotal, popupShownCookieName, popupVisibleClass, checkSessionClass) {
  var lastFocus = document.activeElement; // put in a close button at the end

  $('.' + popupSelector + ' .m-wp-insert-message-item').append('<a href="#" class="sm-close-btn" aria-label="Close"><i class="fas fa-times" aria-hidden="true"></i></a>'); // Check if we should be showing the popup

  if ('true' !== getCookie(popupShownCookieName) && !$('.' + popupSelector).hasClass(checkSessionClass)) {
    showPopup(popupSelector, cookieDayTotal, popupShownCookieName, popupVisibleClass);
  }

  document.addEventListener('click', function (event) {
    if (!$(event.target).closest('.' + popupSelector).is('.' + popupSelector) && $('.' + popupSelector).hasClass(popupVisibleClass)) {
      hidePopup(popupSelector, popupVisibleClass, lastFocus);
    }
  }, true); // popup close button

  $('.' + popupSelector).on('click', '.sm-close-btn', function (e) {
    e.preventDefault();
    hidePopup(popupSelector, popupVisibleClass, lastFocus);
  }); // escape key

  $(document).keyup(function (e) {
    if (27 === e.keyCode) {
      hidePopup(popupSelector, popupVisibleClass, lastFocus);
    }
  });
}
/**
 * When jQuery is loaded, set up session tracking and popup display
 *
 */


$(document).ready(function () {
  var popupSelector = 'wp-message-inserter-message-popup';
  var popupShownCookieName = 'sm-shown';
  var popupVisibleClass = 'wp-message-inserter-message-popup-visible';
  var checkSessionClass = 'check-session-message'; // Get our value for days and hours to set cookie

  var closeTimeDays = parseInt($('.' + popupSelector).data('close-time-days')) || 0;
  var closeTimeHours = (parseInt($('.' + popupSelector).data('close-time-hours')) || 0) / 24; // Our Total for when the cookie should expire and show the banner again

  var cookieDayTotal = closeTimeDays + closeTimeHours; // Session Validating and showing proper banner

  var operators = {
    gt: function gt(a, b) {
      return a >= b;
    },
    lt: function lt(a, b) {
      return a <= b;
    }
  };
  var currentCount = setCurrentCount();

  if (0 < $('.' + checkSessionClass).length) {
    $('.' + checkSessionClass).each(function () {
      var bannerSessionCount = parseInt($(this).data('session-count-to-check'));
      var bannerSessionOperator = $(this).data('session-count-operator');

      if (operators[bannerSessionOperator](currentCount, bannerSessionCount)) {
        if (!$(this).hasClass(popupSelector)) {
          $(this).addClass('validated');
        } else if (!getCookie(popupShownCookieName)) {
          $(this).addClass('validated');
        }
      }
    });
  }

  if (0 < $('.' + popupSelector).length) {
    popupDisplay(popupSelector, cookieDayTotal, popupShownCookieName, popupVisibleClass);
  }
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIjAxLW1lc3NhZ2VzLmpzIl0sIm5hbWVzIjpbInNldENvb2tpZSIsIm5hbWUiLCJ2YWx1ZSIsImRheXMiLCJkIiwiRGF0ZSIsInNldFRpbWUiLCJnZXRUaW1lIiwiZG9jdW1lbnQiLCJjb29raWUiLCJ0b0dNVFN0cmluZyIsImdldENvb2tpZSIsInYiLCJtYXRjaCIsInNldEN1cnJlbnRDb3VudCIsImN1cnJlbnRDb3VudCIsInRpbWVzdGFtcCIsIk1hdGgiLCJmbG9vciIsImNvb2tpZUV4cGlyYXRpb24iLCJ1cmxQYXJhbXMiLCJVUkxTZWFyY2hQYXJhbXMiLCJ3aW5kb3ciLCJsb2NhdGlvbiIsInNlYXJjaCIsImdldCIsInBhcnNlSW50Iiwic2hvd1BvcHVwIiwicG9wdXBTZWxlY3RvciIsImNvb2tpZURheVRvdGFsIiwicG9wdXBTaG93bkNvb2tpZU5hbWUiLCJwb3B1cFZpc2libGVDbGFzcyIsIiQiLCJsZW5ndGgiLCJhZGRDbGFzcyIsImhpZGVQb3B1cCIsImxhc3RGb2N1cyIsImZvY3VzIiwicmVtb3ZlQ2xhc3MiLCJwb3B1cERpc3BsYXkiLCJjaGVja1Nlc3Npb25DbGFzcyIsImFjdGl2ZUVsZW1lbnQiLCJhcHBlbmQiLCJoYXNDbGFzcyIsImFkZEV2ZW50TGlzdGVuZXIiLCJldmVudCIsInRhcmdldCIsImNsb3Nlc3QiLCJpcyIsIm9uIiwiZSIsInByZXZlbnREZWZhdWx0Iiwia2V5dXAiLCJrZXlDb2RlIiwicmVhZHkiLCJjbG9zZVRpbWVEYXlzIiwiZGF0YSIsImNsb3NlVGltZUhvdXJzIiwib3BlcmF0b3JzIiwiZ3QiLCJhIiwiYiIsImx0IiwiZWFjaCIsImJhbm5lclNlc3Npb25Db3VudCIsImJhbm5lclNlc3Npb25PcGVyYXRvciJdLCJtYXBwaW5ncyI6Ijs7QUFBQTs7Ozs7OztBQU9BLFNBQVNBLFNBQVQsQ0FBb0JDLElBQXBCLEVBQTBCQyxLQUExQixFQUFpQ0MsSUFBakMsRUFBd0M7QUFDdkMsTUFBTUMsQ0FBQyxHQUFHLElBQUlDLElB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c3NhZ2UtaW5zZXJ0ZXItcGx1Z2luLWZyb250LWVuZC5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogU2V0cyBjb29raWVzXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IG5hbWVcbiAqIEBwYXJhbSB7c3RyaW5nfSB2YWx1ZVxuICogQHBhcmFtIHtudW1iZXJ9IGRheXNcbiAqL1xuZnVuY3Rpb24gc2V0Q29va2llKCBuYW1lLCB2YWx1ZSwgZGF5cyApIHtcblx0Y29uc3QgZCA9IG5ldyBEYXRlKCk7XG5cdGQuc2V0VGltZSggZC5nZXRUaW1lKCkgKyAoIDg2NDAwMDAwICogZGF5cyApICk7XG5cdGRvY3VtZW50LmNvb2tpZSA9IG5hbWUgKyAnPScgKyB2YWx1ZSArICc7cGF0aD0vO2V4cGlyZXM9JyArIGQudG9HTVRTdHJpbmcoKTtcbn1cblxuLyoqXG4gKiBSZWFkcyBjb29raWVzXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IG5hbWVcbiAqL1xuZnVuY3Rpb24gZ2V0Q29va2llKCBuYW1lICkge1xuXHRjb25zdCB2ID0gZG9jdW1lbnQuY29va2llLm1hdGNoKCAnKF58OykgPycgKyBuYW1lICsgJz0oW147XSopKDt8JCknICk7XG5cdHJldHVybiB2ID8gdlsgMiBdIDogbnVsbDtcbn1cblxuLyoqXG4gKiBGYXV4IFwiU2Vzc2lvblwiIGNoZWNraW5nL3NldHRpbmdcbiAqXG4gKiBAcmV0dXJuIHtudW1iZXJ9IGN1cnJlbnRDb3VudFxuICovXG5mdW5jdGlvbiBzZXRDdXJyZW50Q291bnQoKSB7XG5cdC8vIFRpbWVzdGFtcCBzdG9yZWQgb24gdGhlIGNvb2tpZVxuXHRsZXQgY3VycmVudENvdW50ID0gZ2V0Q29va2llKCAnY291bnQnICk7XG5cdGNvbnN0IHRpbWVzdGFtcCA9IE1hdGguZmxvb3IoIG5ldyBEYXRlKCkuZ2V0VGltZSgpIC8gMTAwMCApO1xuXHRjb25zdCBjb29raWVFeHBpcmF0aW9uID0gMzA7IC8vIGV4cGlyZSB0aGUgY29va2UgaW4gMzAgZGF5c1xuXHRpZiAoICEgZ2V0Q29va2llKCAnY291bnQnICkgKSB7XG5cdFx0Ly8gRmlyc3QgVmlzaXQgLSBzZXQgY291bnQgdG8gMVxuXHRcdHNldENvb2tpZSggJ2NvdW50JywgMSwgY29va2llRXhwaXJhdGlvbiApO1xuXHRcdC8vIFNldCBhIHRpbWVjaGVjayBjb29raWUgZm9yIGFuIGhvdXIgZnJvbSBub3dcblx0XHRzZXRDb29raWUoICd0aW1lY2hlY2snLCB0aW1lc3RhbXAgKyAzNjAwLCBjb29raWVFeHBpcmF0aW9uICk7XG5cdH0gZWxzZSBpZiAoIHRpbWVzdGFtcCA+IGdldENvb2tpZSggJ3RpbWVjaGVjaycgKSApIHtcblx0XHQvLyBVcGRhdGUgVGltZWNoZWNrIHRvIG5ldyB2YWx1ZVxuXHRcdHNldENvb2tpZSggJ3RpbWVjaGVjaycsIHRpbWVzdGFtcCArIDM2MDAsIGNvb2tpZUV4cGlyYXRpb24gKTtcblx0XHQvLyBDb3VudCBleGlzdHMgYWxyZWFkeSBhbmQgaXQgaGFzIGJlZW4gYW4gaG91ci4gVXBkYXRlIGNvdW50XG5cdFx0c2V0Q29va2llKCAnY291bnQnLCArK2N1cnJlbnRDb3VudCwgY29va2llRXhwaXJhdGlvbiApO1xuXHR9XG5cdGNvbnN0IHVybFBhcmFtcyA9IG5ldyBVUkxTZWFyY2hQYXJhbXMoIHdpbmRvdy5sb2NhdGlvbi5zZWFyY2ggKTtcblx0aWYgKCB1cmxQYXJhbXMuZ2V0KCAnY291bnQnICkgIT09IG51bGwgKSB7XG5cdFx0Y3VycmVudENvdW50ID0gcGFyc2VJbnQoIHVybFBhcmFtcy5nZXQoICdjb3VudCcgKSApO1xuXHR9XG5cdHJldHVybiBjdXJyZW50Q291bnQ7XG59XG5cbi8qKlxuICogU2hvdyBhIHNwZWNpZmljIHBvcHVwLiBTZXRzIGEgY29va2llIGFuZCBhZGRzIGEgdmlzaWJpbGl0eSBjbGFzcy5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gcG9wdXBTZWxlY3RvclxuICogQHBhcmFtIHtudW1iZXJ9IGNvb2tpZURheVRvdGFsXG4gKiBAcGFyYW0ge3N0cmluZ30gcG9wdXBTaG93bkNvb2tpZU5hbWVcbiAqIEBwYXJhbSB7c3RyaW5nfSBwb3B1cFZpc2libGVDbGFzc1xuICovXG5mdW5jdGlvbiBzaG93UG9wdXAoIHBvcHVwU2VsZWN0b3IsIGNvb2tpZURheVRvdGFsLCBwb3B1cFNob3duQ29va2llTmFtZSwgcG9wdXBWaXNpYmxlQ2xhc3MgKSB7XG5cdHNldENvb2tpZSggcG9wdXBTaG93bkNvb2tpZU5hbWUsICd0cnVlJywgY29va2llRGF5VG90YWwgKTtcblx0aWYgKCAwIDwgJCggJy52YWxpZGF0ZWQnICkubGVuZ3RoICkge1xuXHRcdCQoICcuJyArIHBvcHVwU2VsZWN0b3IgKyAnLnZhbGlkYXRlZCcgKS5hZGRDbGFzcyggcG9wdXBWaXNpYmxlQ2xhc3MgKTtcblx0fSBlbHNlIHtcblx0XHQkKCAnLicgKyBwb3B1cFNlbGVjdG9yICsgJzpmaXJzdCcgKS5hZGRDbGFzcyggcG9wdXBWaXNpYmxlQ2xhc3MgKTtcblx0fVxufVxuXG4vKipcbiAqIFNob3cgYSBzcGVjaWZpYyBwb3B1cC4gU2V0cyBhIGNvb2tpZSBhbmQgYWRkcyBhIHZpc2liaWxpdHkgY2xhc3MuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IHBvcHVwU2VsZWN0b3JcbiAqIEBwYXJhbSB7c3RyaW5nfSBwb3B1cFZpc2libGVDbGFzc1xuICogQHBhcmFtIHtPYmplY3R9IGxhc3RGb2N1c1xuICovXG5mdW5jdGlvbiBoaWRlUG9wdXAoIHBvcHVwU2VsZWN0b3IsIHBvcHVwVmlzaWJsZUNsYXNzLCBsYXN0Rm9jdXMgKSB7XG5cdGxhc3RGb2N1cy5mb2N1cygpO1xuXHQkKCAnLicgKyBwb3B1cFNlbGVjdG9yICkucmVtb3ZlQ2xhc3MoIHBvcHVwVmlzaWJsZUNsYXNzICk7XG59XG5cbi8qKlxuICogRGlzcGxheSBhbmQgY29udHJvbHMgZm9yIHBvcHVwc1xuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBwb3B1cFNlbGVjdG9yXG4gKiBAcGFyYW0ge251bWJlcn0gY29va2llRGF5VG90YWxcbiAqIEBwYXJhbSB7c3RyaW5nfSBwb3B1cFNob3duQ29va2llTmFtZVxuICogQHBhcmFtIHtzdHJpbmd9IHBvcHVwVmlzaWJsZUNsYXNzXG4gKiBAcGFyYW0ge3N0cmluZ30gY2hlY2tTZXNzaW9uQ2xhc3NcbiAqL1xuZnVuY3Rpb24gcG9wdXBEaXNwbGF5KCBwb3B1cFNlbGVjdG9yLCBjb29raWVEYXlUb3RhbCwgcG9wdXBTaG93bkNvb2tpZU5hbWUsIHBvcHVwVmlzaWJsZUNsYXNzLCBjaGVja1Nlc3Npb25DbGFzcyApIHtcblx0Y29uc3QgbGFzdEZvY3VzID0gZG9jdW1lbnQuYWN0aXZlRWxlbWVudDtcblx0Ly8gcHV0IGluIGEgY2xvc2UgYnV0dG9uIGF0IHRoZSBlbmRcblx0JCggJy4nICsgcG9wdXBTZWxlY3RvciArICcgLm0td3AtaW5zZXJ0LW1lc3NhZ2UtaXRlbScgKS5hcHBlbmQoICc8YSBocmVmPVwiI1wiIGNsYXNzPVwic20tY2xvc2UtYnRuXCIgYXJpYS1sYWJlbD1cIkNsb3NlXCI+PGkgY2xhc3M9XCJmYXMgZmEtdGltZXNcIiBhcmlhLWhpZGRlbj1cInRydWVcIj48L2k+PC9hPicgKTtcblx0Ly8gQ2hlY2sgaWYgd2Ugc2hvdWxkIGJlIHNob3dpbmcgdGhlIHBvcHVwXG5cdGlmIChcblx0XHQndHJ1ZScgIT09IGdldENvb2tpZSggcG9wdXBTaG93bkNvb2tpZU5hbWUgKSAmJlxuXHRcdCEgJCggJy4nICsgcG9wdXBTZWxlY3RvciApLmhhc0NsYXNzKCBjaGVja1Nlc3Npb25DbGFzcyApXG5cdCkge1xuXHRcdHNob3dQb3B1cCggcG9wdXBTZWxlY3RvciwgY29va2llRGF5VG90YWwsIHBvcHVwU2hvd25Db29raWVOYW1lLCBwb3B1cFZpc2libGVDbGFzcyApO1xuXHR9XG5cblx0ZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lciggJ2NsaWNrJywgZnVuY3Rpb24oIGV2ZW50ICkge1xuXHRcdGlmIChcblx0XHRcdCEgJCggZXZlbnQudGFyZ2V0ICkuY2xvc2VzdCggJy4nICsgcG9wdXBTZWxlY3RvciApLmlzKCAnLicgKyBwb3B1cFNlbGVjdG9yICkgJiZcblx0XHRcdCQoICcuJyArIHBvcHVwU2VsZWN0b3IgKS5oYXNDbGFzcyggcG9wdXBWaXNpYmxlQ2xhc3MgKVxuXHRcdCkge1xuXHRcdFx0aGlkZVBvcHVwKCBwb3B1cFNlbGVjdG9yLCBwb3B1cFZpc2libGVDbGFzcywgbGFzdEZvY3VzICk7XG5cdFx0fVxuXHR9LCB0cnVlICk7XG5cblx0Ly8gcG9wdXAgY2xvc2UgYnV0dG9uXG5cdCQoICcuJyArIHBvcHVwU2VsZWN0b3IgKS5vbiggJ2NsaWNrJywgJy5zbS1jbG9zZS1idG4nLCBmdW5jdGlvbiggZSApIHtcblx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0aGlkZVBvcHVwKCBwb3B1cFNlbGVjdG9yLCBwb3B1cFZpc2libGVDbGFzcywgbGFzdEZvY3VzICk7XG5cdH0gKTtcblxuXHQvLyBlc2NhcGUga2V5XG5cdCQoIGRvY3VtZW50ICkua2V5dXAoIGZ1bmN0aW9uKCBlICkge1xuXHRcdGlmICggMjcgPT09IGUua2V5Q29kZSApIHtcblx0XHRcdGhpZGVQb3B1cCggcG9wdXBTZWxlY3RvciwgcG9wdXBWaXNpYmxlQ2xhc3MsIGxhc3RGb2N1cyApO1xuXHRcdH1cblx0fSApO1xufVxuXG4vKipcbiAqIFdoZW4galF1ZXJ5IGlzIGxvYWRlZCwgc2V0IHVwIHNlc3Npb24gdHJhY2tpbmcgYW5kIHBvcHVwIGRpc3BsYXlcbiAqXG4gKi9cbiQoIGRvY3VtZW50ICkucmVhZHkoIGZ1bmN0aW9uKCkge1xuXHRjb25zdCBwb3B1cFNlbGVjdG9yID0gJ3dwLW1lc3NhZ2UtaW5zZXJ0ZXItbWVzc2FnZS1wb3B1cCc7XG5cdGNvbnN0IHBvcHVwU2hvd25Db29raWVOYW1lID0gJ3NtLXNob3duJztcblx0Y29uc3QgcG9wdXBWaXNpYmxlQ2xhc3MgPSAnd3AtbWVzc2FnZS1pbnNlcnRlci1tZXNzYWdlLXBvcHVwLXZpc2libGUnO1xuXHRjb25zdCBjaGVja1Nlc3Npb25DbGFzcyA9ICdjaGVjay1zZXNzaW9uLW1lc3NhZ2UnO1xuXG5cdC8vIEdldCBvdXIgdmFsdWUgZm9yIGRheXMgYW5kIGhvdXJzIHRvIHNldCBjb29raWVcblx0Y29uc3QgY2xvc2VUaW1lRGF5cyA9IHBhcnNlSW50KCAkKCAnLicgKyBwb3B1cFNlbGVjdG9yICkuZGF0YSggJ2Nsb3NlLXRpbWUtZGF5cycgKSApIHx8IDA7XG5cdGNvbnN0IGNsb3NlVGltZUhvdXJzID0gKCBwYXJzZUludCggJCggJy4nICsgcG9wdXBTZWxlY3RvciApLmRhdGEoICdjbG9zZS10aW1lLWhvdXJzJyApICkgfHwgMCApIC8gMjQ7XG5cdC8vIE91ciBUb3RhbCBmb3Igd2hlbiB0aGUgY29va2llIHNob3VsZCBleHBpcmUgYW5kIHNob3cgdGhlIGJhbm5lciBhZ2FpblxuXHRjb25zdCBjb29raWVEYXlUb3RhbCA9IGNsb3NlVGltZURheXMgKyBjbG9zZVRpbWVIb3VycztcblxuXHQvLyBTZXNzaW9uIFZhbGlkYXRpbmcgYW5kIHNob3dpbmcgcHJvcGVyIGJhbm5lclxuXHRjb25zdCBvcGVyYXRvcnMgPSB7XG5cdFx0Z3QoIGEsIGIgKSB7XG5cdFx0XHRyZXR1cm4gYSA+PSBiO1xuXHRcdH0sXG5cdFx0bHQoIGEsIGIgKSB7XG5cdFx0XHRyZXR1cm4gYSA8PSBiO1xuXHRcdH0sXG5cdH07XG5cblx0Y29uc3QgY3VycmVudENvdW50ID0gc2V0Q3VycmVudENvdW50KCk7XG5cblx0aWYgKCAwIDwgJCggJy4nICsgY2hlY2tTZXNzaW9uQ2xhc3MgKS5sZW5ndGggKSB7XG5cdFx0JCggJy4nICsgY2hlY2tTZXNzaW9uQ2xhc3MgKS5lYWNoKCBmdW5jdGlvbigpIHtcblx0XHRcdGNvbnN0IGJhbm5lclNlc3Npb25Db3VudCA9IHBhcnNlSW50KCAkKCB0aGlzICkuZGF0YSggJ3Nlc3Npb24tY291bnQtdG8tY2hlY2snICkgKTtcblx0XHRcdGNvbnN0IGJhbm5lclNlc3Npb25PcGVyYXRvciA9ICQoIHRoaXMgKS5kYXRhKCAnc2Vzc2lvbi1jb3VudC1vcGVyYXRvcicgKTtcblx0XHRcdGlmIChcblx0XHRcdFx0b3BlcmF0b3JzWyBiYW5uZXJTZXNzaW9uT3BlcmF0b3IgXShcblx0XHRcdFx0XHRjdXJyZW50Q291bnQsXG5cdFx0XHRcdFx0YmFubmVyU2Vzc2lvbkNvdW50XG5cdFx0XHRcdClcblx0XHRcdCkge1xuXHRcdFx0XHRpZiAoICEgJCggdGhpcyApLmhhc0NsYXNzKCBwb3B1cFNlbGVjdG9yICkgKSB7XG5cdFx0XHRcdFx0JCggdGhpcyApLmFkZENsYXNzKCAndmFsaWRhdGVkJyApO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCAhIGdldENvb2tpZSggcG9wdXBTaG93bkNvb2tpZU5hbWUgKSApIHtcblx0XHRcdFx0XHQkKCB0aGlzICkuYWRkQ2xhc3MoICd2YWxpZGF0ZWQnICk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9ICk7XG5cdH1cblxuXHRpZiAoIDAgPCAkKCAnLicgKyBwb3B1cFNlbGVjdG9yICkubGVuZ3RoICkge1xuXHRcdHBvcHVwRGlzcGxheSggcG9wdXBTZWxlY3RvciwgY29va2llRGF5VG90YWwsIHBvcHVwU2hvd25Db29raWVOYW1lLCBwb3B1cFZpc2libGVDbGFzcyApO1xuXHR9XG59ICk7XG4iXX0=
}(jQuery));
