;(function($) {
"use strict";

/**
 * Sets cookies
 *
 * @param {string} name
 * @param {string} value
 * @param {number} days
 */
function setCookie(name, value, days) {
  var d = new Date();
  d.setTime(d.getTime() + 86400000 * days);
  document.cookie = name + '=' + value + ';path=/;expires=' + d.toGMTString();
}
/**
 * Reads cookies
 *
 * @param {string} name
 */


function getCookie(name) {
  var v = document.cookie.match('(^|;) ?' + name + '=([^;]*)(;|$)');
  return v ? v[2] : null;
}
/**
 * Faux "Session" checking/setting
 *
 * @return {number} currentCount
 */


function setCurrentCount() {
  // Timestamp stored on the cookie
  var currentCount = getCookie('count');
  var timestamp = Math.floor(new Date().getTime() / 1000);
  var cookieExpiration = 30; // expire the cooke in 30 days

  if (!getCookie('count')) {
    // First Visit - set count to 1
    setCookie('count', 1, cookieExpiration); // Set a timecheck cookie for an hour from now

    setCookie('timecheck', timestamp + 3600, cookieExpiration);
  } else if (timestamp > getCookie('timecheck')) {
    // Update Timecheck to new value
    setCookie('timecheck', timestamp + 3600, cookieExpiration); // Count exists already and it has been an hour. Update count

    setCookie('count', ++currentCount, cookieExpiration);
  }

  var urlParams = new URLSearchParams(window.location.search);

  if (urlParams.get('count') !== null) {
    currentCount = parseInt(urlParams.get('count'));
  }

  return currentCount;
}
/**
 * Show a specific popup. Sets a cookie and adds a visibility class.
 *
 * @param {string} popupSelector
 * @param {number} cookieDayTotal
 * @param {string} popupShownCookieName
 * @param {string} popupVisibleClass
 */


function showPopup(popupSelector, cookieDayTotal, popupShownCookieName, popupVisibleClass) {
  setCookie(popupShownCookieName, 'true', cookieDayTotal);

  if (0 < $('.validated').length) {
    $('.' + popupSelector + '.validated').addClass(popupVisibleClass);
  } else {
    $('.' + popupSelector + ':first').addClass(popupVisibleClass);
  }
}
/**
 * Show a specific popup. Sets a cookie and adds a visibility class.
 *
 * @param {string} popupSelector
 * @param {string} popupVisibleClass
 * @param {Object} lastFocus
 */


function hidePopup(popupSelector, popupVisibleClass, lastFocus) {
  lastFocus.focus();
  $('.' + popupSelector).removeClass(popupVisibleClass);
}
/**
 * Display and controls for popups
 *
 * @param {string} popupSelector
 * @param {number} cookieDayTotal
 * @param {string} popupShownCookieName
 * @param {string} popupVisibleClass
 * @param {string} checkSessionClass
 */


function popupDisplay(popupSelector, cookieDayTotal, popupShownCookieName, popupVisibleClass, checkSessionClass) {
  var lastFocus = document.activeElement; // put in a close button at the end

  $('.' + popupSelector + ' article').append('<a href="#" class="sm-close-btn" aria-label="Close"><i class="fas fa-times" aria-hidden="true"></i></a>'); // Check if we should be showing the popup

  if ('true' !== getCookie(popupShownCookieName) && !$('.' + popupSelector).hasClass(checkSessionClass)) {
    showPopup(popupSelector, cookieDayTotal, popupShownCookieName, popupVisibleClass);
  }

  document.addEventListener('click', function (event) {
    if (!$(event.target).closest('.' + popupSelector).is('.' + popupSelector) && $('.' + popupSelector).hasClass(popupVisibleClass)) {
      hidePopup(popupSelector, popupVisibleClass, lastFocus);
    }
  }, true); // popup close button

  $('.' + popupSelector).on('click', '.sm-close-btn', function (e) {
    e.preventDefault();
    hidePopup(popupSelector, popupVisibleClass, lastFocus);
  }); // escape key

  $(document).keyup(function (e) {
    if (27 === e.keyCode) {
      hidePopup(popupSelector, popupVisibleClass, lastFocus);
    }
  });
}
/**
 * When jQuery is loaded, set up session tracking and popup display
 *
 */


$(document).ready(function () {
  var popupSelector = 'wp-message-inserter-message-popup';
  var popupShownCookieName = 'sm-shown';
  var popupVisibleClass = 'wp-message-inserter-message-popup-visible';
  var checkSessionClass = 'check-session-message'; // Get our value for days and hours to set cookie

  var closeTimeDays = parseInt($('.' + popupSelector).data('close-time-days')) || 0;
  var closeTimeHours = (parseInt($('.' + popupSelector).data('close-time-hours')) || 0) / 24; // Our Total for when the cookie should expire and show the banner again

  var cookieDayTotal = closeTimeDays + closeTimeHours; // Session Validating and showing proper banner

  var operators = {
    gt: function gt(a, b) {
      return a >= b;
    },
    lt: function lt(a, b) {
      return a <= b;
    }
  };
  var currentCount = setCurrentCount();

  if (0 < $('.' + checkSessionClass).length) {
    $('.' + checkSessionClass).each(function () {
      var bannerSessionCount = parseInt($(this).data('session-count-to-check'));
      var bannerSessionOperator = $(this).data('session-count-operator');

      if (operators[bannerSessionOperator](currentCount, bannerSessionCount)) {
        if (!$(this).hasClass(popupSelector)) {
          $(this).addClass('validated');
        } else if (!getCookie(popupShownCookieName)) {
          $(this).addClass('validated');
        }
      }
    });
  }

  if (0 < $('.' + popupSelector).length) {
    popupDisplay(popupSelector, cookieDayTotal, popupShownCookieName, popupVisibleClass);
  }
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIjAxLW1lc3NhZ2VzLmpzIl0sIm5hbWVzIjpbInNldENvb2tpZSIsIm5hbWUiLCJ2YWx1ZSIsImRheXMiLCJkIiwiRGF0ZSIsInNldFRpbWUiLCJnZXRUaW1lIiwiZG9jdW1lbnQiLCJjb29raWUiLCJ0b0dNVFN0cmluZyIsImdldENvb2tpZSIsInYiLCJtYXRjaCIsInNldEN1cnJlbnRDb3VudCIsImN1cnJlbnRDb3VudCIsInRpbWVzdGFtcCIsIk1hdGgiLCJmbG9vciIsImNvb2tpZUV4cGlyYXRpb24iLCJ1cmxQYXJhbXMiLCJVUkxTZWFyY2hQYXJhbXMiLCJ3aW5kb3ciLCJsb2NhdGlvbiIsInNlYXJjaCIsImdldCIsInBhcnNlSW50Iiwic2hvd1BvcHVwIiwicG9wdXBTZWxlY3RvciIsImNvb2tpZURheVRvdGFsIiwicG9wdXBTaG93bkNvb2tpZU5hbWUiLCJwb3B1cFZpc2libGVDbGFzcyIsIiQiLCJsZW5ndGgiLCJhZGRDbGFzcyIsImhpZGVQb3B1cCIsImxhc3RGb2N1cyIsImZvY3VzIiwicmVtb3ZlQ2xhc3MiLCJwb3B1cERpc3BsYXkiLCJjaGVja1Nlc3Npb25DbGFzcyIsImFjdGl2ZUVsZW1lbnQiLCJhcHBlbmQiLCJoYXNDbGFzcyIsImFkZEV2ZW50TGlzdGVuZXIiLCJldmVudCIsInRhcmdldCIsImNsb3Nlc3QiLCJpcyIsIm9uIiwiZSIsInByZXZlbnREZWZhdWx0Iiwia2V5dXAiLCJrZXlDb2RlIiwicmVhZHkiLCJjbG9zZVRpbWVEYXlzIiwiZGF0YSIsImNsb3NlVGltZUhvdXJzIiwib3BlcmF0b3JzIiwiZ3QiLCJhIiwiYiIsImx0IiwiZWFjaCIsImJhbm5lclNlc3Npb25Db3VudCIsImJhbm5lclNlc3Npb25PcGVyYXRvciJdLCJtYXBwaW5ncyI6Ijs7QUFBQTs7Ozs7OztBQU9BLFNBQVNBLFNBQVQsQ0FBb0JDLElBQXBCLEVBQTBCQyxLQUExQixFQUFpQ0MsSUFBakMsRUFBd0M7QUFDdkMsTUFBTUMsQ0FBQyxHQUFHLElBQUlDLElB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c2FnZS1pbnNlcnRlci1wbHVnaW4tZnJvbnQtZW5kLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBTZXRzIGNvb2tpZXNcbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gbmFtZVxuICogQHBhcmFtIHtzdHJpbmd9IHZhbHVlXG4gKiBAcGFyYW0ge251bWJlcn0gZGF5c1xuICovXG5mdW5jdGlvbiBzZXRDb29raWUoIG5hbWUsIHZhbHVlLCBkYXlzICkge1xuXHRjb25zdCBkID0gbmV3IERhdGUoKTtcblx0ZC5zZXRUaW1lKCBkLmdldFRpbWUoKSArICggODY0MDAwMDAgKiBkYXlzICkgKTtcblx0ZG9jdW1lbnQuY29va2llID0gbmFtZSArICc9JyArIHZhbHVlICsgJztwYXRoPS87ZXhwaXJlcz0nICsgZC50b0dNVFN0cmluZygpO1xufVxuXG4vKipcbiAqIFJlYWRzIGNvb2tpZXNcbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gbmFtZVxuICovXG5mdW5jdGlvbiBnZXRDb29raWUoIG5hbWUgKSB7XG5cdGNvbnN0IHYgPSBkb2N1bWVudC5jb29raWUubWF0Y2goICcoXnw7KSA/JyArIG5hbWUgKyAnPShbXjtdKikoO3wkKScgKTtcblx0cmV0dXJuIHYgPyB2WyAyIF0gOiBudWxsO1xufVxuXG4vKipcbiAqIEZhdXggXCJTZXNzaW9uXCIgY2hlY2tpbmcvc2V0dGluZ1xuICpcbiAqIEByZXR1cm4ge251bWJlcn0gY3VycmVudENvdW50XG4gKi9cbmZ1bmN0aW9uIHNldEN1cnJlbnRDb3VudCgpIHtcblx0Ly8gVGltZXN0YW1wIHN0b3JlZCBvbiB0aGUgY29va2llXG5cdGxldCBjdXJyZW50Q291bnQgPSBnZXRDb29raWUoICdjb3VudCcgKTtcblx0Y29uc3QgdGltZXN0YW1wID0gTWF0aC5mbG9vciggbmV3IERhdGUoKS5nZXRUaW1lKCkgLyAxMDAwICk7XG5cdGNvbnN0IGNvb2tpZUV4cGlyYXRpb24gPSAzMDsgLy8gZXhwaXJlIHRoZSBjb29rZSBpbiAzMCBkYXlzXG5cdGlmICggISBnZXRDb29raWUoICdjb3VudCcgKSApIHtcblx0XHQvLyBGaXJzdCBWaXNpdCAtIHNldCBjb3VudCB0byAxXG5cdFx0c2V0Q29va2llKCAnY291bnQnLCAxLCBjb29raWVFeHBpcmF0aW9uICk7XG5cdFx0Ly8gU2V0IGEgdGltZWNoZWNrIGNvb2tpZSBmb3IgYW4gaG91ciBmcm9tIG5vd1xuXHRcdHNldENvb2tpZSggJ3RpbWVjaGVjaycsIHRpbWVzdGFtcCArIDM2MDAsIGNvb2tpZUV4cGlyYXRpb24gKTtcblx0fSBlbHNlIGlmICggdGltZXN0YW1wID4gZ2V0Q29va2llKCAndGltZWNoZWNrJyApICkge1xuXHRcdC8vIFVwZGF0ZSBUaW1lY2hlY2sgdG8gbmV3IHZhbHVlXG5cdFx0c2V0Q29va2llKCAndGltZWNoZWNrJywgdGltZXN0YW1wICsgMzYwMCwgY29va2llRXhwaXJhdGlvbiApO1xuXHRcdC8vIENvdW50IGV4aXN0cyBhbHJlYWR5IGFuZCBpdCBoYXMgYmVlbiBhbiBob3VyLiBVcGRhdGUgY291bnRcblx0XHRzZXRDb29raWUoICdjb3VudCcsICsrY3VycmVudENvdW50LCBjb29raWVFeHBpcmF0aW9uICk7XG5cdH1cblx0Y29uc3QgdXJsUGFyYW1zID0gbmV3IFVSTFNlYXJjaFBhcmFtcyggd2luZG93LmxvY2F0aW9uLnNlYXJjaCApO1xuXHRpZiAoIHVybFBhcmFtcy5nZXQoICdjb3VudCcgKSAhPT0gbnVsbCApIHtcblx0XHRjdXJyZW50Q291bnQgPSBwYXJzZUludCggdXJsUGFyYW1zLmdldCggJ2NvdW50JyApICk7XG5cdH1cblx0cmV0dXJuIGN1cnJlbnRDb3VudDtcbn1cblxuLyoqXG4gKiBTaG93IGEgc3BlY2lmaWMgcG9wdXAuIFNldHMgYSBjb29raWUgYW5kIGFkZHMgYSB2aXNpYmlsaXR5IGNsYXNzLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBwb3B1cFNlbGVjdG9yXG4gKiBAcGFyYW0ge251bWJlcn0gY29va2llRGF5VG90YWxcbiAqIEBwYXJhbSB7c3RyaW5nfSBwb3B1cFNob3duQ29va2llTmFtZVxuICogQHBhcmFtIHtzdHJpbmd9IHBvcHVwVmlzaWJsZUNsYXNzXG4gKi9cbmZ1bmN0aW9uIHNob3dQb3B1cCggcG9wdXBTZWxlY3RvciwgY29va2llRGF5VG90YWwsIHBvcHVwU2hvd25Db29raWVOYW1lLCBwb3B1cFZpc2libGVDbGFzcyApIHtcblx0c2V0Q29va2llKCBwb3B1cFNob3duQ29va2llTmFtZSwgJ3RydWUnLCBjb29raWVEYXlUb3RhbCApO1xuXHRpZiAoIDAgPCAkKCAnLnZhbGlkYXRlZCcgKS5sZW5ndGggKSB7XG5cdFx0JCggJy4nICsgcG9wdXBTZWxlY3RvciArICcudmFsaWRhdGVkJyApLmFkZENsYXNzKCBwb3B1cFZpc2libGVDbGFzcyApO1xuXHR9IGVsc2Uge1xuXHRcdCQoICcuJyArIHBvcHVwU2VsZWN0b3IgKyAnOmZpcnN0JyApLmFkZENsYXNzKCBwb3B1cFZpc2libGVDbGFzcyApO1xuXHR9XG59XG5cbi8qKlxuICogU2hvdyBhIHNwZWNpZmljIHBvcHVwLiBTZXRzIGEgY29va2llIGFuZCBhZGRzIGEgdmlzaWJpbGl0eSBjbGFzcy5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gcG9wdXBTZWxlY3RvclxuICogQHBhcmFtIHtzdHJpbmd9IHBvcHVwVmlzaWJsZUNsYXNzXG4gKiBAcGFyYW0ge09iamVjdH0gbGFzdEZvY3VzXG4gKi9cbmZ1bmN0aW9uIGhpZGVQb3B1cCggcG9wdXBTZWxlY3RvciwgcG9wdXBWaXNpYmxlQ2xhc3MsIGxhc3RGb2N1cyApIHtcblx0bGFzdEZvY3VzLmZvY3VzKCk7XG5cdCQoICcuJyArIHBvcHVwU2VsZWN0b3IgKS5yZW1vdmVDbGFzcyggcG9wdXBWaXNpYmxlQ2xhc3MgKTtcbn1cblxuLyoqXG4gKiBEaXNwbGF5IGFuZCBjb250cm9scyBmb3IgcG9wdXBzXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IHBvcHVwU2VsZWN0b3JcbiAqIEBwYXJhbSB7bnVtYmVyfSBjb29raWVEYXlUb3RhbFxuICogQHBhcmFtIHtzdHJpbmd9IHBvcHVwU2hvd25Db29raWVOYW1lXG4gKiBAcGFyYW0ge3N0cmluZ30gcG9wdXBWaXNpYmxlQ2xhc3NcbiAqIEBwYXJhbSB7c3RyaW5nfSBjaGVja1Nlc3Npb25DbGFzc1xuICovXG5mdW5jdGlvbiBwb3B1cERpc3BsYXkoIHBvcHVwU2VsZWN0b3IsIGNvb2tpZURheVRvdGFsLCBwb3B1cFNob3duQ29va2llTmFtZSwgcG9wdXBWaXNpYmxlQ2xhc3MsIGNoZWNrU2Vzc2lvbkNsYXNzICkge1xuXHRjb25zdCBsYXN0Rm9jdXMgPSBkb2N1bWVudC5hY3RpdmVFbGVtZW50O1xuXHQvLyBwdXQgaW4gYSBjbG9zZSBidXR0b24gYXQgdGhlIGVuZFxuXHQkKCAnLicgKyBwb3B1cFNlbGVjdG9yICsgJyBhcnRpY2xlJyApLmFwcGVuZCggJzxhIGhyZWY9XCIjXCIgY2xhc3M9XCJzbS1jbG9zZS1idG5cIiBhcmlhLWxhYmVsPVwiQ2xvc2VcIj48aSBjbGFzcz1cImZhcyBmYS10aW1lc1wiIGFyaWEtaGlkZGVuPVwidHJ1ZVwiPjwvaT48L2E+JyApO1xuXHQvLyBDaGVjayBpZiB3ZSBzaG91bGQgYmUgc2hvd2luZyB0aGUgcG9wdXBcblx0aWYgKFxuXHRcdCd0cnVlJyAhPT0gZ2V0Q29va2llKCBwb3B1cFNob3duQ29va2llTmFtZSApICYmXG5cdFx0ISAkKCAnLicgKyBwb3B1cFNlbGVjdG9yICkuaGFzQ2xhc3MoIGNoZWNrU2Vzc2lvbkNsYXNzIClcblx0KSB7XG5cdFx0c2hvd1BvcHVwKCBwb3B1cFNlbGVjdG9yLCBjb29raWVEYXlUb3RhbCwgcG9wdXBTaG93bkNvb2tpZU5hbWUsIHBvcHVwVmlzaWJsZUNsYXNzICk7XG5cdH1cblxuXHRkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCAnY2xpY2snLCBmdW5jdGlvbiggZXZlbnQgKSB7XG5cdFx0aWYgKFxuXHRcdFx0ISAkKCBldmVudC50YXJnZXQgKS5jbG9zZXN0KCAnLicgKyBwb3B1cFNlbGVjdG9yICkuaXMoICcuJyArIHBvcHVwU2VsZWN0b3IgKSAmJlxuXHRcdFx0JCggJy4nICsgcG9wdXBTZWxlY3RvciApLmhhc0NsYXNzKCBwb3B1cFZpc2libGVDbGFzcyApXG5cdFx0KSB7XG5cdFx0XHRoaWRlUG9wdXAoIHBvcHVwU2VsZWN0b3IsIHBvcHVwVmlzaWJsZUNsYXNzLCBsYXN0Rm9jdXMgKTtcblx0XHR9XG5cdH0sIHRydWUgKTtcblxuXHQvLyBwb3B1cCBjbG9zZSBidXR0b25cblx0JCggJy4nICsgcG9wdXBTZWxlY3RvciApLm9uKCAnY2xpY2snLCAnLnNtLWNsb3NlLWJ0bicsIGZ1bmN0aW9uKCBlICkge1xuXHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRoaWRlUG9wdXAoIHBvcHVwU2VsZWN0b3IsIHBvcHVwVmlzaWJsZUNsYXNzLCBsYXN0Rm9jdXMgKTtcblx0fSApO1xuXG5cdC8vIGVzY2FwZSBrZXlcblx0JCggZG9jdW1lbnQgKS5rZXl1cCggZnVuY3Rpb24oIGUgKSB7XG5cdFx0aWYgKCAyNyA9PT0gZS5rZXlDb2RlICkge1xuXHRcdFx0aGlkZVBvcHVwKCBwb3B1cFNlbGVjdG9yLCBwb3B1cFZpc2libGVDbGFzcywgbGFzdEZvY3VzICk7XG5cdFx0fVxuXHR9ICk7XG59XG5cbi8qKlxuICogV2hlbiBqUXVlcnkgaXMgbG9hZGVkLCBzZXQgdXAgc2Vzc2lvbiB0cmFja2luZyBhbmQgcG9wdXAgZGlzcGxheVxuICpcbiAqL1xuJCggZG9jdW1lbnQgKS5yZWFkeSggZnVuY3Rpb24oKSB7XG5cdGNvbnN0IHBvcHVwU2VsZWN0b3IgPSAnd3AtbWVzc2FnZS1pbnNlcnRlci1tZXNzYWdlLXBvcHVwJztcblx0Y29uc3QgcG9wdXBTaG93bkNvb2tpZU5hbWUgPSAnc20tc2hvd24nO1xuXHRjb25zdCBwb3B1cFZpc2libGVDbGFzcyA9ICd3cC1tZXNzYWdlLWluc2VydGVyLW1lc3NhZ2UtcG9wdXAtdmlzaWJsZSc7XG5cdGNvbnN0IGNoZWNrU2Vzc2lvbkNsYXNzID0gJ2NoZWNrLXNlc3Npb24tbWVzc2FnZSc7XG5cblx0Ly8gR2V0IG91ciB2YWx1ZSBmb3IgZGF5cyBhbmQgaG91cnMgdG8gc2V0IGNvb2tpZVxuXHRjb25zdCBjbG9zZVRpbWVEYXlzID0gcGFyc2VJbnQoICQoICcuJyArIHBvcHVwU2VsZWN0b3IgKS5kYXRhKCAnY2xvc2UtdGltZS1kYXlzJyApICkgfHwgMDtcblx0Y29uc3QgY2xvc2VUaW1lSG91cnMgPSAoIHBhcnNlSW50KCAkKCAnLicgKyBwb3B1cFNlbGVjdG9yICkuZGF0YSggJ2Nsb3NlLXRpbWUtaG91cnMnICkgKSB8fCAwICkgLyAyNDtcblx0Ly8gT3VyIFRvdGFsIGZvciB3aGVuIHRoZSBjb29raWUgc2hvdWxkIGV4cGlyZSBhbmQgc2hvdyB0aGUgYmFubmVyIGFnYWluXG5cdGNvbnN0IGNvb2tpZURheVRvdGFsID0gY2xvc2VUaW1lRGF5cyArIGNsb3NlVGltZUhvdXJzO1xuXG5cdC8vIFNlc3Npb24gVmFsaWRhdGluZyBhbmQgc2hvd2luZyBwcm9wZXIgYmFubmVyXG5cdGNvbnN0IG9wZXJhdG9ycyA9IHtcblx0XHRndCggYSwgYiApIHtcblx0XHRcdHJldHVybiBhID49IGI7XG5cdFx0fSxcblx0XHRsdCggYSwgYiApIHtcblx0XHRcdHJldHVybiBhIDw9IGI7XG5cdFx0fSxcblx0fTtcblxuXHRjb25zdCBjdXJyZW50Q291bnQgPSBzZXRDdXJyZW50Q291bnQoKTtcblxuXHRpZiAoIDAgPCAkKCAnLicgKyBjaGVja1Nlc3Npb25DbGFzcyApLmxlbmd0aCApIHtcblx0XHQkKCAnLicgKyBjaGVja1Nlc3Npb25DbGFzcyApLmVhY2goIGZ1bmN0aW9uKCkge1xuXHRcdFx0Y29uc3QgYmFubmVyU2Vzc2lvbkNvdW50ID0gcGFyc2VJbnQoICQoIHRoaXMgKS5kYXRhKCAnc2Vzc2lvbi1jb3VudC10by1jaGVjaycgKSApO1xuXHRcdFx0Y29uc3QgYmFubmVyU2Vzc2lvbk9wZXJhdG9yID0gJCggdGhpcyApLmRhdGEoICdzZXNzaW9uLWNvdW50LW9wZXJhdG9yJyApO1xuXHRcdFx0aWYgKFxuXHRcdFx0XHRvcGVyYXRvcnNbIGJhbm5lclNlc3Npb25PcGVyYXRvciBdKFxuXHRcdFx0XHRcdGN1cnJlbnRDb3VudCxcblx0XHRcdFx0XHRiYW5uZXJTZXNzaW9uQ291bnRcblx0XHRcdFx0KVxuXHRcdFx0KSB7XG5cdFx0XHRcdGlmICggISAkKCB0aGlzICkuaGFzQ2xhc3MoIHBvcHVwU2VsZWN0b3IgKSApIHtcblx0XHRcdFx0XHQkKCB0aGlzICkuYWRkQ2xhc3MoICd2YWxpZGF0ZWQnICk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoICEgZ2V0Q29va2llKCBwb3B1cFNob3duQ29va2llTmFtZSApICkge1xuXHRcdFx0XHRcdCQoIHRoaXMgKS5hZGRDbGFzcyggJ3ZhbGlkYXRlZCcgKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH0gKTtcblx0fVxuXG5cdGlmICggMCA8ICQoICcuJyArIHBvcHVwU2VsZWN0b3IgKS5sZW5ndGggKSB7XG5cdFx0cG9wdXBEaXNwbGF5KCBwb3B1cFNlbGVjdG9yLCBjb29raWVEYXlUb3RhbCwgcG9wdXBTaG93bkNvb2tpZU5hbWUsIHBvcHVwVmlzaWJsZUNsYXNzICk7XG5cdH1cbn0gKTtcbiJdfQ==
}(jQuery));
