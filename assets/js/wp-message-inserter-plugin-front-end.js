;(function($) {
"use strict";

/**
 * Sets cookies
 *
 * @param {string} name
 * @param {string} value
 * @param {number} days
 */
function setCookie(name, value, days) {
  var d = new Date();
  d.setTime(d.getTime() + 86400000 * days);
  document.cookie = name + '=' + value + ';path=/;expires=' + d.toGMTString();
}
/**
 * Reads cookies
 *
 * @param {string} name
 */


function getCookie(name) {
  var v = document.cookie.match('(^|;) ?' + name + '=([^;]*)(;|$)');
  return v ? v[2] : null;
}
/**
 * Creating Analytics events
 *
 * @param {string} type
 * @param {string} category
 * @param {string} action
 * @param {string} label
 * @param {Array}  value
 */


function analyticsTrackingEvent(type, category, action, label, value) {
  category = 'Site Message: ' + category.charAt(0).toUpperCase() + category.slice(1);

  if ('undefined' !== typeof ga) {
    if ('undefined' === typeof value) {
      ga('send', type, category, action, label);
    } else {
      ga('send', type, category, action, label, value);
    }
  } else {}
}
/**
 * Faux "Session" checking/setting
 *
 * @return {number} currentCount
 */


function setCurrentCount() {
  // Timestamp stored on the cookie
  var currentCount = getCookie('count');
  var timestamp = Math.floor(new Date().getTime() / 1000);
  var cookieExpiration = 30; // expire the cooke in 30 days

  if (!getCookie('count')) {
    // First Visit - set count to 1
    setCookie('count', 1, cookieExpiration); // Set a timecheck cookie for an hour from now

    setCookie('timecheck', timestamp + 3600, cookieExpiration);
  } else if (timestamp > getCookie('timecheck')) {
    // Update Timecheck to new value
    setCookie('timecheck', timestamp + 3600, cookieExpiration); // Count exists already and it has been an hour. Update count

    setCookie('count', ++currentCount, cookieExpiration);
  }

  var urlParams = new URLSearchParams(window.location.search);

  if (urlParams.get('count') !== null) {
    currentCount = parseInt(urlParams.get('count'));
  }

  return currentCount;
}
/**
 * Get the WordPress post ID for a given popup.
 *
 * @param {string} popupSelector
 * @return {number} postId
 */


function getPostId(popupSelector) {
  var postId = 0;
  var classList = $('.' + popupSelector).attr('class').split(/\s+/);
  $.each(classList, function (index, item) {
    if (0 < item.indexOf('message-id')) {
      postId = item.substring(item.lastIndexOf('-') + 1);
      return false; // break each and postId will be returned
    }
  });
  return postId;
}
/**
 * Get the region for a given message.
 *
 * @param {Object} message
 * @return {string} region
 */


function getMessageRegion(message) {
  var region = '';
  var classList = $(message).attr('class').split(/\s+/);
  $.each(classList, function (index, item) {
    if (0 < item.indexOf('message-region')) {
      region = item.substring(item.lastIndexOf('-') + 1);
      return false; // break each and region will be returned
    }
  });
  return region;
}
/**
 * Show a specific popup. Sets a cookie and adds a visibility class.
 *
 * @param {string} popupSelector
 * @param {number} cookieDayTotal
 * @param {string} popupShownCookieName
 * @param {string} popupVisibleClass
 */


function showPopup(popupSelector, cookieDayTotal, popupShownCookieName, popupVisibleClass) {
  var popupId = 0;
  setCookie(popupShownCookieName, 'true', cookieDayTotal);

  if (0 < $('.validated').length) {
    $('.' + popupSelector + '.validated').addClass(popupVisibleClass);
    popupId = getPostId(popupSelector + '.validated');
  } else {
    $('.' + popupSelector + ':first').addClass(popupVisibleClass);
    popupId = getPostId(popupSelector + ':first');
  }

  if (0 !== popupId) {
    analyticsTrackingEvent('event', 'Popup', 'Show', popupId, {
      nonInteraction: 1
    });
  }
}
/**
 * Show a specific popup. Sets a cookie and adds a visibility class.
 *
 * @param {string} popupSelector
 * @param {string} popupVisibleClass
 * @param {Object} lastFocus
 * @param {string} closeTrigger
 */


function hidePopup(popupSelector, popupVisibleClass, lastFocus, closeTrigger) {
  lastFocus.focus();
  $('.' + popupSelector).removeClass(popupVisibleClass);
  var popupId = getPostId(popupSelector);

  if (0 !== popupId) {
    analyticsTrackingEvent('event', 'Popup', closeTrigger, popupId, {
      nonInteraction: 1
    });
  }
}
/**
 * Display and controls for popups
 *
 * @param {string} popupSelector
 * @param {number} cookieDayTotal
 * @param {string} popupShownCookieName
 * @param {string} popupVisibleClass
 * @param {string} checkSessionClass
 */


function popupDisplay(popupSelector, cookieDayTotal, popupShownCookieName, popupVisibleClass, checkSessionClass) {
  var lastFocus = document.activeElement; // Check if we should be showing the popup

  if ('true' !== getCookie(popupShownCookieName) && !$('.' + popupSelector).hasClass(checkSessionClass)) {
    showPopup(popupSelector, cookieDayTotal, popupShownCookieName, popupVisibleClass);
  } // click on login link inside popup


  $('.' + popupSelector).on('click', '.message-login', function () {
    var url = $(this).attr('href');
    analyticsTrackingEvent('event', 'Popup', 'Login Link', url);
  });
  document.addEventListener('click', function (event) {
    if (!$(event.target).closest('.' + popupSelector).is('.' + popupSelector) && $('.' + popupSelector).hasClass(popupVisibleClass)) {
      hidePopup(popupSelector, popupVisibleClass, lastFocus, 'Click Outside to Close');
    }
  }, true); // popup close button

  $('.' + popupSelector).on('click', '.sm-close-btn', function (e) {
    e.preventDefault();
    hidePopup(popupSelector, popupVisibleClass, lastFocus, 'Close Button');
  }); // escape key press

  $(document).keyup(function (e) {
    if (27 === e.keyCode) {
      hidePopup(popupSelector, popupVisibleClass, lastFocus, 'Escape Key');
    }
  }); // click on a non-login or close link inside popup

  $('.' + popupSelector).on('click', 'a:not( .sm-close-btn, .message-login )', function () {
    var popupId = getPostId(popupSelector);
    analyticsTrackingEvent('event', 'Popup', 'Click', popupId);
  });
}

function messageAnalytics(message) {
  var messageRegion = getMessageRegion('.' + message);
  var messageId = getPostId(message);

  if ($('.' + message).is(':visible')) {
    analyticsTrackingEvent('event', messageRegion, 'Show', messageId, {
      nonInteraction: 1
    });
  } // click on login link inside a message


  $('.' + message).on('click', '.message-login', function () {
    var url = $(this).attr('href');
    analyticsTrackingEvent('event', messageRegion, 'Login Link', url);
  }); // click on a non-login or close link inside a message

  $('.' + message).on('click', 'a:not( .sm-close-btn, .message-login )', function () {
    analyticsTrackingEvent('event', messageRegion, 'Click', messageId);
  });
}
/**
 * When jQuery is loaded, set up session tracking and popup display
 *
 */


$(document).ready(function () {
  var popupSelector = 'wp-message-inserter-message-region-popup';
  var popupShownCookieName = 'sm-shown';
  var popupVisibleClass = 'wp-message-inserter-message-popup-visible';
  var checkSessionClass = 'check-session-message';
  var messageSelector = 'wp-message-inserter-message'; // Get our value for days and hours to set cookie

  var closeTimeDays = parseInt($('.' + popupSelector).data('close-time-days')) || 0;
  var closeTimeHours = (parseInt($('.' + popupSelector).data('close-time-hours')) || 0) / 24; // Our Total for when the cookie should expire and show the banner again

  var cookieDayTotal = closeTimeDays + closeTimeHours; // Session Validating and showing proper banner

  var operators = {
    gt: function gt(a, b) {
      return a >= b;
    },
    lt: function lt(a, b) {
      return a <= b;
    }
  };
  var currentCount = setCurrentCount();

  if (0 < $('.' + checkSessionClass).length) {
    $('.' + checkSessionClass).each(function () {
      var bannerSessionCount = parseInt($(this).data('session-count-to-check'));
      var bannerSessionOperator = $(this).data('session-count-operator');

      if (operators[bannerSessionOperator](currentCount, bannerSessionCount)) {
        if (!$(this).hasClass(popupSelector)) {
          $(this).addClass('validated');
        } else if (!getCookie(popupShownCookieName)) {
          $(this).addClass('validated');
        }
      }
    });
  }

  if (0 < $('.' + popupSelector).length) {
    popupDisplay(popupSelector, cookieDayTotal, popupShownCookieName, popupVisibleClass);
  }

  if (0 < $('.' + messageSelector + ':not( .' + popupSelector + ' )').length) {
    messageAnalytics(messageSelector + ':not( .' + popupSelector + ' )');
  }
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIjAxLW1lc3NhZ2VzLmpzIl0sIm5hbWVzIjpbInNldENvb2tpZSIsIm5hbWUiLCJ2YWx1ZSIsImRheXMiLCJkIiwiRGF0ZSIsInNldFRpbWUiLCJnZXRUaW1lIiwiZG9jdW1lbnQiLCJjb29raWUiLCJ0b0dNVFN0cmluZyIsImdldENvb2tpZSIsInYiLCJtYXRjaCIsImFuYWx5dGljc1RyYWNraW5nRXZlbnQiLCJ0eXBlIiwiY2F0ZWdvcnkiLCJhY3Rpb24iLCJsYWJlbCIsImNoYXJBdCIsInRvVXBwZXJDYXNlIiwic2xpY2UiLCJnYSIsInNldEN1cnJlbnRDb3VudCIsImN1cnJlbnRDb3VudCIsInRpbWVzdGFtcCIsIk1hdGgiLCJmbG9vciIsImNvb2tpZUV4cGlyYXRpb24iLCJ1cmxQYXJhbXMiLCJVUkxTZWFyY2hQYXJhbXMiLCJ3aW5kb3ciLCJsb2NhdGlvbiIsInNlYXJjaCIsImdldCIsInBhcnNlSW50IiwiZ2V0UG9zdElkIiwicG9wdXBTZWxlY3RvciIsInBvc3RJZCIsImNsYXNzTGlzdCIsIiQiLCJhdHRyIiwic3BsaXQiLCJlYWNoIiwiaW5kZXgiLCJpdGVtIiwiaW5kZXhPZiIsInN1YnN0cmluZyIsImxhc3RJbmRleE9mIiwiZ2V0TWVzc2FnZVJlZ2lvbiIsIm1lc3NhZ2UiLCJyZWdpb24iLCJzaG93UG9wdXAiLCJjb29raWVEYXlUb3RhbCIsInBvcHVwU2hvd25Db29raWVOYW1lIiwicG9wdXBWaXNpYmxlQ2xhc3MiLCJwb3B1cElkIiwibGVuZ3RoIiwiYWRkQ2xhc3MiLCJub25JbnRlcmFjdGlvbiIsImhpZGVQb3B1cCIsImxhc3RGb2N1cyIsImNsb3NlVHJpZ2dlciIsImZvY3VzIiwicmVtb3ZlQ2xhc3MiLCJwb3B1cERpc3BsYXkiLCJjaGVja1Nlc3Npb25DbGFzcyIsImFjdGl2ZUVsZW1lbnQiLCJoYXNDbGFzcyIsIm9uIiwidXJsIiwiYWRkRXZlbnRMaXN0ZW5lciIsImV2ZW50IiwidGFyZ2V0IiwiY2xvc2VzdCIsImlzIiwiZSIsInByZXZlbnREZWZhdWx0Iiwia2V5dXAiLCJrZXlDb2RlIiwibWVzc2FnZUFuYWx5dGljcyIsIm1lc3NhZ2VSZWdpb24iLCJtZXNzYWdlSWQiLCJyZWFkeSIsIm1lc3NhZ2VTZWxlY3RvciIsImNsb3NlVGltZURheXMiLCJkYXRhIiwiY2xvc2VUaW1lSG91cnMiLCJvcGVyYXRvcnMiLCJndCIsImEiLCJiIiwibHQiLCJiYW5uZXJTZXNzaW9uQ291bnQiLCJiYW5uZXJTZXNzaW9uT3BlcmF0b3IiXSwibWFwcGluZ3MiOiI7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTQSxTQUFULENBQW9CQyxJQUFwQixFQUEwQkMsS0FBMUIsRUFBaUNDLElBQWpDLEVBQXdDO0FBQ3ZDLE1BQU1DLENBQUMsR0FBRyxJQUFJQyxJQUFKLEVBQVY7QUFDQUQsRUFBQUEsQ0FBQyxDQUFDRSxPQUFGLENBQVdGLENBQUMsQ0FBQ0csT0FBRixLQUFjLFdBQVdKLElBQXBDO0FBQ0FLLEVBQUFBLFFBQVEsQ0FBQ0MsTUFBVCxHQUFrQlIsSUFBSSxHQUFHLEdBQVAsR0FBYUMsS0FBYixHQUFxQixrQkFBckIsR0FBMENFLENBQUMsQ0FBQ00sV0FBRixFQUE1RDtBQUNBO0FBRUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBQ0EsU0FBU0MsU0FBVCxDQUFvQlYsSUFBcEIsRUFBMkI7QUFDMUIsTUFBTVcsQ0FBQyxHQUFHSixRQUFRLENBQUNDLE1BQVQsQ0FBZ0JJLEtBQWhCLENBQXVCLFlBQVlaLElBQVosR0FBbUIsZUFBMUMsQ0FBVjtBQUNBLFNBQU9XLENBQUMsR0FBR0EsQ0FBQyxDQUFFLENBQUYsQ0FBSixHQUFZLElBQXBCO0FBQ0E7QUFFRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUNBLFNBQVNFLHNCQUFULENBQWlDQyxJQUFqQyxFQUF1Q0MsUUFBdkMsRUFBaURDLE1BQWpELEVBQXlEQyxLQUF6RCxFQUFnRWhCLEtBQWhFLEVBQXdFO0FBQ3ZFYyxFQUFBQSxR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Q1EsSUFBQUEsWUFBWSxDQUNYNUIsYUFEVyxFQUVYZ0IsY0FGVyxFQUdYQyxvQkFIVyxFQUlYQyxpQkFKVyxDQUFaO0FBTUE7O0FBRUQsTUFDQyxJQUFJZixDQUFDLENBQUUsTUFBTTRDLGVBQU4sR0FBd0IsU0FBeEIsR0FBb0MvQyxhQUFwQyxHQUFvRCxJQUF0RCxDQUFELENBQThEb0IsTUFEbkUsRUFFRTtBQUNEdUIsSUFBQUEsZ0JBQWdCLENBQUVJLGVBQWUsR0FBRyxTQUFsQixHQUE4Qi9DLGFBQTlCLEdBQThDLElBQWhELENBQWhCO0FBQ0E7QUFDRCxDQWpFRCIsImZpbGUiOiJ3cC1tZXNzYWdlLWluc2VydGVyLXBsdWdpbi1mcm9udC1lbmQuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFNldHMgY29va2llc1xuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBuYW1lXG4gKiBAcGFyYW0ge3N0cmluZ30gdmFsdWVcbiAqIEBwYXJhbSB7bnVtYmVyfSBkYXlzXG4gKi9cbmZ1bmN0aW9uIHNldENvb2tpZSggbmFtZSwgdmFsdWUsIGRheXMgKSB7XG5cdGNvbnN0IGQgPSBuZXcgRGF0ZSgpO1xuXHRkLnNldFRpbWUoIGQuZ2V0VGltZSgpICsgODY0MDAwMDAgKiBkYXlzICk7XG5cdGRvY3VtZW50LmNvb2tpZSA9IG5hbWUgKyAnPScgKyB2YWx1ZSArICc7cGF0aD0vO2V4cGlyZXM9JyArIGQudG9HTVRTdHJpbmcoKTtcbn1cblxuLyoqXG4gKiBSZWFkcyBjb29raWVzXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IG5hbWVcbiAqL1xuZnVuY3Rpb24gZ2V0Q29va2llKCBuYW1lICkge1xuXHRjb25zdCB2ID0gZG9jdW1lbnQuY29va2llLm1hdGNoKCAnKF58OykgPycgKyBuYW1lICsgJz0oW147XSopKDt8JCknICk7XG5cdHJldHVybiB2ID8gdlsgMiBdIDogbnVsbDtcbn1cblxuLyoqXG4gKiBDcmVhdGluZyBBbmFseXRpY3MgZXZlbnRzXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IHR5cGVcbiAqIEBwYXJhbSB7c3RyaW5nfSBjYXRlZ29yeVxuICogQHBhcmFtIHtzdHJpbmd9IGFjdGlvblxuICogQHBhcmFtIHtzdHJpbmd9IGxhYmVsXG4gKiBAcGFyYW0ge0FycmF5fSAgdmFsdWVcbiAqL1xuZnVuY3Rpb24gYW5hbHl0aWNzVHJhY2tpbmdFdmVudCggdHlwZSwgY2F0ZWdvcnksIGFjdGlvbiwgbGFiZWwsIHZhbHVlICkge1xuXHRjYXRlZ29yeSA9XG5cdFx0J1NpdGUgTWVzc2FnZTogJyArXG5cdFx0Y2F0ZWdvcnkuY2hhckF0KCAwICkudG9VcHBlckNhc2UoKSArXG5cdFx0Y2F0ZWdvcnkuc2xpY2UoIDEgKTtcblx0aWYgKCAndW5kZWZpbmVkJyAhPT0gdHlwZW9mIGdhICkge1xuXHRcdGlmICggJ3VuZGVmaW5lZCcgPT09IHR5cGVvZiB2YWx1ZSApIHtcblx0XHRcdGdhKCAnc2VuZCcsIHR5cGUsIGNhdGVnb3J5LCBhY3Rpb24sIGxhYmVsICk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdGdhKCAnc2VuZCcsIHR5cGUsIGNhdGVnb3J5LCBhY3Rpb24sIGxhYmVsLCB2YWx1ZSApO1xuXHRcdH1cblx0fSBlbHNlIHtcblx0fVxufVxuXG4vKipcbiAqIEZhdXggXCJTZXNzaW9uXCIgY2hlY2tpbmcvc2V0dGluZ1xuICpcbiAqIEByZXR1cm4ge251bWJlcn0gY3VycmVudENvdW50XG4gKi9cbmZ1bmN0aW9uIHNldEN1cnJlbnRDb3VudCgpIHtcblx0Ly8gVGltZXN0YW1wIHN0b3JlZCBvbiB0aGUgY29va2llXG5cdGxldCBjdXJyZW50Q291bnQgPSBnZXRDb29raWUoICdjb3VudCcgKTtcblx0Y29uc3QgdGltZXN0YW1wID0gTWF0aC5mbG9vciggbmV3IERhdGUoKS5nZXRUaW1lKCkgLyAxMDAwICk7XG5cdGNvbnN0IGNvb2tpZUV4cGlyYXRpb24gPSAzMDsgLy8gZXhwaXJlIHRoZSBjb29rZSBpbiAzMCBkYXlzXG5cdGlmICggISBnZXRDb29raWUoICdjb3VudCcgKSApIHtcblx0XHQvLyBGaXJzdCBWaXNpdCAtIHNldCBjb3VudCB0byAxXG5cdFx0c2V0Q29va2llKCAnY291bnQnLCAxLCBjb29raWVFeHBpcmF0aW9uICk7XG5cdFx0Ly8gU2V0IGEgdGltZWNoZWNrIGNvb2tpZSBmb3IgYW4gaG91ciBmcm9tIG5vd1xuXHRcdHNldENvb2tpZSggJ3RpbWVjaGVjaycsIHRpbWVzdGFtcCArIDM2MDAsIGNvb2tpZUV4cGlyYXRpb24gKTtcblx0fSBlbHNlIGlmICggdGltZXN0YW1wID4gZ2V0Q29va2llKCAndGltZWNoZWNrJyApICkge1xuXHRcdC8vIFVwZGF0ZSBUaW1lY2hlY2sgdG8gbmV3IHZhbHVlXG5cdFx0c2V0Q29va2llKCAndGltZWNoZWNrJywgdGltZXN0YW1wICsgMzYwMCwgY29va2llRXhwaXJhdGlvbiApO1xuXHRcdC8vIENvdW50IGV4aXN0cyBhbHJlYWR5IGFuZCBpdCBoYXMgYmVlbiBhbiBob3VyLiBVcGRhdGUgY291bnRcblx0XHRzZXRDb29raWUoICdjb3VudCcsICsrY3VycmVudENvdW50LCBjb29raWVFeHBpcmF0aW9uICk7XG5cdH1cblx0Y29uc3QgdXJsUGFyYW1zID0gbmV3IFVSTFNlYXJjaFBhcmFtcyggd2luZG93LmxvY2F0aW9uLnNlYXJjaCApO1xuXHRpZiAoIHVybFBhcmFtcy5nZXQoICdjb3VudCcgKSAhPT0gbnVsbCApIHtcblx0XHRjdXJyZW50Q291bnQgPSBwYXJzZUludCggdXJsUGFyYW1zLmdldCggJ2NvdW50JyApICk7XG5cdH1cblx0cmV0dXJuIGN1cnJlbnRDb3VudDtcbn1cblxuLyoqXG4gKiBHZXQgdGhlIFdvcmRQcmVzcyBwb3N0IElEIGZvciBhIGdpdmVuIHBvcHVwLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBwb3B1cFNlbGVjdG9yXG4gKiBAcmV0dXJuIHtudW1iZXJ9IHBvc3RJZFxuICovXG5mdW5jdGlvbiBnZXRQb3N0SWQoIHBvcHVwU2VsZWN0b3IgKSB7XG5cdGxldCBwb3N0SWQgPSAwO1xuXHRjb25zdCBjbGFzc0xpc3QgPSAkKCAnLicgKyBwb3B1cFNlbGVjdG9yIClcblx0XHQuYXR0ciggJ2NsYXNzJyApXG5cdFx0LnNwbGl0KCAvXFxzKy8gKTtcblx0JC5lYWNoKCBjbGFzc0xpc3QsIGZ1bmN0aW9uICggaW5kZXgsIGl0ZW0gKSB7XG5cdFx0aWYgKCAwIDwgaXRlbS5pbmRleE9mKCAnbWVzc2FnZS1pZCcgKSApIHtcblx0XHRcdHBvc3RJZCA9IGl0ZW0uc3Vic3RyaW5nKCBpdGVtLmxhc3RJbmRleE9mKCAnLScgKSArIDEgKTtcblx0XHRcdHJldHVybiBmYWxzZTsgLy8gYnJlYWsgZWFjaCBhbmQgcG9zdElkIHdpbGwgYmUgcmV0dXJuZWRcblx0XHR9XG5cdH0gKTtcblx0cmV0dXJuIHBvc3RJZDtcbn1cblxuLyoqXG4gKiBHZXQgdGhlIHJlZ2lvbiBmb3IgYSBnaXZlbiBtZXNzYWdlLlxuICpcbiAqIEBwYXJhbSB7T2JqZWN0fSBtZXNzYWdlXG4gKiBAcmV0dXJuIHtzdHJpbmd9IHJlZ2lvblxuICovXG5mdW5jdGlvbiBnZXRNZXNzYWdlUmVnaW9uKCBtZXNzYWdlICkge1xuXHRsZXQgcmVnaW9uID0gJyc7XG5cdGNvbnN0IGNsYXNzTGlzdCA9ICQoIG1lc3NhZ2UgKS5hdHRyKCAnY2xhc3MnICkuc3BsaXQoIC9cXHMrLyApO1xuXHQkLmVhY2goIGNsYXNzTGlzdCwgZnVuY3Rpb24gKCBpbmRleCwgaXRlbSApIHtcblx0XHRpZiAoIDAgPCBpdGVtLmluZGV4T2YoICdtZXNzYWdlLXJlZ2lvbicgKSApIHtcblx0XHRcdHJlZ2lvbiA9IGl0ZW0uc3Vic3RyaW5nKCBpdGVtLmxhc3RJbmRleE9mKCAnLScgKSArIDEgKTtcblx0XHRcdHJldHVybiBmYWxzZTsgLy8gYnJlYWsgZWFjaCBhbmQgcmVnaW9uIHdpbGwgYmUgcmV0dXJuZWRcblx0XHR9XG5cdH0gKTtcblx0cmV0dXJuIHJlZ2lvbjtcbn1cblxuLyoqXG4gKiBTaG93IGEgc3BlY2lmaWMgcG9wdXAuIFNldHMgYSBjb29raWUgYW5kIGFkZHMgYSB2aXNpYmlsaXR5IGNsYXNzLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBwb3B1cFNlbGVjdG9yXG4gKiBAcGFyYW0ge251bWJlcn0gY29va2llRGF5VG90YWxcbiAqIEBwYXJhbSB7c3RyaW5nfSBwb3B1cFNob3duQ29va2llTmFtZVxuICogQHBhcmFtIHtzdHJpbmd9IHBvcHVwVmlzaWJsZUNsYXNzXG4gKi9cbmZ1bmN0aW9uIHNob3dQb3B1cChcblx0cG9wdXBTZWxlY3Rvcixcblx0Y29va2llRGF5VG90YWwsXG5cdHBvcHVwU2hvd25Db29raWVOYW1lLFxuXHRwb3B1cFZpc2libGVDbGFzc1xuKSB7XG5cdGxldCBwb3B1cElkID0gMDtcblx0c2V0Q29va2llKCBwb3B1cFNob3duQ29va2llTmFtZSwgJ3RydWUnLCBjb29raWVEYXlUb3RhbCApO1xuXHRpZiAoIDAgPCAkKCAnLnZhbGlkYXRlZCcgKS5sZW5ndGggKSB7XG5cdFx0JCggJy4nICsgcG9wdXBTZWxlY3RvciArICcudmFsaWRhdGVkJyApLmFkZENsYXNzKCBwb3B1cFZpc2libGVDbGFzcyApO1xuXHRcdHBvcHVwSWQgPSBnZXRQb3N0SWQoIHBvcHVwU2VsZWN0b3IgKyAnLnZhbGlkYXRlZCcgKTtcblx0fSBlbHNlIHtcblx0XHQkKCAnLicgKyBwb3B1cFNlbGVjdG9yICsgJzpmaXJzdCcgKS5hZGRDbGFzcyggcG9wdXBWaXNpYmxlQ2xhc3MgKTtcblx0XHRwb3B1cElkID0gZ2V0UG9zdElkKCBwb3B1cFNlbGVjdG9yICsgJzpmaXJzdCcgKTtcblx0fVxuXHRpZiAoIDAgIT09IHBvcHVwSWQgKSB7XG5cdFx0YW5hbHl0aWNzVHJhY2tpbmdFdmVudCggJ2V2ZW50JywgJ1BvcHVwJywgJ1Nob3cnLCBwb3B1cElkLCB7XG5cdFx0XHRub25JbnRlcmFjdGlvbjogMSxcblx0XHR9ICk7XG5cdH1cbn1cblxuLyoqXG4gKiBTaG93IGEgc3BlY2lmaWMgcG9wdXAuIFNldHMgYSBjb29raWUgYW5kIGFkZHMgYSB2aXNpYmlsaXR5IGNsYXNzLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBwb3B1cFNlbGVjdG9yXG4gKiBAcGFyYW0ge3N0cmluZ30gcG9wdXBWaXNpYmxlQ2xhc3NcbiAqIEBwYXJhbSB7T2JqZWN0fSBsYXN0Rm9jdXNcbiAqIEBwYXJhbSB7c3RyaW5nfSBjbG9zZVRyaWdnZXJcbiAqL1xuZnVuY3Rpb24gaGlkZVBvcHVwKFxuXHRwb3B1cFNlbGVjdG9yLFxuXHRwb3B1cFZpc2libGVDbGFzcyxcblx0bGFzdEZvY3VzLFxuXHRjbG9zZVRyaWdnZXJcbikge1xuXHRsYXN0Rm9jdXMuZm9jdXMoKTtcblx0JCggJy4nICsgcG9wdXBTZWxlY3RvciApLnJlbW92ZUNsYXNzKCBwb3B1cFZpc2libGVDbGFzcyApO1xuXHRjb25zdCBwb3B1cElkID0gZ2V0UG9zdElkKCBwb3B1cFNlbGVjdG9yICk7XG5cdGlmICggMCAhPT0gcG9wdXBJZCApIHtcblx0XHRhbmFseXRpY3NUcmFja2luZ0V2ZW50KCAnZXZlbnQnLCAnUG9wdXAnLCBjbG9zZVRyaWdnZXIsIHBvcHVwSWQsIHtcblx0XHRcdG5vbkludGVyYWN0aW9uOiAxLFxuXHRcdH0gKTtcblx0fVxufVxuXG4vKipcbiAqIERpc3BsYXkgYW5kIGNvbnRyb2xzIGZvciBwb3B1cHNcbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gcG9wdXBTZWxlY3RvclxuICogQHBhcmFtIHtudW1iZXJ9IGNvb2tpZURheVRvdGFsXG4gKiBAcGFyYW0ge3N0cmluZ30gcG9wdXBTaG93bkNvb2tpZU5hbWVcbiAqIEBwYXJhbSB7c3RyaW5nfSBwb3B1cFZpc2libGVDbGFzc1xuICogQHBhcmFtIHtzdHJpbmd9IGNoZWNrU2Vzc2lvbkNsYXNzXG4gKi9cbmZ1bmN0aW9uIHBvcHVwRGlzcGxheShcblx0cG9wdXBTZWxlY3Rvcixcblx0Y29va2llRGF5VG90YWwsXG5cdHBvcHVwU2hvd25Db29raWVOYW1lLFxuXHRwb3B1cFZpc2libGVDbGFzcyxcblx0Y2hlY2tTZXNzaW9uQ2xhc3Ncbikge1xuXHRjb25zdCBsYXN0Rm9jdXMgPSBkb2N1bWVudC5hY3RpdmVFbGVtZW50O1xuXHQvLyBDaGVjayBpZiB3ZSBzaG91bGQgYmUgc2hvd2luZyB0aGUgcG9wdXBcblx0aWYgKFxuXHRcdCd0cnVlJyAhPT0gZ2V0Q29va2llKCBwb3B1cFNob3duQ29va2llTmFtZSApICYmXG5cdFx0ISAkKCAnLicgKyBwb3B1cFNlbGVjdG9yICkuaGFzQ2xhc3MoIGNoZWNrU2Vzc2lvbkNsYXNzIClcblx0KSB7XG5cdFx0c2hvd1BvcHVwKFxuXHRcdFx0cG9wdXBTZWxlY3Rvcixcblx0XHRcdGNvb2tpZURheVRvdGFsLFxuXHRcdFx0cG9wdXBTaG93bkNvb2tpZU5hbWUsXG5cdFx0XHRwb3B1cFZpc2libGVDbGFzc1xuXHRcdCk7XG5cdH1cblxuXHQvLyBjbGljayBvbiBsb2dpbiBsaW5rIGluc2lkZSBwb3B1cFxuXHQkKCAnLicgKyBwb3B1cFNlbGVjdG9yICkub24oICdjbGljaycsICcubWVzc2FnZS1sb2dpbicsIGZ1bmN0aW9uICgpIHtcblx0XHRjb25zdCB1cmwgPSAkKCB0aGlzICkuYXR0ciggJ2hyZWYnICk7XG5cdFx0YW5hbHl0aWNzVHJhY2tpbmdFdmVudCggJ2V2ZW50JywgJ1BvcHVwJywgJ0xvZ2luIExpbmsnLCB1cmwgKTtcblx0fSApO1xuXG5cdGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXG5cdFx0J2NsaWNrJyxcblx0XHRmdW5jdGlvbiAoIGV2ZW50ICkge1xuXHRcdFx0aWYgKFxuXHRcdFx0XHQhICQoIGV2ZW50LnRhcmdldCApXG5cdFx0XHRcdFx0LmNsb3Nlc3QoICcuJyArIHBvcHVwU2VsZWN0b3IgKVxuXHRcdFx0XHRcdC5pcyggJy4nICsgcG9wdXBTZWxlY3RvciApICYmXG5cdFx0XHRcdCQoICcuJyArIHBvcHVwU2VsZWN0b3IgKS5oYXNDbGFzcyggcG9wdXBWaXNpYmxlQ2xhc3MgKVxuXHRcdFx0KSB7XG5cdFx0XHRcdGhpZGVQb3B1cChcblx0XHRcdFx0XHRwb3B1cFNlbGVjdG9yLFxuXHRcdFx0XHRcdHBvcHVwVmlzaWJsZUNsYXNzLFxuXHRcdFx0XHRcdGxhc3RGb2N1cyxcblx0XHRcdFx0XHQnQ2xpY2sgT3V0c2lkZSB0byBDbG9zZSdcblx0XHRcdFx0KTtcblx0XHRcdH1cblx0XHR9LFxuXHRcdHRydWVcblx0KTtcblxuXHQvLyBwb3B1cCBjbG9zZSBidXR0b25cblx0JCggJy4nICsgcG9wdXBTZWxlY3RvciApLm9uKCAnY2xpY2snLCAnLnNtLWNsb3NlLWJ0bicsIGZ1bmN0aW9uICggZSApIHtcblx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0aGlkZVBvcHVwKFxuXHRcdFx0cG9wdXBTZWxlY3Rvcixcblx0XHRcdHBvcHVwVmlzaWJsZUNsYXNzLFxuXHRcdFx0bGFzdEZvY3VzLFxuXHRcdFx0J0Nsb3NlIEJ1dHRvbidcblx0XHQpO1xuXHR9ICk7XG5cblx0Ly8gZXNjYXBlIGtleSBwcmVzc1xuXHQkKCBkb2N1bWVudCApLmtleXVwKCBmdW5jdGlvbiAoIGUgKSB7XG5cdFx0aWYgKCAyNyA9PT0gZS5rZXlDb2RlICkge1xuXHRcdFx0aGlkZVBvcHVwKFxuXHRcdFx0XHRwb3B1cFNlbGVjdG9yLFxuXHRcdFx0XHRwb3B1cFZpc2libGVDbGFzcyxcblx0XHRcdFx0bGFzdEZvY3VzLFxuXHRcdFx0XHQnRXNjYXBlIEtleSdcblx0XHRcdCk7XG5cdFx0fVxuXHR9ICk7XG5cblx0Ly8gY2xpY2sgb24gYSBub24tbG9naW4gb3IgY2xvc2UgbGluayBpbnNpZGUgcG9wdXBcblx0JCggJy4nICsgcG9wdXBTZWxlY3RvciApLm9uKFxuXHRcdCdjbGljaycsXG5cdFx0J2E6bm90KCAuc20tY2xvc2UtYnRuLCAubWVzc2FnZS1sb2dpbiApJyxcblx0XHRmdW5jdGlvbiAoKSB7XG5cdFx0XHRjb25zdCBwb3B1cElkID0gZ2V0UG9zdElkKCBwb3B1cFNlbGVjdG9yICk7XG5cdFx0XHRhbmFseXRpY3NUcmFja2luZ0V2ZW50KCAnZXZlbnQnLCAnUG9wdXAnLCAnQ2xpY2snLCBwb3B1cElkICk7XG5cdFx0fVxuXHQpO1xufVxuXG5mdW5jdGlvbiBtZXNzYWdlQW5hbHl0aWNzKCBtZXNzYWdlICkge1xuXHRjb25zdCBtZXNzYWdlUmVnaW9uID0gZ2V0TWVzc2FnZVJlZ2lvbiggJy4nICsgbWVzc2FnZSApO1xuXHRjb25zdCBtZXNzYWdlSWQgPSBnZXRQb3N0SWQoIG1lc3NhZ2UgKTtcblx0aWYgKCAkKCAnLicgKyBtZXNzYWdlICkuaXMoICc6dmlzaWJsZScgKSApIHtcblx0XHRhbmFseXRpY3NUcmFja2luZ0V2ZW50KCAnZXZlbnQnLCBtZXNzYWdlUmVnaW9uLCAnU2hvdycsIG1lc3NhZ2VJZCwge1xuXHRcdFx0bm9uSW50ZXJhY3Rpb246IDEsXG5cdFx0fSApO1xuXHR9XG5cdC8vIGNsaWNrIG9uIGxvZ2luIGxpbmsgaW5zaWRlIGEgbWVzc2FnZVxuXHQkKCAnLicgKyBtZXNzYWdlICkub24oICdjbGljaycsICcubWVzc2FnZS1sb2dpbicsIGZ1bmN0aW9uICgpIHtcblx0XHRjb25zdCB1cmwgPSAkKCB0aGlzICkuYXR0ciggJ2hyZWYnICk7XG5cdFx0YW5hbHl0aWNzVHJhY2tpbmdFdmVudCggJ2V2ZW50JywgbWVzc2FnZVJlZ2lvbiwgJ0xvZ2luIExpbmsnLCB1cmwgKTtcblx0fSApO1xuXG5cdC8vIGNsaWNrIG9uIGEgbm9uLWxvZ2luIG9yIGNsb3NlIGxpbmsgaW5zaWRlIGEgbWVzc2FnZVxuXHQkKCAnLicgKyBtZXNzYWdlICkub24oXG5cdFx0J2NsaWNrJyxcblx0XHQnYTpub3QoIC5zbS1jbG9zZS1idG4sIC5tZXNzYWdlLWxvZ2luICknLFxuXHRcdGZ1bmN0aW9uICgpIHtcblx0XHRcdGFuYWx5dGljc1RyYWNraW5nRXZlbnQoXG5cdFx0XHRcdCdldmVudCcsXG5cdFx0XHRcdG1lc3NhZ2VSZWdpb24sXG5cdFx0XHRcdCdDbGljaycsXG5cdFx0XHRcdG1lc3NhZ2VJZFxuXHRcdFx0KTtcblx0XHR9XG5cdCk7XG59XG5cbi8qKlxuICogV2hlbiBqUXVlcnkgaXMgbG9hZGVkLCBzZXQgdXAgc2Vzc2lvbiB0cmFja2luZyBhbmQgcG9wdXAgZGlzcGxheVxuICpcbiAqL1xuJCggZG9jdW1lbnQgKS5yZWFkeSggZnVuY3Rpb24gKCkge1xuXHRjb25zdCBwb3B1cFNlbGVjdG9yID0gJ3dwLW1lc3NhZ2UtaW5zZXJ0ZXItbWVzc2FnZS1yZWdpb24tcG9wdXAnO1xuXHRjb25zdCBwb3B1cFNob3duQ29va2llTmFtZSA9ICdzbS1zaG93bic7XG5cdGNvbnN0IHBvcHVwVmlzaWJsZUNsYXNzID0gJ3dwLW1lc3NhZ2UtaW5zZXJ0ZXItbWVzc2FnZS1wb3B1cC12aXNpYmxlJztcblx0Y29uc3QgY2hlY2tTZXNzaW9uQ2xhc3MgPSAnY2hlY2stc2Vzc2lvbi1tZXNzYWdlJztcblx0Y29uc3QgbWVzc2FnZVNlbGVjdG9yID0gJ3dwLW1lc3NhZ2UtaW5zZXJ0ZXItbWVzc2FnZSc7XG5cblx0Ly8gR2V0IG91ciB2YWx1ZSBmb3IgZGF5cyBhbmQgaG91cnMgdG8gc2V0IGNvb2tpZVxuXHRjb25zdCBjbG9zZVRpbWVEYXlzID1cblx0XHRwYXJzZUludCggJCggJy4nICsgcG9wdXBTZWxlY3RvciApLmRhdGEoICdjbG9zZS10aW1lLWRheXMnICkgKSB8fCAwO1xuXHRjb25zdCBjbG9zZVRpbWVIb3VycyA9XG5cdFx0KCBwYXJzZUludCggJCggJy4nICsgcG9wdXBTZWxlY3RvciApLmRhdGEoICdjbG9zZS10aW1lLWhvdXJzJyApICkgfHxcblx0XHRcdDAgKSAvIDI0O1xuXHQvLyBPdXIgVG90YWwgZm9yIHdoZW4gdGhlIGNvb2tpZSBzaG91bGQgZXhwaXJlIGFuZCBzaG93IHRoZSBiYW5uZXIgYWdhaW5cblx0Y29uc3QgY29va2llRGF5VG90YWwgPSBjbG9zZVRpbWVEYXlzICsgY2xvc2VUaW1lSG91cnM7XG5cblx0Ly8gU2Vzc2lvbiBWYWxpZGF0aW5nIGFuZCBzaG93aW5nIHByb3BlciBiYW5uZXJcblx0Y29uc3Qgb3BlcmF0b3JzID0ge1xuXHRcdGd0KCBhLCBiICkge1xuXHRcdFx0cmV0dXJuIGEgPj0gYjtcblx0XHR9LFxuXHRcdGx0KCBhLCBiICkge1xuXHRcdFx0cmV0dXJuIGEgPD0gYjtcblx0XHR9LFxuXHR9O1xuXG5cdGNvbnN0IGN1cnJlbnRDb3VudCA9IHNldEN1cnJlbnRDb3VudCgpO1xuXG5cdGlmICggMCA8ICQoICcuJyArIGNoZWNrU2Vzc2lvbkNsYXNzICkubGVuZ3RoICkge1xuXHRcdCQoICcuJyArIGNoZWNrU2Vzc2lvbkNsYXNzICkuZWFjaCggZnVuY3Rpb24gKCkge1xuXHRcdFx0Y29uc3QgYmFubmVyU2Vzc2lvbkNvdW50ID0gcGFyc2VJbnQoXG5cdFx0XHRcdCQoIHRoaXMgKS5kYXRhKCAnc2Vzc2lvbi1jb3VudC10by1jaGVjaycgKVxuXHRcdFx0KTtcblx0XHRcdGNvbnN0IGJhbm5lclNlc3Npb25PcGVyYXRvciA9ICQoIHRoaXMgKS5kYXRhKFxuXHRcdFx0XHQnc2Vzc2lvbi1jb3VudC1vcGVyYXRvcidcblx0XHRcdCk7XG5cdFx0XHRpZiAoXG5cdFx0XHRcdG9wZXJhdG9yc1sgYmFubmVyU2Vzc2lvbk9wZXJhdG9yIF0oXG5cdFx0XHRcdFx0Y3VycmVudENvdW50LFxuXHRcdFx0XHRcdGJhbm5lclNlc3Npb25Db3VudFxuXHRcdFx0XHQpXG5cdFx0XHQpIHtcblx0XHRcdFx0aWYgKCAhICQoIHRoaXMgKS5oYXNDbGFzcyggcG9wdXBTZWxlY3RvciApICkge1xuXHRcdFx0XHRcdCQoIHRoaXMgKS5hZGRDbGFzcyggJ3ZhbGlkYXRlZCcgKTtcblx0XHRcdFx0fSBlbHNlIGlmICggISBnZXRDb29raWUoIHBvcHVwU2hvd25Db29raWVOYW1lICkgKSB7XG5cdFx0XHRcdFx0JCggdGhpcyApLmFkZENsYXNzKCAndmFsaWRhdGVkJyApO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fSApO1xuXHR9XG5cblx0aWYgKCAwIDwgJCggJy4nICsgcG9wdXBTZWxlY3RvciApLmxlbmd0aCApIHtcblx0XHRwb3B1cERpc3BsYXkoXG5cdFx0XHRwb3B1cFNlbGVjdG9yLFxuXHRcdFx0Y29va2llRGF5VG90YWwsXG5cdFx0XHRwb3B1cFNob3duQ29va2llTmFtZSxcblx0XHRcdHBvcHVwVmlzaWJsZUNsYXNzXG5cdFx0KTtcblx0fVxuXG5cdGlmIChcblx0XHQwIDwgJCggJy4nICsgbWVzc2FnZVNlbGVjdG9yICsgJzpub3QoIC4nICsgcG9wdXBTZWxlY3RvciArICcgKScgKS5sZW5ndGhcblx0KSB7XG5cdFx0bWVzc2FnZUFuYWx5dGljcyggbWVzc2FnZVNlbGVjdG9yICsgJzpub3QoIC4nICsgcG9wdXBTZWxlY3RvciArICcgKScgKTtcblx0fVxufSApO1xuIl19
}(jQuery));
